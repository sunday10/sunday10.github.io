<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="SundayLE IT运维技术记录">
    <meta name="keyword"  content="sunday,sundayhk,sundayle,sunday博客,Linxu,运维">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Nginx 配置优化 - Sunday博客 | Sunday Blog
        
    </title>

    <link rel="canonical" href="http://www.sundayle.com/nginx-configuration-optimization/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">SundayLe</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://www.sundayle.com/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#nginx" title="nginx">nginx</a>
                        
                    </div>
                    <h1>Nginx 配置优化</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Sunday on
                        2017-04-14
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="1-隐藏版本信息"><a href="#1-隐藏版本信息" class="headerlink" title="1. 隐藏版本信息"></a>1. 隐藏版本信息</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vim</span> /usr/local/nginx/conf/nginx.conf</span><br><span class="line">http&#123;</span><br><span class="line"><span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2-更改Nginx默认用户"><a href="#2-更改Nginx默认用户" class="headerlink" title="2. 更改Nginx默认用户"></a>2. 更改Nginx默认用户</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@Debian:~# useradd nginx -s /sbin/nologin -M</span><br><span class="line">root@Debian:~# grep <span class="string">"user"</span> /usr/local/nginx/conf/nginx.conf</span><br><span class="line">user nginx nginx;</span><br><span class="line">定义user和工作group 进程使用的凭证。如果group省略，user则使用名称等于的组。</span><br></pre></td></tr></table></figure>
<h1 id="3-优化worker进程个数"><a href="#3-优化worker进程个数" class="headerlink" title="3. 优化worker进程个数"></a>3. 优化worker进程个数</h1><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">worker_processes <span class="number">4</span> 一般为CPU核数 或 CPU核数*<span class="number">2</span></span><br><span class="line">lscpu</span><br><span class="line">root@Debian:~# <span class="keyword">grep</span> <span class="string">'physical id'</span> <span class="regexp">/proc/</span>cpuinfo|<span class="keyword">sort</span> -nr|uniq -c|wc -l #查看物理CPU颗数</span><br><span class="line"><span class="number">1</span></span><br><span class="line">root@Debian:~# <span class="keyword">grep</span> <span class="string">'core id'</span> <span class="regexp">/proc/</span>cpuinfo | <span class="keyword">sort</span> -u | wc -l #查看单核心数量</span><br><span class="line"><span class="number">4</span></span><br><span class="line">root@Debian:~# <span class="keyword">grep</span> <span class="string">"processor"</span> <span class="regexp">/etc/</span>cpuinfo|<span class="keyword">sort</span> -nr|uniq -c|wc -l #逻辑核心数</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<h1 id="4-CPU核数绑定"><a href="#4-CPU核数绑定" class="headerlink" title="4. CPU核数绑定"></a>4. CPU核数绑定</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">worker_processes <span class="number">4</span>;</span><br><span class="line">worker_cpu_affinity <span class="number">0001</span> <span class="number">0010</span> <span class="number">0100</span> <span class="number">1000</span>;</span><br><span class="line">防止进程只在一个核心上运行也可以使用 taskset 命令</span><br><span class="line">taskset -c <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> /application/nginx/sbin/nginx start</span><br></pre></td></tr></table></figure>
<h1 id="5-Nginx事件处理模型优化"><a href="#5-Nginx事件处理模型优化" class="headerlink" title="5. Nginx事件处理模型优化"></a>5. Nginx事件处理模型优化</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">选用epoll Linux2<span class="number">.6</span>以上</span><br><span class="line">events&#123;</span><br><span class="line"><span class="keyword">use</span> <span class="title">epoll</span>;</span><br><span class="line">&#125;</span><br><span class="line">可以不指定事件处理模型，Nginx会自动选择最佳的事件处理模型</span><br></pre></td></tr></table></figure>
<h1 id="6-调整进程最大连接数"><a href="#6-调整进程最大连接数" class="headerlink" title="6. 调整进程最大连接数"></a>6. 调整进程最大连接数</h1><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events&#123;</span><br><span class="line">worker_connections <span class="number">2048</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">并发=worker_process * worker_connections</span><br></pre></td></tr></table></figure>
<h1 id="7-worker进程最大打开文件数"><a href="#7-worker进程最大打开文件数" class="headerlink" title="7. worker进程最大打开文件数"></a>7. worker进程最大打开文件数</h1><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">worker_rlimit_nofile <span class="number">65535</span><span class="comment">;</span></span><br><span class="line">设置为ulimit -HSn结果</span><br></pre></td></tr></table></figure>
<h1 id="8-开启高效文件传输模式"><a href="#8-开启高效文件传输模式" class="headerlink" title="8. 开启高效文件传输模式"></a>8. 开启高效文件传输模式</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sendfile参数用于开启文件的高效传输模式，同时将tcp_nopush和tcp_nodelay两个指定设为<span class="keyword">on</span>，可防止网络及磁盘I/O阻塞，提升Nginx工作效</span><br><span class="line">率。<span class="number">3</span>个参数配合使用</span><br><span class="line">http &#123;</span><br><span class="line">sendfile <span class="keyword">on</span>;</span><br><span class="line">tcp_nopush <span class="keyword">on</span>;</span><br><span class="line">tcp_nodelay <span class="keyword">on</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="9-设置连接超时"><a href="#9-设置连接超时" class="headerlink" title="9. 设置连接超时"></a>9. 设置连接超时</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">60</span>; <span class="comment">#设置客户端连接保持会话的超时时间</span></span><br><span class="line"><span class="attribute">client_header_timeout</span> <span class="number">15</span>; <span class="comment">#读取客户端请求头数据超时时间，超时则返回“Request time out（408）”</span></span><br><span class="line"><span class="attribute">clietn_body_timeout</span> <span class="number">15</span>; <span class="comment">#读取客户端请求主体超时时间</span></span><br><span class="line"><span class="attribute">send_timeout</span> <span class="number">15</span>; <span class="comment">#指定客户端响应时间</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#将无用的连接尽快设置为超时，可以保护服务器的系统资源（CPU、内存、磁盘）</span></span><br></pre></td></tr></table></figure>
<h1 id="10-优化服务器域名的bash表大小"><a href="#10-优化服务器域名的bash表大小" class="headerlink" title="10.优化服务器域名的bash表大小"></a>10.优化服务器域名的bash表大小</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置存放域名（server names）的最大哈希表大小</span><br><span class="line">server_names_hash_bucket_size size <span class="number">512</span>;</span><br><span class="line">#默认是<span class="number">512</span>KB 一般要看系统给出确切的值。这里一般是cpu L1的<span class="number">4</span><span class="number">-5</span>倍</span><br></pre></td></tr></table></figure>
<h1 id="11-设置请求-上传大小"><a href="#11-设置请求-上传大小" class="headerlink" title="11. 设置请求 上传大小"></a>11. 设置请求 上传大小</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">client_header_buffer_size</span> <span class="number">32k</span>; <span class="comment">#设置读取客户端请求标头的缓冲区大小</span></span><br><span class="line"><span class="attribute">large_client_header_buffers</span> <span class="number">4</span> <span class="number">32k</span>; <span class="comment">#设置读取客户端请求标头的最大值number和size缓冲区</span></span><br><span class="line"><span class="attribute">client_max_body_size</span> <span class="number">300m</span>; <span class="comment">#设置上传大小（根据业务调整）</span></span><br></pre></td></tr></table></figure>
<h1 id="12-开启gzip压缩"><a href="#12-开启gzip压缩" class="headerlink" title="12. 开启gzip压缩"></a>12. 开启gzip压缩</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gzip <span class="keyword">on</span>; <span class="comment">#开启gzip压缩功能</span></span><br><span class="line">gzip_buffers <span class="number">4</span> <span class="number">16</span>k;</span><br><span class="line"><span class="comment">#压缩缓冲区大小，表示申请4个单位为16K的内存作为压缩结果流缓存，默认是申请与原始是数据大小相同的内存空间来存储gzip压缩结果；</span></span><br><span class="line">gzip_http_version <span class="number">1.1</span>;</span><br><span class="line"><span class="comment">#压缩版本（默认1.1 前端为squid2.5时使用1.0）用于设置识别HTTP协议版本，默认是1.1，目前大部分浏览器已经支持GZIP压缩，使用默认即可。</span></span><br><span class="line">gzip_comp_level <span class="number">2</span>;</span><br><span class="line"><span class="comment">#压缩比率，用来指定GZIP压缩比，1压缩比最小，处理速度最快；9压缩比最大，传输速度快，但处理最慢，也消耗CPU资源</span></span><br><span class="line">gzip_types <span class="built_in">text</span>/plain <span class="built_in">application</span>/x-javascript <span class="built_in">text</span>/css <span class="built_in">application</span>/xml;</span><br><span class="line"><span class="comment">#用来指定压缩的类型，“text/html”类型总是会被压缩，这个就是HTTP原理部分讲的媒体类型。</span></span><br><span class="line">gzip_vary <span class="keyword">on</span>;</span><br><span class="line"><span class="comment">#vary hear支持，该选项可以让前端的缓存服务器缓存经过GZIP压缩的页面，例如用缓存经过Nginx压缩的数据</span></span><br></pre></td></tr></table></figure>
<h1 id="13-Nginx-Fastcgi相关参数"><a href="#13-Nginx-Fastcgi相关参数" class="headerlink" title="13. Nginx Fastcgi相关参数"></a>13. Nginx Fastcgi相关参数</h1><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">fastcgi_connect_timeout <span class="number">300</span>; <span class="comment">#连接到后端fastcgi的超时时间</span></span><br><span class="line">fastcgi_send_timeout <span class="number">300</span>; <span class="comment">#已经和fastcgi建立连接后多久不传送数据，就会被断开</span></span><br><span class="line">fastcgi_read_timeout <span class="number">300</span>; <span class="comment">#接收fastcgi应答的超时时间</span></span><br><span class="line">fastcgi_buffer_size <span class="number">64</span>k; 指定读取FastCGI服务端收到的第一部分响应信息的缓冲区大小</span><br><span class="line">fastcgi_buffers <span class="number">4</span> <span class="number">64</span>k; 指定读取从FastCGI服务端收到的响应信息的缓冲区大小以及缓冲区数量</span><br><span class="line">fastcgi_busy_buffers_size <span class="number">128</span>k <span class="comment">#繁忙时的buffer，可以是fastcgi_buffer的两倍;</span></span><br><span class="line">fastcgi_temp_file_write_size <span class="number">128</span>k; <span class="comment">#fastcgi临时文件的大小，可设置128-256k</span></span><br><span class="line">fastcgi_temp_path /data/ngx_fcgi_tmp; <span class="comment">#fastcgi临时文件目录</span></span><br><span class="line">fastcgi_cache_path /data/ngx_fcgi_cache <span class="attr">levels=2:2</span> <span class="attr">keys_zone=ngx_fcgi_cache:512m</span> <span class="attr">inactive=1d</span> max_s</span><br><span class="line"><span class="attr">ize=40g;</span> <span class="comment">#缓存目录，可以设置目录哈希层级。比如2:2会生成256*256个子目录，keys_zene是这个缓存空间的名字，</span></span><br><span class="line">cache是用多少内存(这样热门的内容nginx直接放入内存，提高访问速度)，inactive表示默认失效时间，max_size表示</span><br><span class="line">最多用多少硬盘空间，需要注意的是fastcgi_cache缓存是先卸载fastcgi_temp_path再移到fastcgi_cache_path。</span><br><span class="line">所以这两个目录最好在同一个分区</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ .*\.(php|php5)?$</span> &#123;</span><br><span class="line"><span class="attribute">root</span> html/www;</span><br><span class="line"><span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line"><span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line"><span class="attribute">include</span> fastcgi.conf;</span><br><span class="line"><span class="attribute">fastcgi_cache</span> ngx_fcgi_cache;<span class="comment">#表示开启缓存并为其指定一个名称，可以有效降低cpu的负载，并且防止502的发生，但是也可能会带来其他问题</span></span><br><span class="line"><span class="attribute">fastcgi_cache_valid</span> <span class="number">200</span> <span class="number">302</span> <span class="number">1h</span>; <span class="comment">#将对应的应答码缓存时间</span></span><br><span class="line"><span class="attribute">fastcgi_cache_valid</span> <span class="number">301</span> <span class="number">1d</span>; <span class="comment">#将301缓存1天</span></span><br><span class="line"><span class="attribute">fastcgi_cache_valid</span> any <span class="number">1m</span>; <span class="comment">#将其他应答缓存1分钟</span></span><br><span class="line"><span class="attribute">fastcgi_cache_min_uses</span> <span class="number">1</span>; <span class="comment">#请求数量</span></span><br><span class="line"><span class="attribute">fastcgi_cache_use_stale</span> <span class="literal">error</span> timeout invalid_header http_500; <span class="comment">#错误判断</span></span><br><span class="line"><span class="attribute">fastcgi_cache_key</span> http://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="14-配置Nginx-expires缓存功能"><a href="#14-配置Nginx-expires缓存功能" class="headerlink" title="14. 配置Nginx expires缓存功能"></a>14. 配置Nginx expires缓存功能</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span> &#123; <span class="comment">#指定缓存文件的类型</span></span><br><span class="line"><span class="attribute">expires</span> <span class="number">365d</span>; <span class="comment">#指定缓存时间</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ .*\.(js|css)?$</span> &#123;</span><br><span class="line"><span class="attribute">expires</span> <span class="number">3d</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="15-Nginx日志相关优化与安全"><a href="#15-Nginx日志相关优化与安全" class="headerlink" title="15.Nginx日志相关优化与安全"></a>15.Nginx日志相关优化与安全</h1><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）每天进行日志切割，备份</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">cd <span class="meta-keyword">/application/</span>nginx<span class="meta-keyword">/logs/</span></span><br><span class="line">mv www_access.log www.access_$(date +%F -d <span class="number">-1</span>day).log</span><br><span class="line">mv blog_access.log blog.access_$(date +%F -d <span class="number">-1</span>day).log</span><br><span class="line"><span class="meta-keyword">/application/</span>nginx<span class="meta-keyword">/sbin/</span>nginx -s reload</span><br><span class="line"></span><br><span class="line">cat <span class="params">&lt;&lt;/var/spool/cron/root&gt;</span>&gt;EOF</span><br><span class="line"><span class="number">00</span> <span class="number">00</span> * * * <span class="meta-keyword">/bin/</span>sh <span class="meta-keyword">/server/</span>scripts/cut_nginx_log.sh <span class="variable">&amp;gt</span>;<span class="meta-keyword">/dev/</span>null <span class="number">2</span><span class="variable">&amp;gt</span>;<span class="variable">&amp;amp</span>;<span class="number">1</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>)不记录不需要的访问日志</span><br><span class="line">对于健康检查或者某些图片、JS、CSS日志，一般不需要记录日志，因为在统计PV时是按照页面计算的，而且写入频繁会消耗IO，降低服务器性能</span><br><span class="line">location ~ .*\.(js|jpg|JPG|jpeg|JPEG|css|bmp|gif|GIF)$ &#123;</span><br><span class="line">access_log off;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">3</span>）访问日志的权限设置</span><br><span class="line">chown -R root.root <span class="meta-keyword">/application/</span>nginx/logs</span><br><span class="line">chmod -R <span class="number">700</span> <span class="meta-keyword">/application/</span>logs</span><br></pre></td></tr></table></figure>
<h1 id="16-Nginx站点目录及文件URL访问控制"><a href="#16-Nginx站点目录及文件URL访问控制" class="headerlink" title="16.Nginx站点目录及文件URL访问控制"></a>16.Nginx站点目录及文件URL访问控制</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）根据扩展名限制程序或者文件被访问</span><br><span class="line">资源文件夹如用户上传的头像，防止恶意上传脚本病毒文件被解析执行</span><br><span class="line">server &#123;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~ ^/images</span>/.*\.(php|php5|sh|pl|py)$ &#123; <span class="comment">#指定目录限制访问</span></span><br><span class="line"><span class="keyword">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~ ^/static</span>/.*\.(php|php5|sh|pl|py)$ &#123;</span><br><span class="line"><span class="keyword">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~ ^/data</span>/.*\.(php|php5|sh|pl|py)$ &#123;</span><br><span class="line"><span class="keyword">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~ .*\.(php</span>|php5)?$ &#123; <span class="comment">#必须配置在解析之前</span></span><br><span class="line">root html/www;</span><br><span class="line">fastcgi_pass <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">include fastcgi.conf;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）禁止访问目录并返回指定HTTP代码</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"><span class="keyword">location</span> <span class="title">/admin</span>/ &#123; return <span class="number">404</span>； &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">3</span>）限制网站来源IP</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~ ^/admin</span>/ &#123;</span><br><span class="line">allow <span class="number">202.111</span>.<span class="number">12.211</span>;</span><br><span class="line"><span class="comment">#allow 192.168.1.0/24; #也可以限制IP段</span></span><br><span class="line"><span class="keyword">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">企业问题案列：Nginx做方向代理的时候可以限制客户端IP吗？</span><br><span class="line">方法一：用if来控制</span><br><span class="line">if （ $remotea_addr = <span class="number">10.0</span>.<span class="number">0.110</span> ） &#123;</span><br><span class="line">return <span class="number">403</span>;</span><br><span class="line">&#125;</span><br><span class="line">if （ $remotea_addr = <span class="number">10.0</span>.<span class="number">0.111</span> ） &#123;</span><br><span class="line">set $allow_access_root '<span class="literal">true</span>';</span><br><span class="line">&#125;</span><br><span class="line">方法二：利用<span class="keyword">deny</span>和allow</span><br><span class="line"><span class="keyword">location</span> <span class="title">/ &#123;</span></span><br><span class="line"><span class="title">root</span> html/blog;</span><br><span class="line">index index.php index.html index.html;</span><br><span class="line"><span class="keyword">deny</span> <span class="number">10.0</span>.<span class="number">0.7</span>;</span><br><span class="line">allow all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="17-防止恶意解析访问企业网站"><a href="#17-防止恶意解析访问企业网站" class="headerlink" title="17.防止恶意解析访问企业网站"></a>17.防止恶意解析访问企业网站</h1><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">方法一</span><br><span class="line">server &#123;</span><br><span class="line"><span class="attribute">listen 80 default_server;</span></span><br><span class="line"><span class="attribute">server_name _;</span></span><br><span class="line"><span class="attribute">return 501;</span></span><br><span class="line"><span class="attribute">&#125;</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">方法二</span></span><br><span class="line"><span class="attribute">server &#123;</span></span><br><span class="line"><span class="attribute">listen 80 default_server;</span></span><br><span class="line"><span class="attribute">server_name _;</span></span><br><span class="line"><span class="attribute">rewrite ^(.*) http</span>://www<span class="variable">.sundayle</span><span class="variable">.com</span>$1 permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">方法三</span><br><span class="line">server &#123;</span><br><span class="line"><span class="attribute">if ($host !~ ^www/.sundayle/.com$) &#123;</span></span><br><span class="line"><span class="attribute">rewrite ^(.*) http</span>://www<span class="variable">.sundayle</span><span class="variable">.com</span>$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="18-Nginx图片及目录防盗链"><a href="#18-Nginx图片及目录防盗链" class="headerlink" title="18.Nginx图片及目录防盗链"></a>18.Nginx图片及目录防盗链</h1><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">网站图片被盗链最直接的影响就是网络带宽占用加大了，宽带费用变高了，网络流量忽高忽低</span><br><span class="line">利用referer防盗链</span><br><span class="line"></span><br><span class="line">location ~.* \.(jpg|<span class="type">gif</span>|<span class="type">png</span>|<span class="type">swf</span>|<span class="type">flv</span>|<span class="type">wma</span>|<span class="type">wmv</span>|<span class="type">asf</span>|<span class="type">mp3</span>|<span class="type">mmf</span>|<span class="type">zip</span>|<span class="type">rar</span>)$ &#123;</span><br><span class="line">valid_referers none blocked *.sundayle.cn sundayle.cn;</span><br><span class="line"><span class="keyword">if</span> ($invalid_referer) &#123;s</span><br><span class="line"><span class="built_in">rewrite</span> ^/ http://www.sundayle.cn/img/nolink.jpg</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="19-Nginx错误页面的优雅显示"><a href="#19-Nginx错误页面的优雅显示" class="headerlink" title="19. Nginx错误页面的优雅显示"></a>19. Nginx错误页面的优雅显示</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">error_page <span class="number">403</span> /<span class="number">403.</span>html; #当出现<span class="number">403</span>错误时，会跳转到<span class="number">403.</span>html页面</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="20-Nginx防爬虫优化"><a href="#20-Nginx防爬虫优化" class="headerlink" title="20. Nginx防爬虫优化"></a>20. Nginx防爬虫优化</h1><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">robots.txt机器人协议</span><br><span class="line">网络爬虫排除标准，告诉搜索引擎哪些目录可以抓取，哪些禁止抓取</span><br><span class="line">禁止下载协议代理</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($http_user_agent ~* LWP::Simple|<span class="type">BBBike</span>|<span class="type">wget</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">403</span>;</span><br><span class="line">&#125;</span><br><span class="line">防止N多爬虫代理访问网站</span><br><span class="line"><span class="keyword">if</span> ($http_user_agent ~*</span><br><span class="line">“qihoobot|<span class="type">Baiduspider</span>|<span class="type">Googlebot</span>|<span class="type">Googlebot</span>-Mobile|<span class="type">Googlebot</span>-Image|<span class="type">Mediapartners</span>-Google|<span class="type">Adsbot</span>-Google|<span class="type">Yahoo</span>! Slurp China|<span class="type">YoudaoBot</span>|<span class="type">Sosospider</span>|<span class="type">Sogou</span> spider|<span class="type">Sogou</span> web spider|<span class="type">MSNBot</span>”) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">403</span>;</span><br><span class="line">&#125;</span><br><span class="line">禁止不同浏览器访问</span><br><span class="line"><span class="keyword">if</span> ($http_user_agent ~* “Firefox|<span class="type">MSIE</span>”)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">rewrite</span> ^(.*) http://blog.etiantian.org/$<span class="number">1</span> permanent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="21-限制HTTP请求方法"><a href="#21-限制HTTP请求方法" class="headerlink" title="21. 限制HTTP请求方法"></a>21. 限制HTTP请求方法</h1><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($request_method !~ ^(GET<span class="params">|HEAD|</span>POST)$ ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">501</span>;</span><br><span class="line">&#125;</span><br><span class="line">只允许GET等，允许DELETE、SEARCH等</span><br><span class="line">为防止黑客通过上传服务器执行木马，也可以在上传服务器上做限制HTTP的GET</span><br><span class="line"><span class="keyword">if</span> ($request_method ~* ^(GET)$ ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">501</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="22-防DOS攻击"><a href="#22-防DOS攻击" class="headerlink" title="22. 防DOS攻击"></a>22. 防DOS攻击</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用limit_conn_zone进行控制，控制单个IP或域名的访问次数，限制连续访问</span><br><span class="line"></span><br><span class="line">limit_conn_zone <span class="variable">$binary_remote_addr</span> <span class="attribute">zone</span>=perip:10m;</span><br><span class="line">limit_conn_zone <span class="variable">$server_remote_addr</span> <span class="attribute">zone</span>=perserver:10m;</span><br><span class="line">server &#123;</span><br><span class="line">limit_conn perip 10; 允许每一个IP地址最多同时打开有10个连接。</span><br><span class="line">limit_conn perserver 100;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#还可以使用limit_req_zone进行控制，控制单个IP的访问速率</span></span><br></pre></td></tr></table></figure>
<h1 id="23-使用CDN为网站内容加速"><a href="#23-使用CDN为网站内容加速" class="headerlink" title="23. 使用CDN为网站内容加速"></a>23. 使用CDN为网站内容加速</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">　CDN是一套全国或全球的分布式缓存集群，其实质是通过智能DNS判断用户的来源地域以及上网线路，为用户选择一个最接近用户地狱以及和用户上网线路相同的服务器节点，因为地狱近，切线路相同，所以，可以大幅度提升浏览网站的体验。</span><br><span class="line">提升企业网站的用户访问体验。 可以阻挡大部分流量攻击，DOSS攻击</span><br></pre></td></tr></table></figure>
<h1 id="24-Nginx程序架构优化"><a href="#24-Nginx程序架构优化" class="headerlink" title="24. Nginx程序架构优化"></a>24. Nginx程序架构优化</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解耦，一堆程序代码按照业务用途分开，然后提供服务，例如：注册登录、上传、下载、浏览列表、商品内容、订单支付等都应该是独立的程序服务，</span><br><span class="line">只不过在客户端看来是一个整体而已，小公司最起码要做到的解耦是</span><br><span class="line"><span class="number">01.</span>网页页面服务</span><br><span class="line"><span class="number">02.</span>图片附件及下载服务</span><br><span class="line"><span class="number">03.</span>上传图片服务</span><br></pre></td></tr></table></figure>
<h1 id="另一个维度来总结"><a href="#另一个维度来总结" class="headerlink" title="另一个维度来总结"></a>另一个维度来总结</h1><h1 id="一、安全方面"><a href="#一、安全方面" class="headerlink" title="一、安全方面"></a>一、安全方面</h1><ul>
<li>1.1. 根据实际情况，隐藏 nginx header 版本号</li>
<li>1.2. 根据实际情况，更改源码，隐藏 nginx 软件名称</li>
<li>1.3. 更改 nginx 默认用户及用户组</li>
<li>1.4. nginx 站点目录及文件 URL 访问控制（防止恶意解析）</li>
<li>1.5. 防止恶意解析访问企业网站</li>
<li>1.6. 配置 nginx 图片及目录防盗链</li>
<li>1.7. 配置 nginx 防爬虫</li>
<li>1.8. 限制 HTTP 请求方法</li>
<li>1.9. 防 DOS 攻击<h1 id="二、性能方面"><a href="#二、性能方面" class="headerlink" title="二、性能方面"></a>二、性能方面</h1></li>
<li>2.1. 根据 CPU 逻辑核心数，配置 nginx worker 进程个数</li>
<li>2.2. 配置 nginx worker 进程的 CPU 亲和力参数</li>
<li>2.3. 配置 ngixn worker 单个进程允许的客户端最大连接数</li>
<li>2.4. 配置 nginx worker 进程的最大打开文件数</li>
<li>2.5. 配置 nginx 事件处理模型为 epoll<h1 id="三、HTTP-协议方面"><a href="#三、HTTP-协议方面" class="headerlink" title="三、HTTP 协议方面"></a>三、HTTP 协议方面</h1></li>
<li>3.1. 开启高效的文件传输模式（sendfile/tcp_nopush/tcp_nodelay）</li>
<li>3.2. 设置连接超时时间</li>
<li>3.3. 设置客户端上传文件大小</li>
<li>3.4. fastcgi 调优<h1 id="四、功能方面"><a href="#四、功能方面" class="headerlink" title="四、功能方面"></a>四、功能方面</h1></li>
<li>4.1. 配置 nginx gzip 压缩功能</li>
<li>4.2. 配置 nginx expires 缓存功能</li>
<li>4.3. 配置 nginx 错误页面的优雅显示<h1 id="五、日志方面"><a href="#五、日志方面" class="headerlink" title="五、日志方面"></a>五、日志方面</h1></li>
<li>5.1. 每天进行日志切割、备份/不记录不需要的访问日志/访问日志的权限设置<h1 id="六、架构方面"><a href="#六、架构方面" class="headerlink" title="六、架构方面"></a>六、架构方面</h1></li>
<li>6.1. nginx 程序架构优化(服务解耦)</li>
<li>6.2. 使用 CDN 为网站内容加速<br>参考链接：<br><a href="https://jaminzhang.github.io/nginx/Nginx-Optimization-Summary/" target="_blank" rel="noopener">https://jaminzhang.github.io/nginx/Nginx-Optimization-Summary/</a><br><a href="http://www.lichengbing.com/archivers/279.html" target="_blank" rel="noopener">http://www.lichengbing.com/archivers/279.html</a></li>
</ul>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/webbench/" data-toggle="tooltip" data-placement="top" title="Web 压力测试工具 Webbench">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/shell/" data-toggle="tooltip" data-placement="top" title="常用shell查询命令">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                

            </div>
    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#nginx" title="nginx">nginx</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://jaminzhang.github.io" target="_blank">JAMIN ZHANG</a></li>
                    
                        <li><a href="#" target="_blank">It helps SEO</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcdn.net/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/sundayle">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    版权所有 &copy; SundayLe 2020 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>
                    <!-- Ported by <a href="https://github.com/Kaijun/hexo-theme-huxblog">Kaijun</a> -->
                    <a href="https://beian.miit.gov.cn">粤ICP备18160044号</a>
            <!-- 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
            -->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
     async("https://cdn.bootcdn.net/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-70699634-1';
    var _gaDomain = 'auto';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
