<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Linux运维笔记">
    <meta name="keyword"  content="sunday,sundayhk,sundayle,sunday博客,Linxu,运维">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          OpenStack 入门实践 - Sunday博客 | Sunday Blog
        
    </title>

    <link rel="canonical" href="http://www.sundayle.com/openstack/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Sunday</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://www.sundayle.com/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#openstack" title="openstack">openstack</a>
                        
                    </div>
                    <h1>OpenStack 入门实践</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Sunday on
                        2018-07-12
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="OpenStack-概述"><a href="#OpenStack-概述" class="headerlink" title="OpenStack 概述"></a>OpenStack 概述</h1><p>OpenStack项目是一个开源云计算平台，支持所有类型的云环境。该项目旨在实现简单，大规模的可扩展性和丰富的功能。<br>OpenStack通过各种补充服务提供基础架构即服务（IaaS）解决方案。每项服务都提供了一个应用程序编程接口（API），以促进这种集成。<br>本文涵盖了使用适用于具有足够Linux经验的OpenStack新用户的功能性示例体系结构，逐步部署主要OpenStack服务。只用于学习OpenStack最小化环境。</p>
<h1 id="OpenStack-架构总览"><a href="#OpenStack-架构总览" class="headerlink" title="OpenStack 架构总览"></a>OpenStack 架构总览</h1><h2 id="概念性架构"><a href="#概念性架构" class="headerlink" title="概念性架构"></a>概念性架构</h2><p>下图显示了OpenStack服务之间的关系：<br><img src="http://owsi2j3f8.bkt.clouddn.com/static/images/openstack_kilo_conceptual_arch.png"></p>
<h2 id="逻辑体系结构"><a href="#逻辑体系结构" class="headerlink" title="逻辑体系结构"></a>逻辑体系结构</h2><p>下图显示了OpenStack云中最常见但不是唯一可能的体系结构：<br><img src="http://owsi2j3f8.bkt.clouddn.com/static/images/openstack-arch-kilo-logical-v1.png"><br>对于设计，部署和配置OpenStack，学习者必须了解逻辑体系结构。<br>如概念架构所示，OpenStack由几个独立的部分组成，称为OpenStack服务。所有服务都通过keystone服务进行身份验证。</p>
<p>各个服务通过公共API相互交互，除非需要特权管理员命令。</p>
<p>在内部，OpenStack服务由多个进程组成。所有服务都至少有一个API进程，它监听API请求，预处理它们并将它们传递给服务的其他部分。除身份服务外，实际工作由不同的流程完成。<br>对于一个服务的进程之间的通信，使用AMQP消息代理。该服务的状态存储在数据库中。部署和配置OpenStack云时，您可以选择多种消息代理和数据库解决方案，例如RabbitMQ，MySQL，MariaDB和SQLite。</p>
<p>用户可以通过Horizon Dashboard实现的基于Web的用户界面，通过命令行客户端以及通过浏览器插件或curl等工具发布API请求来访问OpenStack。对于应用程序，有几个SDK可用。最终，所有这些访问方法都会对各种OpenStack服务发出REST API调用。</p>
<p><strong> 解释 </strong> </p>
<table>
<thead>
<tr>
<th>服务名称</th>
<th style="text-align:center">项目名称</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dashboard</td>
<td style="text-align:center">Horizon</td>
<td style="text-align:left">Web管理</td>
</tr>
<tr>
<td>Compute service</td>
<td style="text-align:center">Nova</td>
<td style="text-align:left">管理OpenStack环境中计算实例的生命周期</td>
</tr>
<tr>
<td>Networking service</td>
<td style="text-align:center">Neutron</td>
<td style="text-align:left">虚拟机的网络资源管理</td>
</tr>
<tr>
<td>Object  Storage service</td>
<td style="text-align:center">Swift</td>
<td style="text-align:left">对象存储，适用于“一次写入、多次读取”</td>
</tr>
<tr>
<td>Block Storage service</td>
<td style="text-align:center">Cinder</td>
<td style="text-align:left">为运行的实例提供持久块存储</td>
</tr>
<tr>
<td>Identity service</td>
<td style="text-align:center">Keystone</td>
<td style="text-align:left">提供身份验证和授权服务</td>
</tr>
<tr>
<td>Image service</td>
<td style="text-align:center">Glance</td>
<td style="text-align:left">提供虚拟镜像的注册和存储管理</td>
</tr>
<tr>
<td>Telemetry service</td>
<td style="text-align:center">Ceilometer</td>
<td style="text-align:left">监控和计量OpenStack云，用于计费，基准测试，可扩展性和统计目的。</td>
</tr>
<tr>
<td>Orchestration service</td>
<td style="text-align:center">Heat</td>
<td style="text-align:left">自动化部署的组件</td>
</tr>
<tr>
<td>Database service</td>
<td style="text-align:center">Trove</td>
<td style="text-align:left">提供数据库应用服务</td>
</tr>
<tr>
<td>Data Processing service</td>
<td style="text-align:center">Sahara</td>
<td style="text-align:left">配置和扩展Hadoop集群的功能</td>
</tr>
</tbody>
</table>
<p><strong> 密码 </strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Password name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Database password (no variable used)</td>
<td style="text-align:left">Root password for the database</td>
</tr>
<tr>
<td style="text-align:left">ADMIN_PASS</td>
<td style="text-align:left">Password of user admin</td>
</tr>
<tr>
<td style="text-align:left">CINDER_DBPASS</td>
<td style="text-align:left">Database password for the Block Storage service</td>
</tr>
<tr>
<td style="text-align:left">CINDER_PASS</td>
<td style="text-align:left">Password of Block Storage service user cinder</td>
</tr>
<tr>
<td style="text-align:left">DASH_DBPASS</td>
<td style="text-align:left">Database password for the Dashboard</td>
</tr>
<tr>
<td style="text-align:left">DEMO_PASS</td>
<td style="text-align:left">Password of user demo</td>
</tr>
<tr>
<td style="text-align:left">GLANCE_DBPASS</td>
<td style="text-align:left">Database password for Image service</td>
</tr>
<tr>
<td style="text-align:left">GLANCE_PASS</td>
<td style="text-align:left">Password of Image service user glance</td>
</tr>
<tr>
<td style="text-align:left">KEYSTONE_DBPASS</td>
<td style="text-align:left">Database password of Identity service</td>
</tr>
<tr>
<td style="text-align:left">METADATA_SECRET</td>
<td style="text-align:left">Secret for the metadata proxy</td>
</tr>
<tr>
<td style="text-align:left">NEUTRON_DBPASS</td>
<td style="text-align:left">Database password for the Networking service</td>
</tr>
<tr>
<td style="text-align:left">NEUTRON_PASS</td>
<td style="text-align:left">Password of Networking service user neutron</td>
</tr>
<tr>
<td style="text-align:left">NOVA_DBPASS</td>
<td style="text-align:left">Database password for Compute service</td>
</tr>
<tr>
<td style="text-align:left">NOVA_PASS</td>
<td style="text-align:left">Password of Compute service user nova</td>
</tr>
<tr>
<td style="text-align:left">PLACEMENT_PASS</td>
<td style="text-align:left">Password of the Placement service user placement</td>
</tr>
<tr>
<td style="text-align:left">RABBIT_PASS</td>
<td style="text-align:left">Password of RabbitMQ user openstack</td>
</tr>
</tbody>
</table>
<h1 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h1><p>系统: CentOS 7.4 64位<br>Controller控制节点: 192.168.7.11<br>Compute计算节点: 192.168.7.12<br>最小需求演示环境:<br>Controller Node: 1 processor, 4 GB memory, and 5 GB storage<br>Compute Node: 1 processor, 2 GB memory, and 10 GB storage</p>
<h2 id="关闭防火墙等"><a href="#关闭防火墙等" class="headerlink" title="关闭防火墙等"></a>关闭防火墙等</h2><p>所有节点执行<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">stop</span> NetworkManager</span><br><span class="line">systemctl <span class="built_in">stop</span> firewalld</span><br><span class="line">setenforce <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h2 id="配置hostname和host"><a href="#配置hostname和host" class="headerlink" title="配置hostname和host"></a>配置hostname和host</h2><h3 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h3><p>controller节点<br><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hostnamectl </span><span class="built_in">set-hostname</span> <span class="string">controller</span></span><br><span class="line"><span class="string">bash</span></span><br></pre></td></tr></table></figure></p>
<p>compute节点<br><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hostnamectl </span><span class="built_in">set-hostname</span> <span class="string">compute</span></span><br><span class="line"><span class="string">bash</span></span><br></pre></td></tr></table></figure></p>
<p>cinder节点<br><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hostnamectl </span><span class="built_in">set-hostname</span> <span class="string">cinder</span></span><br><span class="line"><span class="string">bash</span></span><br></pre></td></tr></table></figure></p>
<h3 id="host"><a href="#host" class="headerlink" title="host"></a>host</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF <span class="meta">&gt;&gt; </span>/etc/hosts</span><br><span class="line"><span class="number">192.168</span>.<span class="number">7.11</span> controller</span><br><span class="line"><span class="number">192.168</span>.<span class="number">7.12</span> compute</span><br><span class="line"><span class="number">192.168</span>.<span class="number">7.13</span> cinder</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">scp /etc/hosts root@compute<span class="symbol">:/etc/</span></span><br><span class="line">scp /etc/hosts root@cinder<span class="symbol">:/etc/</span></span><br></pre></td></tr></table></figure>
<h2 id="配置-NTP"><a href="#配置-NTP" class="headerlink" title="配置 NTP"></a>配置 NTP</h2><h3 id="安装配置chrony"><a href="#安装配置chrony" class="headerlink" title="安装配置chrony"></a>安装配置chrony</h3><p>在<code>controller</code>控制节点执行<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y chrony</span><br><span class="line">sed -i 's@#allow <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span>@allow <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span>@' /etc/chrony.conf</span><br><span class="line">systemctl start chronyd</span><br><span class="line">systemctl enable chronyd</span><br></pre></td></tr></table></figure></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grep -r ^[as] /etc/chrony.conf</span><br><span class="line"></span><br><span class="line">server 0.centos.pool.ntp.org iburst</span><br><span class="line">server 1.centos.pool.ntp.org iburst</span><br><span class="line">server 2.centos.pool.ntp.org iburst</span><br><span class="line">server 3.centos.pool.ntp.org iburst</span><br><span class="line">allow 192.168.0.0/16</span><br></pre></td></tr></table></figure>
<p>在compute和cinder节点执行<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y chrony</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@server\(.*\)@#server\1@g'</span> /etc/chrony.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'3iserver controller iburst'</span> /etc/chrony.conf</span><br><span class="line">systemctl start chronyd</span><br><span class="line">systemctl enable chronyd</span><br></pre></td></tr></table></figure></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -r ^[as] /etc/chrony.conf</span><br><span class="line"></span><br><span class="line">server controller iburst</span><br></pre></td></tr></table></figure>
<h3 id="验证时钟同步服务"><a href="#验证时钟同步服务" class="headerlink" title="验证时钟同步服务"></a>验证时钟同步服务</h3><p>在<code>controller</code>控制节点执行<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# chronyc sources</span><br><span class="line"><span class="number">210</span> Number of sources = <span class="number">4</span></span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^- time5.aliyun.com              <span class="number">2</span>   <span class="number">9</span>   <span class="number">377</span>   <span class="number">457</span>   +<span class="number">467</span>us[ +<span class="number">550</span>us] +/-   <span class="number">21</span>ms</span><br><span class="line">^- makaki.miuku.net              <span class="number">2</span>   <span class="number">9</span>   <span class="number">317</span>   <span class="number">501</span>   +<span class="number">674</span>us[ +<span class="number">756</span>us] +/-  <span class="number">213</span>ms</span><br><span class="line">^- ntp1.ams1.nl.leaseweb.net     <span class="number">2</span>   <span class="number">7</span>   <span class="number">375</span>   <span class="number">319</span>  +<span class="number">7787</span>us[+<span class="number">7872</span>us] +/-  <span class="number">248</span>ms</span><br><span class="line">^* time4.aliyun.com              <span class="number">2</span>  <span class="number">10</span>   <span class="number">377</span>   <span class="number">126</span>   +<span class="number">310</span>us[ +<span class="number">400</span>us] +/- <span class="number">5895</span>us</span><br></pre></td></tr></table></figure></p>
<p>在compute cinder节点执行<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# chronyc sources</span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* controller                    3   6   177    40  <span class="code">+4835ns[  +</span>12us] +/- 6255us</span><br></pre></td></tr></table></figure></p>
<h2 id="安装OpenStack-源"><a href="#安装OpenStack-源" class="headerlink" title="安装OpenStack 源"></a>安装OpenStack 源</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mv -f /etc/yum<span class="selector-class">.repos</span><span class="selector-class">.d</span>/CentOS-Base<span class="selector-class">.repo</span> /etc/yum<span class="selector-class">.repos</span><span class="selector-class">.d</span>/CentOS-Base<span class="selector-class">.repo</span><span class="selector-class">.backup</span></span><br><span class="line">wget -O /etc/yum<span class="selector-class">.repos</span><span class="selector-class">.d</span>/CentOS-Base<span class="selector-class">.repo</span> http:<span class="comment">//mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line">yum install epel-release</span><br><span class="line">yum makecache</span><br><span class="line">yum upgrade</span><br></pre></td></tr></table></figure>
<p>openstack官方源：yum install <a href="https://rdoproject.org/repos/rdo-release.rpm" target="_blank" rel="noopener">https://rdoproject.org/repos/rdo-release.rpm</a> -y</p>
<h2 id="安装OpenStack-包"><a href="#安装OpenStack-包" class="headerlink" title="安装OpenStack 包"></a>安装OpenStack 包</h2><p>所有节点执行<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y centos-release-openstack-queens</span><br><span class="line">yum<span class="built_in"> upgrade </span>-y #如果有内核的更新，则需要reboot重启一下系统</span><br><span class="line">yum install -y python-openstackclient</span><br><span class="line">yum install openstack-selinux -y</span><br></pre></td></tr></table></figure></p>
<h2 id="MySQL-数据库"><a href="#MySQL-数据库" class="headerlink" title="MySQL 数据库"></a>MySQL 数据库</h2><p>在<code>controller</code>控制节点执行<br><a href="https://docs.openstack.org/install-guide/environment-sql-database-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/environment-sql-database-rdo.html</a></p>
<h3 id="安装Mariadb"><a href="#安装Mariadb" class="headerlink" title="安装Mariadb"></a>安装Mariadb</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mariadb mariadb-server python2-PyMySQL</span><br></pre></td></tr></table></figure>
<h3 id="配置MySQL参数"><a href="#配置MySQL参数" class="headerlink" title="配置MySQL参数"></a>配置MySQL参数</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; <span class="literal">EOF</span> &gt; /etc/my.cnf.d/openstack.conf</span><br><span class="line">[mysqld]</span><br><span class="line">bind-address = <span class="number">192.168</span><span class="number">.7</span><span class="number">.11</span></span><br><span class="line"></span><br><span class="line"><span class="section">default</span>-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = <span class="number">4096</span></span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br><span class="line"><span class="literal">EOF</span></span><br></pre></td></tr></table></figure>
<h3 id="启动数据库服务，并将其配置为开机自启"><a href="#启动数据库服务，并将其配置为开机自启" class="headerlink" title="启动数据库服务，并将其配置为开机自启"></a>启动数据库服务，并将其配置为开机自启</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">enable</span> <span class="selector-tag">mariadb</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">mariadb</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure>
<h3 id="mysql-secure-installation"><a href="#mysql-secure-installation" class="headerlink" title="mysql_secure_installation"></a>mysql_secure_installation</h3><p>为了保证数据库服务的安全性，运行<code>mysql_secure_installation</code>脚本。特别需要说明的是，为数据库的root用户设置一个适当的密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure></p>
<h2 id="RabbitMQ-消息队列"><a href="#RabbitMQ-消息队列" class="headerlink" title="RabbitMQ 消息队列"></a>RabbitMQ 消息队列</h2><p>在 controller 执行<br><a href="https://docs.openstack.org/install-guide/environment-messaging-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/environment-messaging-rdo.html</a></p>
<h3 id="安装-RabbitMQ"><a href="#安装-RabbitMQ" class="headerlink" title="安装 RabbitMQ"></a>安装 RabbitMQ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> rabbitmq-<span class="keyword">server</span> -y</span><br></pre></td></tr></table></figure>
<h3 id="启动消息队列服务并将其配置为随系统启动"><a href="#启动消息队列服务并将其配置为随系统启动" class="headerlink" title="启动消息队列服务并将其配置为随系统启动"></a>启动消息队列服务并将其配置为随系统启动</h3><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable rabbitmq-<span class="keyword">server</span>.service</span><br><span class="line">systemctl start rabbitmq-<span class="keyword">server</span>.service</span><br></pre></td></tr></table></figure>
<h3 id="添加-openstack-用户"><a href="#添加-openstack-用户" class="headerlink" title="添加 openstack 用户"></a>添加 openstack 用户</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl <span class="keyword">add_user </span>openstack RABBIT_PASS <span class="comment">#密码为RABBIT_PASS</span></span><br></pre></td></tr></table></figure>
<h3 id="给openstack用户配置写和读权限"><a href="#给openstack用户配置写和读权限" class="headerlink" title="给openstack用户配置写和读权限"></a>给openstack用户配置写和读权限</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl <span class="keyword">set</span>_permissions openstack <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></span><br></pre></td></tr></table></figure>
<p>rabbitmq监控(可省略)<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins <span class="built_in">list</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br><span class="line">访问路径：http:<span class="comment">//ip:15672 </span></span><br><span class="line">Username：guest </span><br><span class="line">Password：guest</span><br></pre></td></tr></table></figure></p>
<h2 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h2><p>在 controller 执行<br><a href="https://docs.openstack.org/install-guide/environment-memcached.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/environment-memcached.html</a></p>
<h3 id="安装memcached"><a href="#安装memcached" class="headerlink" title="安装memcached"></a>安装memcached</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> memcached python-memcached -y</span><br></pre></td></tr></table></figure>
<h3 id="修改OPTIONS-IP"><a href="#修改OPTIONS-IP" class="headerlink" title="修改OPTIONS IP"></a>修改OPTIONS IP</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i 's#<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>#<span class="number">192.168</span><span class="number">.7</span><span class="number">.11</span>#g' /etc/sysconfig/memcached</span><br></pre></td></tr></table></figure>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/sysconfig/memcached </span><br><span class="line"></span><br><span class="line">PORT=<span class="string">"11211"</span></span><br><span class="line">USER=<span class="string">"memcached"</span></span><br><span class="line">MAXCONN=<span class="string">"1024"</span></span><br><span class="line">CACHESIZE=<span class="string">"64"</span></span><br><span class="line">OPTIONS=<span class="string">"-l 192.168.7.11,::1"</span></span><br></pre></td></tr></table></figure>
<h3 id="启动Memcached服务，并且配置它随机启动"><a href="#启动Memcached服务，并且配置它随机启动" class="headerlink" title="启动Memcached服务，并且配置它随机启动"></a>启动Memcached服务，并且配置它随机启动</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">enable</span> <span class="selector-tag">memcached</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">start</span> <span class="selector-tag">memcached</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure>
<h2 id="Etcd"><a href="#Etcd" class="headerlink" title="Etcd"></a>Etcd</h2><p>在 controller 执行<br><a href="https://docs.openstack.org/install-guide/environment-etcd.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/environment-etcd.html</a> </p>
<h3 id="安装etcd"><a href="#安装etcd" class="headerlink" title="安装etcd"></a>安装etcd</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> etcd -y</span><br></pre></td></tr></table></figure>
<h3 id="etcd配置"><a href="#etcd配置" class="headerlink" title="etcd配置"></a>etcd配置</h3><p>快速处理脚本,注意ip为controller<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@#ETCD_LISTEN_PEER_URLS="http://localhost:2380"@ETCD_LISTEN_PEER_URLS="http://192.168.7.11:2380"@'</span> /etc/etcd/etcd.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@ETCD_LISTEN_CLIENT_URLS="http://localhost:2379"@ETCD_LISTEN_CLIENT_URLS="http://192.168.7.11:2379"@'</span> /etc/etcd/etcd.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@ETCD_NAME="default"@ETCD_NAME="controller"@'</span> /etc/etcd/etcd.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@#ETCD_INITIAL_ADVERTISE_PEER_URLS="http://localhost:2380"@ETCD_INITIAL_ADVERTISE_PEER_URLS="http://192.168.7.11:2380"@'</span> /etc/etcd/etcd.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@ETCD_ADVERTISE_CLIENT_URLS="http://localhost:2379"@ETCD_ADVERTISE_CLIENT_URLS="http://192.168.7.11:2379"@'</span>  /etc/etcd/etcd.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@#ETCD_INITIAL_CLUSTER="default=http://localhost:2380"@ETCD_INITIAL_CLUSTER="controller=http://192.168.7.11:2380"@'</span> /etc/etcd/etcd.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@#ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"@ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"@'</span> /etc/etcd/etcd.conf</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">'s@#ETCD_INITIAL_CLUSTER_STATE="new"@ETCD_INITIAL_CLUSTER_STATE="new"@'</span> /etc/etcd/etcd.conf</span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/etcd/etcd.conf </span><br><span class="line"></span><br><span class="line">#[Member]</span><br><span class="line">ETCD_DATA_DIR=<span class="string">"/var/lib/etcd/default.etcd"</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">"http://192.168.7.11:2380"</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">"http://192.168.7.11:2379"</span></span><br><span class="line">ETCD_NAME=<span class="string">"controller"</span></span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">"http://192.168.7.11:2380"</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">"http://192.168.7.11:2379"</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">"controller=http://192.168.7.11:2380"</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=<span class="string">"etcd-cluster"</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">"new"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="启动etcd服务并开机启动"><a href="#启动etcd服务并开机启动" class="headerlink" title="启动etcd服务并开机启动"></a>启动etcd服务并开机启动</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="builtin-name">enable</span> etcd</span><br><span class="line">systemctl start etcd</span><br></pre></td></tr></table></figure>
<h1 id="Keystone-认证服务"><a href="#Keystone-认证服务" class="headerlink" title="Keystone 认证服务"></a>Keystone 认证服务</h1><p>在 controller 执行<br><a href="https://docs.openstack.org/keystone/queens/install/keystone-install-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/keystone/queens/install/keystone-install-rdo.html</a> </p>
<h2 id="创建keystone数据库并授权"><a href="#创建keystone数据库并授权" class="headerlink" title="创建keystone数据库并授权"></a>创建keystone数据库并授权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> keystone;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'KEYSTONE_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'KEYSTONE_DBPASS'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="安装-keystone-httpd"><a href="#安装-keystone-httpd" class="headerlink" title="安装 keystone httpd"></a>安装 keystone httpd</h2><p>Apache HTTP认证服务器<br>默认端口为5000和35357<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openstack-keystone httpd mod_wsgi openstack-utils -y</span><br></pre></td></tr></table></figure></p>
<h2 id="keystone-conf配置"><a href="#keystone-conf配置" class="headerlink" title="keystone.conf配置"></a>keystone.conf配置</h2><p>快速处理脚本<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="keyword">set</span> /etc/keystone/keystone.conf database connection mysql+pymysql:<span class="comment">//keystone:KEYSTONE_DBPASS@controller/keystone</span></span><br><span class="line">openstack-config --set /etc/keystone/keystone.conf <span class="comment">token provider fernet</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/keystone/keystone.conf </span><br><span class="line"></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone</span><br><span class="line"></span><br><span class="line">[token]</span><br><span class="line">provider = fernet</span><br></pre></td></tr></table></figure></p>
<h2 id="初始化keystone数据库"><a href="#初始化keystone数据库" class="headerlink" title="初始化keystone数据库"></a>初始化keystone数据库</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">su</span> -s /bin/<span class="keyword">sh</span> -c <span class="string">"keystone-manage db_sync"</span> keystone</span><br></pre></td></tr></table></figure>
<h2 id="初始化Fernet-keys"><a href="#初始化Fernet-keys" class="headerlink" title="初始化Fernet keys"></a>初始化Fernet keys</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage fernet_setup --keystone-<span class="keyword">user</span> <span class="title">keystone</span> --keystone-<span class="keyword">group</span> <span class="title">keystone</span></span><br><span class="line">keystone-manage credential_setup --keystone-<span class="keyword">user</span> <span class="title">keystone</span> --keystone-<span class="keyword">group</span> <span class="title">keystone</span></span><br></pre></td></tr></table></figure>
<h2 id="初始化身份认证服务"><a href="#初始化身份认证服务" class="headerlink" title="初始化身份认证服务"></a>初始化身份认证服务</h2><p>bootstrap服务，用于api访问<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage bootstrap --bootstrap-password ADMIN_PASS \</span><br><span class="line">  -<span class="ruby">-bootstrap-admin-url <span class="symbol">http:</span>/<span class="regexp">/controller:35357/v</span>3/ \</span></span><br><span class="line"><span class="ruby">  --bootstrap-internal-url <span class="symbol">http:</span>/<span class="regexp">/controller:5000/v</span>3/ \</span></span><br><span class="line"><span class="ruby">  --bootstrap-public-url <span class="symbol">http:</span>/<span class="regexp">/controller:5000/v</span>3/ \</span></span><br><span class="line"><span class="ruby">  --bootstrap-region-id RegionOne</span></span><br></pre></td></tr></table></figure></p>
<h2 id="配置httpd"><a href="#配置httpd" class="headerlink" title="配置httpd"></a>配置httpd</h2><h3 id="修改ServerName"><a href="#修改ServerName" class="headerlink" title="修改ServerName"></a>修改ServerName</h3><p>快速处理脚本<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'/#ServerName www.example.com:80/iServerName controller'</span> <span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>httpd.conf</span><br></pre></td></tr></table></figure></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grep</span> ^ServerName <span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>httpd.conf</span><br><span class="line">ServerName controller</span><br></pre></td></tr></table></figure>
<h3 id="创建软链接-usr-share-keystone-wsgi-keystone-conf"><a href="#创建软链接-usr-share-keystone-wsgi-keystone-conf" class="headerlink" title="创建软链接/usr/share/keystone/wsgi-keystone.conf"></a>创建软链接/usr/share/keystone/wsgi-keystone.conf</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>share<span class="regexp">/keystone/</span>wsgi-keystone.conf <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span></span><br></pre></td></tr></table></figure>
<h3 id="启动-Apache-HTTP-服务并配置其随系统启动"><a href="#启动-Apache-HTTP-服务并配置其随系统启动" class="headerlink" title="启动 Apache HTTP 服务并配置其随系统启动"></a>启动 Apache HTTP 服务并配置其随系统启动</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">enable</span> <span class="selector-tag">httpd</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">start</span> <span class="selector-tag">httpd</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure>
<h3 id="配置管理帐户"><a href="#配置管理帐户" class="headerlink" title="配置管理帐户"></a>配置管理帐户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=ADMIN_PASS</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:35357/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br></pre></td></tr></table></figure>
<h2 id="创建域、项目、用户和角色"><a href="#创建域、项目、用户和角色" class="headerlink" title="创建域、项目、用户和角色"></a>创建域、项目、用户和角色</h2><h3 id="创建域"><a href="#创建域" class="headerlink" title="创建域"></a>创建域</h3><p>已存在“默认”域，但创建新域的正式方法是<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">openstack domain create --description <span class="string">"An Example Domain"</span> example</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field       </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">|<span class="string"> description </span>|<span class="string"> An Example Domain                </span>|</span><br><span class="line">|<span class="string"> enabled     </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id          </span>|<span class="string"> 4e07cb0139e947a7b62479073806f305 </span>|</span><br><span class="line">|<span class="string"> name        </span>|<span class="string"> example                          </span>|</span><br><span class="line">|<span class="string"> tags        </span>|<span class="string"> []                               </span>|</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="创建Service项目"><a href="#创建Service项目" class="headerlink" title="创建Service项目"></a>创建Service项目</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack project create --domain<span class="built_in"> default </span>--description <span class="string">"Service Project"</span> service</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description |<span class="built_in"> Service </span>Project                  |</span><br><span class="line">| domain_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | 6ba7281b4b784118a67641f304a6d8fc |</span><br><span class="line">| is_domain   | <span class="literal">False</span>                            |</span><br><span class="line">| name        |<span class="built_in"> service </span>                         |</span><br><span class="line">| parent_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建demo项目"><a href="#创建demo项目" class="headerlink" title="创建demo项目"></a>创建demo项目</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack project create --domain<span class="built_in"> default </span>--description <span class="string">"Demo Project"</span> demo</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Demo Project                     |</span><br><span class="line">| domain_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | fc0b58a87559424399e26f0e833f0429 |</span><br><span class="line">| is_domain   | <span class="literal">False</span>                            |</span><br><span class="line">| name        | demo                             |</span><br><span class="line">| parent_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建demo用户"><a href="#创建demo用户" class="headerlink" title="创建demo用户"></a>创建demo用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span>--password-prompt demo</span><br><span class="line"></span><br><span class="line">User Password: #密码配置：DEMO_PASS</span><br><span class="line">Repeat<span class="built_in"> User </span>Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | d441c74843ea4da9a21f90499cb43fb5 |</span><br><span class="line">| name                | demo                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建用户角色"><a href="#创建用户角色" class="headerlink" title="创建用户角色"></a>创建用户角色</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openstack role create user</span><br><span class="line"></span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | None                             |</span><br><span class="line">| id        | 9d2ec4ead71e4c46a3fc42b08eed1aba |</span><br><span class="line">| name      |<span class="built_in"> user </span>                            |</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="将用户规则user附加给用户demo"><a href="#将用户规则user附加给用户demo" class="headerlink" title="将用户规则user附加给用户demo"></a>将用户规则user附加给用户demo</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">role</span> <span class="title">add</span> --project demo --<span class="keyword">user</span> <span class="title">demo</span> user</span><br></pre></td></tr></table></figure>
<p>注：这个命令执行后没有输出。</p>
<h2 id="验证操作"><a href="#验证操作" class="headerlink" title="验证操作"></a>验证操作</h2><h3 id="取消设置临时OS-AUTH-URL和OS-PASSWORD环境变量"><a href="#取消设置临时OS-AUTH-URL和OS-PASSWORD环境变量" class="headerlink" title="取消设置临时OS_AUTH_URL和OS_PASSWORD环境变量"></a>取消设置临时OS_AUTH_URL和OS_PASSWORD环境变量</h3><p>此操作为了验证确保其它组件安装正常<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> OS_AUTH_URL OS_PASSWORD</span><br></pre></td></tr></table></figure></p>
<h3 id="获取admin用户的令牌"><a href="#获取admin用户的令牌" class="headerlink" title="获取admin用户的令牌"></a>获取admin用户的令牌</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">openstack --os-auth-url http://controller:35357/v3 \</span><br><span class="line">--os-project-domain-name Default --os-user-domain-name Default \</span><br><span class="line">--os-project-name admin --os-username admin token issue</span><br><span class="line"></span><br><span class="line">Password:  #密码配置为：ADMIN<span class="emphasis">_PASS</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| Field      | Value                                                                                                                                                                                   |</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| expires    | 2018-07-12T15:38:39+0000                                                                                                                                                                |</span></span><br><span class="line"><span class="emphasis">| id         | gAAAAABbR2fvxfr47jzQWswuY_</span>tbelrEKaohloWokuHFVYTOYK<span class="emphasis">_jX9jxy7g_</span>ijwL1fUGUwsBaF5qwLZDvjiQk8hl5R1lkm2b1dje<span class="emphasis">_GG7bX3QRtbrp7m8B-aWvLyaje7yYB0nuXJv9P-HuZ7YVM8U8XRvrFjfaKOtvQ3DpyhF81djABYIeUTfJMg |</span></span><br><span class="line"><span class="emphasis">| project_</span>id | 397ed95bb8d244fc924fb974235c6661                                                                                                                                                        |</span><br><span class="line">| user<span class="emphasis">_id    | fa5af0071d424540af93d9c919721dc3                                                                                                                                                        |</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<h2 id="获取demo用户的令牌"><a href="#获取demo用户的令牌" class="headerlink" title="获取demo用户的令牌"></a>获取demo用户的令牌</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">openstack --os-auth-url http://controller:5000/v3 \</span><br><span class="line">--os-project-domain-name Default --os-user-domain-name Default \</span><br><span class="line">--os-project-name demo --os-username demo token issue</span><br><span class="line"></span><br><span class="line">Password: #密码配置为：DEMO<span class="emphasis">_PASS</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| Field      | Value                                                                                                                                                                                   |</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| expires    | 2018-07-12T15:39:49+0000                                                                                                                                                                |</span></span><br><span class="line"><span class="emphasis">| id         | gAAAAABbR2g1PYBAtYoiE8yGss1-myGMbHnoMezSmYeBSyPbqFlTj87LnVdCv5J-_</span>s9-h4m35M1JZhJcT8bvVUunO4GsNheLLUod3ZshSgbkpFXbZqUCS9ul288<span class="emphasis">_T8lapvG8Dt0i5CFNLPwQdlrcpuSvS3WpCceE1LDrqPIFrv0UJ4P6a0cxowc |</span></span><br><span class="line"><span class="emphasis">| project_</span>id | fc0b58a87559424399e26f0e833f0429                                                                                                                                                        |</span><br><span class="line">| user<span class="emphasis">_id    | d441c74843ea4da9a21f90499cb43fb5                                                                                                                                                        |</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<h2 id="创建-OpenStack-客户端环境脚本"><a href="#创建-OpenStack-客户端环境脚本" class="headerlink" title="创建 OpenStack 客户端环境脚本"></a>创建 OpenStack 客户端环境脚本</h2><h3 id="创建-admin-openrc"><a href="#创建-admin-openrc" class="headerlink" title="创建 admin-openrc"></a>创建 admin-openrc</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; admin-openrc</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=ADMIN_PASS</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="创建-demo-openrc"><a href="#创建-demo-openrc" class="headerlink" title="创建 demo-openrc"></a>创建 demo-openrc</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=demo</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=demo</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=DEMO_PASS</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br></pre></td></tr></table></figure>
<h3 id="使用脚本-返回认证token"><a href="#使用脚本-返回认证token" class="headerlink" title="使用脚本,返回认证token"></a>使用脚本,返回认证token</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br><span class="line">openstack token issue</span><br><span class="line"></span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> Field      </span>|<span class="string"> Value                                                                                                                                                                                   </span>|</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> expires    </span>|<span class="string"> 2018-07-12T15:45:11+0000                                                                                                                                                                </span>|</span><br><span class="line">|<span class="string"> id         </span>|<span class="string"> gAAAAABbR2l3EuIJ8ih_92Y_wjXlFR3DWO0NmOFuPKlXgfkY04rFvr4dun424ftukZR6stk4qFGZD_H6TYmr_obeth6BbKYNczz1D0TwjRq-R12OedXVAeHpdPymkEHwnMayCBkE9aynkYH7tbAKovMLjsPXM5RnQl6YHYBa6FdkFAZfLQdGm6A </span>|</span><br><span class="line">|<span class="string"> project_id </span>|<span class="string"> 397ed95bb8d244fc924fb974235c6661                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> user_id    </span>|<span class="string"> fa5af0071d424540af93d9c919721dc3                                                                                                                                                        </span>|</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h1 id="Glance-镜像服务"><a href="#Glance-镜像服务" class="headerlink" title="Glance 镜像服务"></a>Glance 镜像服务</h1><p>在 controller 执行<br><a href="https://docs.openstack.org/glance/queens/install/install-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/glance/queens/install/install-rdo.html</a> </p>
<h2 id="创建glance数据库并授权"><a href="#创建glance数据库并授权" class="headerlink" title="创建glance数据库并授权"></a>创建glance数据库并授权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> glance;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'GLANCE_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'GLANCE_DBPASS'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="创建glance用户"><a href="#创建glance用户" class="headerlink" title="创建glance用户"></a>创建glance用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br><span class="line">openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span>--password-prompt glance</span><br><span class="line"></span><br><span class="line">User Password: #密码配置为：GLANCE_PASS</span><br><span class="line">Repeat<span class="built_in"> User </span>Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | 7210fe22f28f483baec3fbd0a583300b |</span><br><span class="line">| name                | glance                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="添加-admin-角色到-glance-用户和-service-项目上"><a href="#添加-admin-角色到-glance-用户和-service-项目上" class="headerlink" title="添加 admin 角色到 glance 用户和 service 项目上"></a>添加 admin 角色到 glance 用户和 service 项目上</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user glance admin</span><br></pre></td></tr></table></figure>
<h3 id="创建glance服务"><a href="#创建glance服务" class="headerlink" title="创建glance服务"></a>创建glance服务</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">openstack<span class="built_in"> service </span>create --name glance --description <span class="string">"OpenStack Image"</span> image</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Image                  |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | 3b955fc4bf384c098e4bc995967b52a9 |</span><br><span class="line">| name        | glance                           |</span><br><span class="line">|<span class="built_in"> type </span>       | image                            |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="创建镜像服务的-API-端点"><a href="#创建镜像服务的-API-端点" class="headerlink" title="创建镜像服务的 API 端点"></a>创建镜像服务的 API 端点</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne image public http://controller:9292</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 49e262cbc7f8434ea55a0e18a59a479a </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 7d89071e87924ef5acb01be67eb3595e </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> glance                           </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> image                            </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9292           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne image internal http://controller:9292</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> d93e537348834231a9f4eda12e1f336e </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 7d89071e87924ef5acb01be67eb3595e </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> glance                           </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> image                            </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9292           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne image admin http://controller:9292</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> fb2f66e0da7a4692a3db3446c8976256 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> admin                            </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 7d89071e87924ef5acb01be67eb3595e </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> glance                           </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> image                            </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9292           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="安装glance"><a href="#安装glance" class="headerlink" title="安装glance"></a>安装glance</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openstack-glance -y</span><br></pre></td></tr></table></figure>
<h2 id="配置glance-api-conf"><a href="#配置glance-api-conf" class="headerlink" title="配置glance-api.conf"></a>配置glance-api.conf</h2><p>快速处理脚本<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="keyword">set</span> /etc/glance/glance-api.conf database connection mysql+pymysql:<span class="comment">//glance:GLANCE_DBPASS@controller/glance</span></span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf <span class="comment">keystone_authtoken auth_uri http:</span>//<span class="comment">controller:5000</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken auth_url http:<span class="comment">//controller:35357</span></span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken memcached_servers controller:11211</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken project_domain_name default</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken project_name service</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken username glance</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken password GLANCE_PASS</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">glance</span>/glance-api.conf paste_deploy flavor keystone</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf glance_store stores file,http</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">glance</span>/glance-api.conf glance_store default_store <span class="keyword">file</span></span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf glance_store filesystem_store_datadir</span> /var/<span class="comment">lib</span>/glance/<span class="comment">images</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/glance/glance-api.conf</span><br><span class="line"></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql:<span class="comment">//glance:GLANCE_DBPASS@controller/glance</span></span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_uri = http:<span class="comment">//controller:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//controller:35357</span></span><br><span class="line">memcached_servers = controller:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = GLANCE_PASS</span><br><span class="line"></span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor = keystone</span><br><span class="line"></span><br><span class="line">[glance_store]</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file</span><br><span class="line">filesystem_store_datadir = /var/lib/glance/images</span><br></pre></td></tr></table></figure>
<p>端口：9292</p>
<h2 id="配置glance-registry-conf"><a href="#配置glance-registry-conf" class="headerlink" title="配置glance-registry.conf"></a>配置glance-registry.conf</h2><p>快速处理脚本<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> database connection mysql+pymysql:<span class="string">//glance</span><span class="function">:GLANCE_DBPASS</span>@controller/glance</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken auth_uri http:<span class="string">//controller</span><span class="function">:5000</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken auth_url http:<span class="string">//controller</span><span class="function">:35357</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken memcached_servers controller<span class="function">:11211</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken auth_type password</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken project_name service</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken username glance</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> keystone_authtoken password GLANCE_PASS</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/glance/glance-registry.conf</span> paste_<span class="keyword">deploy</span> flavor keystone</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/glance/glance-registry.conf </span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql:<span class="comment">//glance:GLANCE_DBPASS@controller/glance</span></span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_uri = http:<span class="comment">//controller:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//controller:35357</span></span><br><span class="line">memcached_servers = controller:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = GLANCE_PASS</span><br><span class="line"></span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor = keystone</span><br></pre></td></tr></table></figure>
<p>端口：9191</p>
<h2 id="初始化glance数据库"><a href="#初始化glance数据库" class="headerlink" title="初始化glance数据库"></a>初始化glance数据库</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">su</span> -s /bin/<span class="keyword">sh</span> -c <span class="string">"glance-manage db_sync"</span> glance</span><br></pre></td></tr></table></figure>
<h2 id="启动glance并开机启动"><a href="#启动glance并开机启动" class="headerlink" title="启动glance并开机启动"></a>启动glance并开机启动</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable openstack-glance-api<span class="selector-class">.service</span> openstack-glance-registry.service</span><br><span class="line">systemctl start openstack-glance-api<span class="selector-class">.service</span> openstack-glance-registry.service</span><br></pre></td></tr></table></figure>
<h2 id="验证操作-1"><a href="#验证操作-1" class="headerlink" title="验证操作"></a>验证操作</h2><h3 id="导入admin-openrc凭证"><a href="#导入admin-openrc凭证" class="headerlink" title="导入admin-openrc凭证"></a>导入admin-openrc凭证</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">. </span>admin-openrc</span><br></pre></td></tr></table></figure>
<h3 id="下载源镜像"><a href="#下载源镜像" class="headerlink" title="下载源镜像"></a>下载源镜像</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>download.cirros-cloud.net<span class="regexp">/0.4.0/</span>cirros-<span class="number">0.4</span>.<span class="number">0</span>-x86_64-disk.img</span><br></pre></td></tr></table></figure>
<h3 id="上传镜像"><a href="#上传镜像" class="headerlink" title="上传镜像"></a>上传镜像</h3><p>使用 QCOW2 磁盘格式， bare 容器格式上传镜像到镜像服务并设置公共可见，这样所有的项目都可以访问它</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">openstack image create <span class="string">"cirros"</span> \</span><br><span class="line">  --file cirros-0.4.0-x86_64-disk.img \</span><br><span class="line">  --disk-format qcow2 --container-format bare \</span><br><span class="line">  --public</span><br><span class="line"></span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">|<span class="string"> Field            </span>|<span class="string"> Value                                                </span>|</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">|<span class="string"> checksum         </span>|<span class="string"> 443b7623e27ecf03dc9e01ee93f67afe                     </span>|</span><br><span class="line">|<span class="string"> container_format </span>|<span class="string"> bare                                                 </span>|</span><br><span class="line">|<span class="string"> created_at       </span>|<span class="string"> 2018-07-13T02:46:27Z                                 </span>|</span><br><span class="line">|<span class="string"> disk_format      </span>|<span class="string"> qcow2                                                </span>|</span><br><span class="line">|<span class="string"> file             </span>|<span class="string"> /v2/images/c1489536-e12d-4323-8fb5-14128f4d8d5e/file </span>|</span><br><span class="line">|<span class="string"> id               </span>|<span class="string"> c1489536-e12d-4323-8fb5-14128f4d8d5e                 </span>|</span><br><span class="line">|<span class="string"> min_disk         </span>|<span class="string"> 0                                                    </span>|</span><br><span class="line">|<span class="string"> min_ram          </span>|<span class="string"> 0                                                    </span>|</span><br><span class="line">|<span class="string"> name             </span>|<span class="string"> cirros                                               </span>|</span><br><span class="line">|<span class="string"> owner            </span>|<span class="string"> 397ed95bb8d244fc924fb974235c6661                     </span>|</span><br><span class="line">|<span class="string"> protected        </span>|<span class="string"> False                                                </span>|</span><br><span class="line">|<span class="string"> schema           </span>|<span class="string"> /v2/schemas/image                                    </span>|</span><br><span class="line">|<span class="string"> size             </span>|<span class="string"> 12716032                                             </span>|</span><br><span class="line">|<span class="string"> status           </span>|<span class="string"> active                                               </span>|</span><br><span class="line">|<span class="string"> tags             </span>|<span class="string">                                                      </span>|</span><br><span class="line">|<span class="string"> updated_at       </span>|<span class="string"> 2018-07-13T02:46:28Z                                 </span>|</span><br><span class="line">|<span class="string"> virtual_size     </span>|<span class="string"> None                                                 </span>|</span><br><span class="line">|<span class="string"> visibility       </span>|<span class="string"> public                                               </span>|</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="查看上传的镜像"><a href="#查看上传的镜像" class="headerlink" title="查看上传的镜像"></a>查看上传的镜像</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack image list </span><br><span class="line"></span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br><span class="line">| c1489536-e12d-4323-8fb5-14128f4d8d5e | cirros | active |</span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br></pre></td></tr></table></figure>
<p><a href="https://docs.openstack.org/glance/queens/configuration/index.html" target="_blank" rel="noopener">https://docs.openstack.org/glance/queens/configuration/index.html</a></p>
<h1 id="Nova-Controller"><a href="#Nova-Controller" class="headerlink" title="Nova Controller"></a>Nova Controller</h1><p>在<code>controller</code>控制节点执行<br><a href="https://docs.openstack.org/nova/queens/install/controller-install-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/nova/queens/install/controller-install-rdo.html</a></p>
<h2 id="创建nova等数据库并授权"><a href="#创建nova等数据库并授权" class="headerlink" title="创建nova等数据库并授权"></a>创建nova等数据库并授权</h2><p>创建nova_api, nova, nova_cell0<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_api;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_cell0;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NOVA_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NOVA_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span>  <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NOVA_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NOVA_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NOVA_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span>  <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NOVA_DBPASS'</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="创建nova"><a href="#创建nova" class="headerlink" title="创建nova"></a>创建nova</h2><h3 id="创建nova用户"><a href="#创建nova用户" class="headerlink" title="创建nova用户"></a>创建nova用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br><span class="line">openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span>--password-prompt nova </span><br><span class="line"></span><br><span class="line">User Password: #密码配置为：NOVA_PASS</span><br><span class="line">Repeat<span class="built_in"> User </span>Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | c3cb8b7a6d9a4a65a603028d7a170a67 |</span><br><span class="line">| name                | nova                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="添加nova为管理员权限"><a href="#添加nova为管理员权限" class="headerlink" title="添加nova为管理员权限"></a>添加nova为管理员权限</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user nova admin</span><br></pre></td></tr></table></figure>
<h3 id="创建nova服务"><a href="#创建nova服务" class="headerlink" title="创建nova服务"></a>创建nova服务</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> openstack<span class="built_in"> service </span>create --name nova --description <span class="string">"OpenStack Compute"</span> compute</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute                |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | 584f29fd4e784c67b0ca7cfc7506cb13 |</span><br><span class="line">| name        | nova                             |</span><br><span class="line">|<span class="built_in"> type </span>       | compute                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建nova-api"><a href="#创建nova-api" class="headerlink" title="创建nova api"></a>创建nova api</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> b097b4d65bd847d18bfe7d113e3bf040 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 584f29fd4e784c67b0ca7cfc7506cb13 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> nova                             </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> compute                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8774/v2.1      </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> b097b4d65bd847d18bfe7d113e3bf040 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 584f29fd4e784c67b0ca7cfc7506cb13 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> nova                             </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> compute                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8774/v2.1      </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> a1d0c23b7bdd46d4bb8018338a40289b </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 584f29fd4e784c67b0ca7cfc7506cb13 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> nova                             </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> compute                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8774/v2.1      </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="创建placement"><a href="#创建placement" class="headerlink" title="创建placement"></a>创建placement</h2><h3 id="创建Placement用户"><a href="#创建Placement用户" class="headerlink" title="创建Placement用户"></a>创建Placement用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span>--password-prompt placement</span><br><span class="line"></span><br><span class="line">User Password: #密码配置为：PLACEMENT_PASS </span><br><span class="line">Repeat<span class="built_in"> User </span>Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | 3d702a3aa8aa45e695bff7600a2511a2 |</span><br><span class="line">| name                | placement                        |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="添加placement用户为项目服务admin角色"><a href="#添加placement用户为项目服务admin角色" class="headerlink" title="添加placement用户为项目服务admin角色"></a>添加placement用户为项目服务admin角色</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user placement admin</span><br></pre></td></tr></table></figure>
<h3 id="创建placement-api服务"><a href="#创建placement-api服务" class="headerlink" title="创建placement api服务"></a>创建placement api服务</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> openstack<span class="built_in"> service </span>create --name placement --description <span class="string">"Placement API"</span> placement</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API                    |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | 3b783948e92f4953808cc96a9e4eb848 |</span><br><span class="line">| name        | placement                        |</span><br><span class="line">|<span class="built_in"> type </span>       | placement                        |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建placement-api"><a href="#创建placement-api" class="headerlink" title="创建placement api"></a>创建placement api</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne placement public http://controller:8778</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> c5c31a3c89444c0aab1163400f1cf9de </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 3b783948e92f4953808cc96a9e4eb848 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8778           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne placement internal http://controller:8778</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 2efc01499ec24037b5007df8507372e5 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 3b783948e92f4953808cc96a9e4eb848 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8778           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne placement admin http://controller:8778</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 53fcdec1097e48789015ceba8b086bf0 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> admin                            </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 3b783948e92f4953808cc96a9e4eb848 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8778           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="安装配置nova"><a href="#安装配置nova" class="headerlink" title="安装配置nova"></a>安装配置nova</h2><h3 id="安装nova组件"><a href="#安装nova组件" class="headerlink" title="安装nova组件"></a>安装nova组件</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install openstack-nova-api openstack-nova-conductor <span class="string">\</span></span><br><span class="line">openstack-nova-<span class="built_in">console</span> openstack-nova-novncproxy <span class="string">\</span></span><br><span class="line">openstack-nova-scheduler openstack-nova-placement-api -y</span><br></pre></td></tr></table></figure>
<h3 id="配置nova-conf"><a href="#配置nova-conf" class="headerlink" title="配置nova.conf"></a>配置nova.conf</h3><p>快速处理脚本<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> api_database connection mysql+pymysql:<span class="comment">//nova:NOVA_DBPASS@controller/nova_api</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> database connection mysql+pymysql:<span class="comment">//nova:NOVA_DBPASS@controller/nova</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT transport_url rabbit:<span class="comment">//openstack:RABBIT_PASS@controller</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> api auth_strategy keystone</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken auth_uri http:<span class="comment">//controller:5000</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken auth_url http:<span class="comment">//controller:35357</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken memcached_servers controller:<span class="number">11211</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken username nova</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken password NOVA_PASS</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT my_ip <span class="number">192.168</span>.<span class="number">7.11</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT use_neutron True</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT firewall_driver nova<span class="selector-class">.virt</span><span class="selector-class">.firewall</span><span class="selector-class">.NoopFirewallDriver</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> vnc enabled true</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> vnc vncserver_listen <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> vnc vncserver_proxyclient_address \<span class="variable">$my_ip</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> glance api_servers http:<span class="comment">//controller:9292</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement os_region_name RegionOne</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement project_domain_name Default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement user_domain_name Default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement auth_url http:<span class="comment">//controller:35357/v3</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement username placement</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement password PLACEMENT_PASS</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nova/nova.conf </span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:RABBIT_PASS@controller</span></span><br><span class="line">my_ip = <span class="number">192.168</span>.7.11</span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"></span><br><span class="line">[api_database]</span><br><span class="line">connection = mysql+pymysql:<span class="comment">//nova:NOVA_DBPASS@controller/nova_api</span></span><br><span class="line"></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql:<span class="comment">//nova:NOVA_DBPASS@controller/nova</span></span><br><span class="line"></span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_url = http:<span class="comment">//controller:5000/v3</span></span><br><span class="line">memcached_servers = controller:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = NOVA_PASS</span><br><span class="line"></span><br><span class="line">[vnc]</span><br><span class="line">enabled = <span class="keyword">true</span></span><br><span class="line">server_listen = <span class="number">0.0</span>.0.0</span><br><span class="line">server_proxyclient_address = $my_ip</span><br><span class="line"></span><br><span class="line">[glance]</span><br><span class="line">api_servers = http:<span class="comment">//controller:9292</span></span><br><span class="line"></span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line">[placement]</span><br><span class="line">os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http:<span class="comment">//controller:35357/v3</span></span><br><span class="line">username = placement</span><br><span class="line">password = PLACEMENT_PASS</span><br></pre></td></tr></table></figure>
<h2 id="配置httpd-nova-placement-api-conf"><a href="#配置httpd-nova-placement-api-conf" class="headerlink" title="配置httpd nova-placement-api.conf"></a>配置httpd nova-placement-api.conf</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="params">&lt;&lt; EOF &gt;</span> <span class="meta-keyword">/etc/</span>httpd/conf.d/<span class="number">00</span>-nova-placement-api.conf</span><br><span class="line">Listen <span class="number">8778</span></span><br><span class="line"><span class="params">&lt;VirtualHost *:<span class="number">8778</span>&gt;</span></span><br><span class="line">    WSGIProcessGroup nova-placement-api</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line">    WSGIDaemonProcess nova-placement-api processes=<span class="number">3</span> threads=<span class="number">1</span> user=nova group=nova</span><br><span class="line">    WSGIScriptAlias / <span class="meta-keyword">/usr/</span>bin/nova-placement-api</span><br><span class="line"><span class="params">&lt;IfVersion &gt;</span>= <span class="number">2.4</span>&gt;</span><br><span class="line">    ErrorLogFormat “%M”</span><br><span class="line"><span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line">    ErrorLog <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/nova/</span>nova-placement-api.log</span><br><span class="line">    <span class="meta">#SSLEngine On</span></span><br><span class="line">    <span class="meta">#SSLCertificateFile …</span></span><br><span class="line">    <span class="meta">#SSLCertificateKeyFile …</span></span><br><span class="line"><span class="params">&lt;/VirtualHost&gt;</span></span><br><span class="line">Alias /nova-placement-api <span class="meta-keyword">/usr/</span>bin/nova-placement-api</span><br><span class="line"><span class="params">&lt;Location /nova-placement-api&gt;</span></span><br><span class="line">    SetHandler wsgi-script</span><br><span class="line">    Options +ExecCGI</span><br><span class="line">    WSGIProcessGroup nova-placement-api</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line"><span class="params">&lt;/Location&gt;</span></span><br><span class="line"><span class="params">&lt;Directory /usr/bin&gt;</span></span><br><span class="line">   <span class="params">&lt;IfVersion &gt;</span>= <span class="number">2.4</span>&gt;</span><br><span class="line">      Require all granted</span><br><span class="line">   <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line">   <span class="params">&lt;IfVersion &lt; <span class="number">2.4</span>&gt;</span></span><br><span class="line">      Order allow,deny</span><br><span class="line">      Allow from all</span><br><span class="line">   <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line"><span class="params">&lt;/Directory&gt;</span> </span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">systemctl restart httpd</span></span><br></pre></td></tr></table></figure>
<h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><h3 id="初始化nova-api数据库"><a href="#初始化nova-api数据库" class="headerlink" title="初始化nova-api数据库"></a>初始化nova-api数据库</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c <span class="string">"nova-manage api_db sync"</span> nova</span><br><span class="line"></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">python2</span>.7/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">oslo_db</span>/<span class="title">sqlalchemy</span>/<span class="title">enginefacade</span>.<span class="title">py</span>:332: <span class="title">NotSupportedWarning</span>: <span class="title">Configuration</span> <span class="title">option</span>(<span class="title">s</span>) ['<span class="title">use_tpool</span>'] <span class="title">not</span> <span class="title">supported</span></span></span><br><span class="line">  exception.NotSupportedWarning</span><br></pre></td></tr></table></figure>
<h3 id="注册cell0数据库"><a href="#注册cell0数据库" class="headerlink" title="注册cell0数据库"></a>注册cell0数据库</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">su</span> -s /bin/<span class="keyword">sh</span> -c <span class="string">"nova-manage cell_v2 map_cell0"</span> nova</span><br></pre></td></tr></table></figure>
<h3 id="创建cell1-cell"><a href="#创建cell1-cell" class="headerlink" title="创建cell1 cell"></a>创建cell1 cell</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">su</span> -s /<span class="keyword">bin/sh </span>-c <span class="string">"nova-manage cell_v2 create_cell --name=cell1 --verbose"</span> nova</span><br><span class="line"></span><br><span class="line"><span class="symbol">e1657af2</span>-a716-<span class="number">49</span><span class="built_in">f7</span>-a3cf-a2eb71af7c80</span><br></pre></td></tr></table></figure>
<h3 id="初始化nova数据库"><a href="#初始化nova数据库" class="headerlink" title="初始化nova数据库"></a>初始化nova数据库</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">su</span> -s /bin/<span class="keyword">sh</span> -c <span class="string">"nova-manage db sync"</span> nova</span><br></pre></td></tr></table></figure>
<h3 id="验证nova-cell0和cell1"><a href="#验证nova-cell0和cell1" class="headerlink" title="验证nova cell0和cell1"></a>验证nova cell0和cell1</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nova-manage cell_v2 list_cells</span><br><span class="line"></span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+</span><br><span class="line">|<span class="string">  Name </span>|<span class="string">                 UUID                 </span>|<span class="string">           Transport URL            </span>|<span class="string">               Database Connection               </span>|</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+</span><br><span class="line">|<span class="string"> cell0 </span>|<span class="string"> 00000000-0000-0000-0000-000000000000 </span>|<span class="string">               none:/               </span>|<span class="string"> mysql+pymysql://nova:****@controller/nova_cell0 </span>|</span><br><span class="line">|<span class="string"> cell1 </span>|<span class="string"> e1657af2-a716-49f7-a3cf-a2eb71af7c80 </span>|<span class="string"> rabbit://openstack:****@controller </span>|<span class="string">    mysql+pymysql://nova:****@controller/nova    </span>|</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="启动nove等并开机启动"><a href="#启动nove等并开机启动" class="headerlink" title="启动nove等并开机启动"></a>启动nove等并开机启动</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable openstack-nova-api<span class="selector-class">.service</span> openstack-nova-consoleauth<span class="selector-class">.service</span> \</span><br><span class="line">openstack-nova-scheduler<span class="selector-class">.service</span> openstack-nova-conductor<span class="selector-class">.service</span> openstack-nova-novncproxy.service</span><br><span class="line">systemctl start openstack-nova-api<span class="selector-class">.service</span> openstack-nova-consoleauth<span class="selector-class">.service</span> \</span><br><span class="line">openstack-nova-scheduler<span class="selector-class">.service</span> openstack-nova-conductor<span class="selector-class">.service</span> openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure>
<h1 id="Nova-Compute"><a href="#Nova-Compute" class="headerlink" title="Nova Compute"></a>Nova Compute</h1><p>在<code>compute</code>计算节点执行<br><a href="https://docs.openstack.org/nova/queens/install/compute-install-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/nova/queens/install/compute-install-rdo.html</a></p>
<h2 id="安装nova组件-1"><a href="#安装nova组件-1" class="headerlink" title="安装nova组件"></a>安装nova组件</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openstack-nova-<span class="keyword">compute</span> -y</span><br><span class="line">yum <span class="keyword">install</span> openstack-utils -y</span><br></pre></td></tr></table></figure>
<h2 id="配置nova-conf-1"><a href="#配置nova-conf-1" class="headerlink" title="配置nova.conf"></a>配置nova.conf</h2><p>快速处理脚本<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT transport_url rabbit:<span class="comment">//openstack:RABBIT_PASS@controller</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> api auth_strategy keystone</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken auth_uri http:<span class="comment">//controller:5000</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken auth_url http:<span class="comment">//controller:35357</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken memcached_servers controller:<span class="number">11211</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken username nova</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> keystone_authtoken password NOVA_PASS</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT my_ip <span class="number">192.168</span>.<span class="number">7.12</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT use_neutron True</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> DEFAULT firewall_driver nova<span class="selector-class">.virt</span><span class="selector-class">.firewall</span><span class="selector-class">.NoopFirewallDriver</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> vnc enabled True</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> vnc vncserver_listen <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> vnc vncserver_proxyclient_address \<span class="variable">$my_ip</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> vnc novncproxy_base_url http:<span class="comment">//controller:6080/vnc_auto.html</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> glance api_servers http:<span class="comment">//controller:9292</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement os_region_name RegionOne</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement project_domain_name Default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement user_domain_name Default</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement auth_url http:<span class="comment">//controller:35357/v3</span></span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement username placement</span><br><span class="line">openstack-config --set /etc/nova/nova<span class="selector-class">.conf</span> placement password PLACEMENT_PASS</span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/nova/nova.conf </span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br><span class="line">my_ip = 192.168.7.12</span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"></span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = NOVA_PASS</span><br><span class="line"></span><br><span class="line">[vnc]</span><br><span class="line">enabled = True</span><br><span class="line">server_listen = 0.0.0.0</span><br><span class="line">server_proxyclient_address = $my_ip</span><br><span class="line">novncproxy_base_url = http://controller:6080/vnc_auto.html</span><br><span class="line"></span><br><span class="line">[glance]</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line"></span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line">[placement]</span><br><span class="line">os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = PLACEMENT_PASS</span><br></pre></td></tr></table></figure></p>
<p>验证是否支持虚拟化<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">egrep -c <span class="string">'(vmx|svm)'</span> /<span class="keyword">proc</span>/cpuinfo</span><br><span class="line">如果没有输出或者输出0，说明不支持虚拟化，需要使用libvirt而不能用kvm了，如果这样的话更改如下配置；</span><br><span class="line">openstack-config --set /etc/nova/nova.conf<span class="title"> libvirt</span> virt_type<span class="title"> qemu</span></span><br></pre></td></tr></table></figure></p>
<h2 id="启动nova-compute服务并开机启动"><a href="#启动nova-compute服务并开机启动" class="headerlink" title="启动nova-compute服务并开机启动"></a>启动nova-compute服务并开机启动</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable libvirtd<span class="selector-class">.service</span> openstack-nova-compute.service</span><br><span class="line">systemctl start libvirtd<span class="selector-class">.service</span> openstack-nova-compute.service</span><br></pre></td></tr></table></figure>
<h1 id="Nova-Controller配置Compute"><a href="#Nova-Controller配置Compute" class="headerlink" title="Nova Controller配置Compute"></a>Nova Controller配置Compute</h1><h2 id="将compute节点添加到cell数据库"><a href="#将compute节点添加到cell数据库" class="headerlink" title="将compute节点添加到cell数据库"></a>将compute节点添加到cell数据库</h2><p>在<code>controller</code>控制节点执行</p>
<h3 id="确认数据库中有计算主机"><a href="#确认数据库中有计算主机" class="headerlink" title="确认数据库中有计算主机"></a>确认数据库中有计算主机</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br><span class="line">openstack compute service list <span class="params">--service</span> nova-compute</span><br><span class="line"></span><br><span class="line">+<span class="params">----</span>+<span class="params">--------------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">----------------------------</span>+</span><br><span class="line">| ID | Binary       | Host    | Zone | Status  | State | Updated At                 |</span><br><span class="line">+<span class="params">----</span>+<span class="params">--------------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">----------------------------</span>+</span><br><span class="line">|  6 | nova-compute | compute | nova | enabled | up    | 2018-07-13T12<span class="function">:37</span><span class="function">:37.000000</span> |</span><br><span class="line">+<span class="params">----</span>+<span class="params">--------------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">----------------------------</span>+</span><br></pre></td></tr></table></figure>
<h3 id="发现计算主机"><a href="#发现计算主机" class="headerlink" title="发现计算主机"></a>发现计算主机</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> su -s <span class="regexp">/bin/</span>sh -c <span class="string">"nova-manage cell_v2 discover_hosts --verbose"</span> nova</span><br><span class="line"></span><br><span class="line"><span class="regexp">/usr/</span>lib<span class="regexp">/python2.7/</span>site-packages<span class="regexp">/oslo_db/</span>sqlalchemy/enginefacade.<span class="string">py:</span><span class="number">332</span>: <span class="string">NotSupportedWarning:</span> Configuration option(s) [<span class="string">'use_tpool'</span>] not supported</span><br><span class="line">  exception.NotSupportedWarning</span><br><span class="line">Found <span class="number">2</span> cell mappings.</span><br><span class="line">Skipping cell0 since it does not contain hosts.</span><br><span class="line">Getting computes from cell <span class="string">'cell1'</span>: e1657af2-a716<span class="number">-49</span>f7-a3cf-a2eb71af7c80</span><br><span class="line">Checking host mapping <span class="keyword">for</span> compute host <span class="string">'compute'</span>: fe58ddc1<span class="number">-1</span>d65<span class="number">-4</span>f87<span class="number">-9456</span>-bc040dc106b3</span><br><span class="line">Creating host mapping <span class="keyword">for</span> compute host <span class="string">'compute'</span>: fe58ddc1<span class="number">-1</span>d65<span class="number">-4</span>f87<span class="number">-9456</span>-bc040dc106b3</span><br><span class="line">Found <span class="number">1</span> unmapped computes <span class="keyword">in</span> <span class="string">cell:</span> e1657af2-a716<span class="number">-49</span>f7-a3cf-a2eb71af7c80</span><br></pre></td></tr></table></figure>
<p>添加新计算节点时，必须在控制器节点上运行nova-manage cell_v2 discover_hosts以注册这些新计算节点。<br>或者，在/etc/nova/nova.conf中设置适当的间隔,配置设备自动发现:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="builtin-name">set</span> /etc/nova/nova.conf<span class="built_in"> scheduler </span>discover_hosts_in_cells_interval 300</span><br></pre></td></tr></table></figure></p>
<h2 id="验证Compute服务"><a href="#验证Compute服务" class="headerlink" title="验证Compute服务"></a>验证Compute服务</h2><h3 id="查看计算服务列表"><a href="#查看计算服务列表" class="headerlink" title="查看计算服务列表"></a>查看计算服务列表</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br><span class="line">openstack compute service list</span><br><span class="line"></span><br><span class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|<span class="string"> ID </span>|<span class="string"> Binary           </span>|<span class="string"> Host       </span>|<span class="string"> Zone     </span>|<span class="string"> Status  </span>|<span class="string"> State </span>|<span class="string"> Updated At                 </span>|</span><br><span class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|<span class="string">  3 </span>|<span class="string"> nova-consoleauth </span>|<span class="string"> controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-07-15T15:04:09.000000 </span>|</span><br><span class="line">|<span class="string">  4 </span>|<span class="string"> nova-scheduler   </span>|<span class="string"> controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-07-15T15:04:13.000000 </span>|</span><br><span class="line">|<span class="string">  5 </span>|<span class="string"> nova-conductor   </span>|<span class="string"> controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-07-15T15:04:08.000000 </span>|</span><br><span class="line">|<span class="string">  6 </span>|<span class="string"> nova-compute     </span>|<span class="string"> compute    </span>|<span class="string"> nova     </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-07-15T15:04:13.000000 </span>|</span><br><span class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="查看api列表"><a href="#查看api列表" class="headerlink" title="查看api列表"></a>查看api列表</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">openstack catalog: true</span><br><span class="line"></span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">|<span class="string"> Name      </span>|<span class="string"> Type      </span>|<span class="string"> Endpoints                               </span>|</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">|<span class="string"> keystone  </span>|<span class="string"> identity  </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:35357/v3/    </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:5000/v3/    </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> placement </span>|<span class="string"> placement </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:8778      </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:8778         </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:8778        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> nova      </span>|<span class="string"> compute   </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:8774/v2.1    </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:8774/v2.1   </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> glance    </span>|<span class="string"> image     </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:9292        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:9292      </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:9292         </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="查看镜像列表"><a href="#查看镜像列表" class="headerlink" title="查看镜像列表"></a>查看镜像列表</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack image list</span><br><span class="line"></span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br><span class="line">| c1489536-e12d-4323-8fb5-14128f4d8d5e | cirros | active |</span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="检查cells和placement-API是否正常"><a href="#检查cells和placement-API是否正常" class="headerlink" title="检查cells和placement API是否正常"></a>检查cells和placement API是否正常</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">nova-status upgrade check</span><br><span class="line"></span><br><span class="line">/usr/lib/python2.7/site-packages/oslo<span class="emphasis">_db/sqlalchemy/enginefacade.py:332: NotSupportedWarning: Configuration option(s) ['use_</span>tpool'] not supported</span><br><span class="line"><span class="code">  exception.NotSupportedWarning</span></span><br><span class="line">Option "os<span class="emphasis">_region_</span>name" from group "placement" is deprecated. Use option "region-name" from group "placement".</span><br><span class="line"><span class="code">+-------------------------------------------------------------------+</span></span><br><span class="line">| Upgrade Check Results                                             |</span><br><span class="line"><span class="code">+-------------------------------------------------------------------+</span></span><br><span class="line">| Check: Cells v2                                                   |</span><br><span class="line">| Result: Success                                                   |</span><br><span class="line">| Details: None                                                     |</span><br><span class="line"><span class="code">+-------------------------------------------------------------------+</span></span><br><span class="line">| Check: Placement API                                              |</span><br><span class="line">| Result: Success                                                   |</span><br><span class="line">| Details: None                                                     |</span><br><span class="line"><span class="code">+-------------------------------------------------------------------+</span></span><br><span class="line">| Check: Resource Providers                                         |</span><br><span class="line">| Result: Warning                                                   |</span><br><span class="line">| Details: There are no compute resource providers in the Placement |</span><br><span class="line">|   service but there are 1 compute nodes in the deployment.        |</span><br><span class="line">|   This means no compute nodes are reporting into the              |</span><br><span class="line">|   Placement service and need to be upgraded and/or fixed.         |</span><br><span class="line">|   See                                                             |</span><br><span class="line">|   https://docs.openstack.org/nova/latest/user/placement.html      |</span><br><span class="line">|   for more details.                                               |</span><br><span class="line"><span class="code">+-------------------------------------------------------------------+</span></span><br><span class="line">| Check: Ironic Flavor Migration                                    |</span><br><span class="line">| Result: Success                                                   |</span><br><span class="line">| Details: None                                                     |</span><br><span class="line"><span class="code">+-------------------------------------------------------------------+</span></span><br><span class="line">| Check: API Service Version                                        |</span><br><span class="line">| Result: Success                                                   |</span><br><span class="line">| Details: None                                                     |</span><br><span class="line"><span class="code">+-------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<h1 id="Neutron-网络服务"><a href="#Neutron-网络服务" class="headerlink" title="Neutron 网络服务"></a>Neutron 网络服务</h1><p>在<code>controller</code>节点执行<br><a href="https://docs.openstack.org/neutron/queens/install/install-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/neutron/queens/install/install-rdo.html</a></p>
<h2 id="创建nuetron数据库并授权"><a href="#创建nuetron数据库并授权" class="headerlink" title="创建nuetron数据库并授权"></a>创建nuetron数据库并授权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> neutron;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">'neutron'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NEUTRON_DBPASS'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">'neutron'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'NEUTRON_DBPASS'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="创建neutron"><a href="#创建neutron" class="headerlink" title="创建neutron"></a>创建neutron</h2><h3 id="创建neutron用户"><a href="#创建neutron用户" class="headerlink" title="创建neutron用户"></a>创建neutron用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br><span class="line">openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span>--password-prompt neutron</span><br><span class="line"></span><br><span class="line">User Password: #配置密码为：NEUTRON_PASS</span><br><span class="line">Repeat<span class="built_in"> User </span>Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | 3528d4035b0c41979501a72f69934d7c |</span><br><span class="line">| name                | neutron                          |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="添加admin角色为neutron用户"><a href="#添加admin角色为neutron用户" class="headerlink" title="添加admin角色为neutron用户"></a>添加admin角色为neutron用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user neutron admin</span><br></pre></td></tr></table></figure>
<h3 id="创建neutron服务"><a href="#创建neutron服务" class="headerlink" title="创建neutron服务"></a>创建neutron服务</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">openstack<span class="built_in"> service </span>create --name neutron --description <span class="string">"OpenStack Networking"</span> network</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Networking             |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | 5970a241f2b7427ba369287b55d00575 |</span><br><span class="line">| name        | neutron                          |</span><br><span class="line">|<span class="built_in"> type </span>       |<span class="built_in"> network </span>                         |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建neutron-api"><a href="#创建neutron-api" class="headerlink" title="创建neutron api"></a>创建neutron api</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne network public http://controller:9696</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 2d48f4da21384a5593a55c38787d3a25 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 5970a241f2b7427ba369287b55d00575 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> neutron                          </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> network                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9696           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne network internal http://controller:9696</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 2b41f0ff8a874b738587e52391e2a86f </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 5970a241f2b7427ba369287b55d00575 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> neutron                          </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> network                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9696           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne network admin http://controller:9696</span><br><span class="line"></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 4ac9b4d66b2d4859a0c7acc045b772bc </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> admin                            </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 5970a241f2b7427ba369287b55d00575 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> neutron                          </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> network                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9696           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="配置controller网络选项"><a href="#配置controller网络选项" class="headerlink" title="配置controller网络选项"></a>配置controller网络选项</h2><p>在<code>controller</code>控制节点执行<br><a href="https://docs.openstack.org/neutron/queens/install/controller-install-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/neutron/queens/install/controller-install-rdo.html</a><br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y</span><br></pre></td></tr></table></figure></p>
<h3 id="配置-neutron-conf"><a href="#配置-neutron-conf" class="headerlink" title="配置 neutron.conf"></a>配置 neutron.conf</h3><p>快速处理脚本<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> database connection mysql+pymysql:<span class="string">//neutron</span><span class="function">:NEUTRON_DBPASS</span>@controller/neutron</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> DEFAULT core_plugin ml2</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> DEFAULT service_plugins</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> DEFAULT transport_url rabbit:<span class="string">//openstack</span><span class="function">:RABBIT_PASS</span>@controller</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> DEFAULT auth_strategy keystone</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken auth_uri http:<span class="string">//controller</span><span class="function">:5000</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken auth_url http:<span class="string">//controller</span><span class="function">:35357</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken memcached_servers controller<span class="function">:11211</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken auth_type password</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken project_name service</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken username neutron</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> keystone_authtoken password NEUTRON_PASS</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> DEFAULT notify_nova_on_port_status_changes <span class="literal">true</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> DEFAULT notify_nova_on_port_data_changes <span class="literal">true</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova auth_url http:<span class="string">//controller</span><span class="function">:35357</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova auth_type password</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova project_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova user_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova region_name RegionOne</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova project_name service</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova username nova</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> nova password NOVA_PASS</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/neutron/neutron.conf</span> oslo_concurrency lock_path <span class="string">/var/lib/neutron/tmp</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/neutron.conf </span><br><span class="line"></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql:<span class="comment">//neutron:NEUTRON_DBPASS@controller/neutron </span></span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins =</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:RABBIT_PASS@controller</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">notify_nova_on_port_status_changes = <span class="keyword">true</span></span><br><span class="line">notify_nova_on_port_data_changes = <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_uri = http:<span class="comment">//controller:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//controller:35357</span></span><br><span class="line">memcached_servers = controller:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line"></span><br><span class="line">[nova]</span><br><span class="line">auth_url = http:<span class="comment">//controller:35357</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = NOVA_PASS</span><br><span class="line"></span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure></p>
<h3 id="配置网络二层插件"><a href="#配置网络二层插件" class="headerlink" title="配置网络二层插件"></a>配置网络二层插件</h3><p>快速处理脚本<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="keyword">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers flat,vlan</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini <span class="comment">ml2 tenant_network_types</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/plugins/<span class="comment">ml2</span>/ml2_conf.ini ml2 mechanism_drivers linuxbridge</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">plugins</span>/ml2/<span class="comment">ml2_conf.ini ml2 extension_drivers port_security</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/plugins/<span class="comment">ml2</span>/ml2_conf.ini ml2_type_flat flat_networks provider</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">plugins</span>/ml2/<span class="comment">ml2_conf.ini securitygroup enable_ipset true</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/plugins/ml2/ml2_conf.ini</span><br><span class="line"></span><br><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan</span><br><span class="line">tenant_network_types =</span><br><span class="line">hanism_drivers = linuxbridge</span><br><span class="line">extension_drivers = port_security</span><br><span class="line"></span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="keyword">true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="配置桥接网络-Provider"><a href="#配置桥接网络-Provider" class="headerlink" title="配置桥接网络(Provider)"></a>配置桥接网络(Provider)</h3><p>Provider network : <a href="https://docs.openstack.org/install-guide/launch-instance-networks-selfservice.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/launch-instance-networks-selfservice.html</a><br>快速处理脚本<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="keyword">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:eth0</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini <span class="comment">vxlan enable_vxlan false</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/plugins/<span class="comment">ml2</span>/linuxbridge_agent.ini securitygroup enable_security_group true</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">plugins</span>/ml2/<span class="comment">linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini </span><br><span class="line"></span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth0</span><br><span class="line"></span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="keyword">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure></p>
<p>通过验证以下所有sysctl值都设置为1，确保您的Linux操作系统内核支持网桥过滤器<br><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line">#lsmod |grep br_netfilter</span><br><span class="line">sysctl -p</span><br><span class="line"><span class="built_in">net</span>.bridge.bridge-nf-<span class="keyword">call</span>-iptables</span><br><span class="line"><span class="built_in">net</span>.bridge.bridge-nf-<span class="keyword">call</span>-ip6tables</span><br></pre></td></tr></table></figure></p>
<h3 id="配置DHCP"><a href="#配置DHCP" class="headerlink" title="配置DHCP"></a>配置DHCP</h3><p>快速处理脚本<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="builtin-name">set</span> /etc/neutron/dhcp_agent.ini<span class="built_in"> DEFAULT </span>interface_driver linuxbridge</span><br><span class="line">openstack-config --<span class="builtin-name">set</span> /etc/neutron/dhcp_agent.ini<span class="built_in"> DEFAULT </span>dhcp_driver neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">openstack-config --<span class="builtin-name">set</span> /etc/neutron/dhcp_agent.ini<span class="built_in"> DEFAULT </span>enable_isolated_metadata <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/dhcp_agent.ini </span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">enable_isolated_metadata = <span class="keyword">true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="配置metadata"><a href="#配置metadata" class="headerlink" title="配置metadata"></a>配置metadata</h3><p>快速处理脚本<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="builtin-name">set</span>  /etc/neutron/metadata_agent.ini<span class="built_in"> DEFAULT </span>nova_metadata_ip controller</span><br><span class="line">openstack-config --<span class="builtin-name">set</span>  /etc/neutron/metadata_agent.ini<span class="built_in"> DEFAULT </span>metadata_proxy_shared_secret METADATA_SECRET</span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netutron/metadata_agent.ini </span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">nova_metadata_host = controller</span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure></p>
<h2 id="配置compute服务使用网络"><a href="#配置compute服务使用网络" class="headerlink" title="配置compute服务使用网络"></a>配置compute服务使用网络</h2><p>在<code>controller</code>控制节点执行<br><a href="https://docs.openstack.org/neutron/queens/install/compute-install-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/neutron/queens/install/compute-install-rdo.html</a></p>
<h3 id="配置nova-conf-2"><a href="#配置nova-conf-2" class="headerlink" title="配置nova.conf"></a>配置nova.conf</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron url http:<span class="string">//controller</span><span class="function">:9696</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron auth_url http:<span class="string">//controller</span><span class="function">:35357</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron auth_type password</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron project_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron user_domain_name default</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron region_name RegionOne</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron project_name service</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron username neutron</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron password NEUTRON_PASS</span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron service_metadata_proxy <span class="literal">true</span></span><br><span class="line">openstack-config <span class="params">--set</span> <span class="string">/etc/nova/nova.conf</span> neutron metadata_proxy_shared_secret METADATA_SECRET</span><br></pre></td></tr></table></figure>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/nova/nova.conf  </span><br><span class="line"></span><br><span class="line">[neutron]</span><br><span class="line">url = http:<span class="comment">//controller:9696</span></span><br><span class="line">auth_url = http:<span class="comment">//controller:35357</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line">service_metadata_proxy = <span class="keyword">true</span></span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure></p>
<h3 id="配置与启动"><a href="#配置与启动" class="headerlink" title="配置与启动"></a>配置与启动</h3><h4 id="创建服务软连接"><a href="#创建服务软连接" class="headerlink" title="创建服务软连接"></a>创建服务软连接</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/etc/</span>neutron<span class="regexp">/plugins/m</span>l2<span class="regexp">/ml2_conf.ini /</span>etc<span class="regexp">/neutron/</span>plugin.ini</span><br></pre></td></tr></table></figure>
<h4 id="初始化数据库-1"><a href="#初始化数据库-1" class="headerlink" title="初始化数据库"></a>初始化数据库</h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">su</span> -s /bin/<span class="keyword">sh</span> -c <span class="string">"neutron-db-manage --config-file /etc/neutron/neutron.conf   --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head"</span> neutron</span><br></pre></td></tr></table></figure>
<h4 id="重启compute-api服务"><a href="#重启compute-api服务" class="headerlink" title="重启compute api服务"></a>重启compute api服务</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">openstack-nova-api</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure>
<h4 id="启动网络服务并开机启动"><a href="#启动网络服务并开机启动" class="headerlink" title="启动网络服务并开机启动"></a>启动网络服务并开机启动</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable neutron-server<span class="selector-class">.service</span> neutron-linuxbridge-agent<span class="selector-class">.service</span> \</span><br><span class="line">neutron-dhcp-agent<span class="selector-class">.service</span> neutron-metadata-agent.service</span><br><span class="line">systemctl start neutron-server<span class="selector-class">.service</span> neutron-linuxbridge-agent<span class="selector-class">.service</span> \</span><br><span class="line">neutron-dhcp-agent<span class="selector-class">.service</span> neutron-metadata-agent.service</span><br></pre></td></tr></table></figure>
<h2 id="配置compute节点网络服务"><a href="#配置compute节点网络服务" class="headerlink" title="配置compute节点网络服务"></a>配置compute节点网络服务</h2><p>在<code>compute</code>计算节点执行</p>
<h3 id="安装neutron"><a href="#安装neutron" class="headerlink" title="安装neutron"></a>安装neutron</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openstack-neutron-linuxbridge ebtables ipset -y</span><br></pre></td></tr></table></figure>
<h3 id="配置-neutron-conf-1"><a href="#配置-neutron-conf-1" class="headerlink" title="配置 neutron.conf"></a>配置 neutron.conf</h3><p>快速处理脚本<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="keyword">set</span> /etc/neutron/neutron.conf DEFAULT transport_url rabbit:<span class="comment">//openstack:RABBIT_PASS@controller</span></span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf <span class="comment">DEFAULT auth_strategy keystone</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/neutron.conf keystone_authtoken auth_uri http:<span class="comment">//controller:5000</span></span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">neutron.conf keystone_authtoken auth_url http:</span>//<span class="comment">controller:35357</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/neutron.conf keystone_authtoken memcached_servers controller:<span class="number">11211</span></span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">neutron.conf keystone_authtoken auth_type password</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/neutron.conf keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">neutron.conf keystone_authtoken user_domain_name default</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/neutron.conf keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">neutron.conf keystone_authtoken username neutron</span></span><br><span class="line">openstack-config <span class="comment">--set</span> /etc/<span class="comment">neutron</span>/neutron.conf keystone_authtoken password NEUTRON_PASS</span><br><span class="line">openstack-config --set /<span class="comment">etc</span>/neutron/<span class="comment">neutron.conf oslo_concurrency lock_path</span> /var/<span class="comment">lib</span>/neutron/<span class="comment">tmp</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/neutron.conf </span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:RABBIT_PASS@controller</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_uri = http:<span class="comment">//controller:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//controller:35357</span></span><br><span class="line">memcached_servers = controller:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line"></span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure></p>
<h3 id="配置网络-Provider"><a href="#配置网络-Provider" class="headerlink" title="配置网络(Provider)"></a>配置网络(Provider)</h3><p>Provider network : <a href="https://docs.openstack.org/install-guide/launch-instance-networks-selfservice.html" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/launch-instance-networks-selfservice.html</a><br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="keyword">set</span>  /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:eth0</span><br><span class="line">openstack-config --set  /etc/neutron/plugins/ml2/linuxbridge_agent.ini <span class="comment">vxlan enable_vxlan false</span></span><br><span class="line">openstack-config <span class="comment">--set</span>  /etc/<span class="comment">neutron</span>/plugins/<span class="comment">ml2</span>/linuxbridge_agent.ini securitygroup enable_security_group true</span><br><span class="line">openstack-config --set  /<span class="comment">etc</span>/neutron/<span class="comment">plugins</span>/ml2/<span class="comment">linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini </span><br><span class="line"></span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth0</span><br><span class="line"></span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="keyword">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure></p>
<h3 id="配置计算节点nova网络服务"><a href="#配置计算节点nova网络服务" class="headerlink" title="配置计算节点nova网络服务"></a>配置计算节点nova网络服务</h3><p>快速处理脚本<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openstack-config --<span class="keyword">set</span>  /etc/nova/nova.conf neutron url http:<span class="comment">//controller:9696</span></span><br><span class="line">openstack-config --set  /etc/nova/nova.conf <span class="comment">neutron auth_url http:</span>//<span class="comment">controller:35357</span></span><br><span class="line">openstack-config <span class="comment">--set</span>  /etc/<span class="comment">nova</span>/nova.conf neutron auth_type password</span><br><span class="line">openstack-config --set  /<span class="comment">etc</span>/nova/<span class="comment">nova.conf neutron project_domain_name default</span></span><br><span class="line">openstack-config <span class="comment">--set</span>  /etc/<span class="comment">nova</span>/nova.conf neutron user_domain_name default</span><br><span class="line">openstack-config --set  /<span class="comment">etc</span>/nova/<span class="comment">nova.conf neutron region_name RegionOne</span></span><br><span class="line">openstack-config <span class="comment">--set</span>  /etc/<span class="comment">nova</span>/nova.conf neutron project_name service</span><br><span class="line">openstack-config --set  /<span class="comment">etc</span>/nova/<span class="comment">nova.conf neutron username neutron</span></span><br><span class="line">openstack-config <span class="comment">--set</span>  /etc/<span class="comment">nova</span>/nova.conf neutron password NEUTRON_PASS</span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nova/nova.conf</span><br><span class="line"></span><br><span class="line">[neutron]</span><br><span class="line"></span><br><span class="line">url = http:<span class="comment">//controller:9696</span></span><br><span class="line">auth_url = http:<span class="comment">//controller:35357</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br></pre></td></tr></table></figure></p>
<h3 id="完成安装配置"><a href="#完成安装配置" class="headerlink" title="完成安装配置"></a>完成安装配置</h3><h4 id="重启compute服务"><a href="#重启compute服务" class="headerlink" title="重启compute服务"></a>重启compute服务</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openstack-nova-<span class="built_in">compute</span>.service</span><br></pre></td></tr></table></figure>
<h4 id="启动网桥服务并开机启动"><a href="#启动网桥服务并开机启动" class="headerlink" title="启动网桥服务并开机启动"></a>启动网桥服务并开机启动</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">enable</span> <span class="selector-tag">neutron-linuxbridge-agent</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">start</span> <span class="selector-tag">neutron-linuxbridge-agent</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure>
<h1 id="Horizon-dashboard"><a href="#Horizon-dashboard" class="headerlink" title="Horizon dashboard"></a>Horizon dashboard</h1><p>在<code>controller</code>控制节点执行<br><a href="https://docs.openstack.org/horizon/queens/install/" target="_blank" rel="noopener">https://docs.openstack.org/horizon/queens/install/</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openstack-dashboard -y</span><br></pre></td></tr></table></figure>
<h2 id="配置-local-settings"><a href="#配置-local-settings" class="headerlink" title="配置 local_settings"></a>配置 local_settings</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/openstack-dashboard/local_settings</span><br><span class="line"></span><br><span class="line">OPENSTACK_HOST = <span class="string">"controller"</span></span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">"http://%s:5000/v3"</span> % OPENSTACK_HOST</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">"user"</span></span><br><span class="line"></span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line"></span><br><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cache'</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">         <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">         <span class="string">'LOCATION'</span>: <span class="string">'controller:11211'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    <span class="string">"identity"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"image"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"volume"</span>: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">"Default"</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>]</span><br><span class="line"></span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    <span class="string">'enable_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_quotas'</span>: False,</span><br><span class="line">    <span class="string">'enable_distributed_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_ha_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_lb'</span>: False,</span><br><span class="line">    <span class="string">'enable_firewall'</span>: False,</span><br><span class="line">    <span class="string">'enable_vpn'</span>: False,</span><br><span class="line">    <span class="string">'enable_fip_topology_check'</span>: False,</span><br><span class="line">&#125;</span><br><span class="line">TIME_ZONE = <span class="string">"Asia/Shanghai"</span></span><br></pre></td></tr></table></figure>
<h2 id="配置httd-dashboard"><a href="#配置httd-dashboard" class="headerlink" title="配置httd dashboard"></a>配置httd dashboard</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/openstack-dashboard.conf </span><br><span class="line"></span><br><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重启httpd-memcached"><a href="#重启httpd-memcached" class="headerlink" title="重启httpd memcached"></a>重启httpd memcached</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">httpd</span><span class="selector-class">.service</span> <span class="selector-tag">memcached</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure>
<p>在浏览器输入<a href="http://192.168.7.11/dashboard.,访问openstack的web页面" target="_blank" rel="noopener">http://192.168.7.11/dashboard.,访问openstack的web页面</a></p>
<h1 id="启动一个实例"><a href="#启动一个实例" class="headerlink" title="启动一个实例"></a>启动一个实例</h1><h2 id="下载系统镜像"><a href="#下载系统镜像" class="headerlink" title="下载系统镜像"></a>下载系统镜像</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/centos/</span><span class="number">7</span><span class="regexp">/isos/</span>x86_64<span class="regexp">/CentOS-7-x86_64-Minimal-1804.iso</span></span><br></pre></td></tr></table></figure>
<h2 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h2><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">image</span> create <span class="string">"centos7_x64"</span> --<span class="keyword">file</span> CentOS<span class="number">-7</span>-x86_64-Minimal<span class="number">-1804.</span>iso \</span><br><span class="line">--disk-<span class="keyword">format</span> qcow2 --<span class="keyword">container</span>-<span class="keyword">format</span> bare  --public</span><br></pre></td></tr></table></figure>
<h2 id="创建网络"><a href="#创建网络" class="headerlink" title="创建网络"></a>创建网络</h2><p>基于 provider networks<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">. admin-openrc</span><br><span class="line">openstack network create  --share --external  --provider-physical-network provider  --provider-network-type flat provider</span><br><span class="line"></span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">|<span class="string"> Field                     </span>|<span class="string"> Value                                </span>|</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">|<span class="string"> admin_state_up            </span>|<span class="string"> UP                                   </span>|</span><br><span class="line">|<span class="string"> availability_zone_hints   </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> availability_zones        </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> created_at                </span>|<span class="string"> 2018-07-18T09:16:24Z                 </span>|</span><br><span class="line">|<span class="string"> description               </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> dns_domain                </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> id                        </span>|<span class="string"> a1f3ed6e-f6f3-4b7a-8df8-0be329a913c5 </span>|</span><br><span class="line">|<span class="string"> ipv4_address_scope        </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> ipv6_address_scope        </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> is_default                </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> is_vlan_transparent       </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> mtu                       </span>|<span class="string"> 1500                                 </span>|</span><br><span class="line">|<span class="string"> name                      </span>|<span class="string"> provider                             </span>|</span><br><span class="line">|<span class="string"> port_security_enabled     </span>|<span class="string"> True                                 </span>|</span><br><span class="line">|<span class="string"> project_id                </span>|<span class="string"> 397ed95bb8d244fc924fb974235c6661     </span>|</span><br><span class="line">|<span class="string"> provider:network_type     </span>|<span class="string"> flat                                 </span>|</span><br><span class="line">|<span class="string"> provider:physical_network </span>|<span class="string"> provider                             </span>|</span><br><span class="line">|<span class="string"> provider:segmentation_id  </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> qos_policy_id             </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> revision_number           </span>|<span class="string"> 4                                    </span>|</span><br><span class="line">|<span class="string"> router:external           </span>|<span class="string"> External                             </span>|</span><br><span class="line">|<span class="string"> segments                  </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> shared                    </span>|<span class="string"> True                                 </span>|</span><br><span class="line">|<span class="string"> status                    </span>|<span class="string"> ACTIVE                               </span>|</span><br><span class="line">|<span class="string"> subnets                   </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> tags                      </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> updated_at                </span>|<span class="string"> 2018-07-18T09:16:25Z                 </span>|</span><br><span class="line">+---------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure></p>
<p>参数<br>--share 允许所有项目使用虚拟网络<br>--external 定义外接虚拟网络 如果需要创建外网使用 –internal<br>--provider-physical-network provider &amp;&amp; –provider-network-type flat 连接flat 虚拟网络</p>
<h2 id="创建子网"><a href="#创建子网" class="headerlink" title="创建子网"></a>创建子网</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">openstack subnet create --network provider  --allocation-pool start=192.168.7.30,end=192.168.7.200 \</span><br><span class="line">--dns-nameserver 192.168.7.2 --gateway 192.168.7.2 --subnet-range 192.168.7.0/24 provider</span><br><span class="line"></span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">|<span class="string"> Field             </span>|<span class="string"> Value                                </span>|</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">|<span class="string"> allocation_pools  </span>|<span class="string"> 192.168.10.30-192.168.10.200         </span>|</span><br><span class="line">|<span class="string"> cidr              </span>|<span class="string"> 192.168.10.0/24                      </span>|</span><br><span class="line">|<span class="string"> created_at        </span>|<span class="string"> 2018-07-18T09:18:21Z                 </span>|</span><br><span class="line">|<span class="string"> description       </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> dns_nameservers   </span>|<span class="string"> 223.5.5.5                            </span>|</span><br><span class="line">|<span class="string"> enable_dhcp       </span>|<span class="string"> True                                 </span>|</span><br><span class="line">|<span class="string"> gateway_ip        </span>|<span class="string"> 192.168.10.1                         </span>|</span><br><span class="line">|<span class="string"> host_routes       </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> id                </span>|<span class="string"> 8426cc1e-7682-4dfb-b509-4d8a6338cf4b </span>|</span><br><span class="line">|<span class="string"> ip_version        </span>|<span class="string"> 4                                    </span>|</span><br><span class="line">|<span class="string"> ipv6_address_mode </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> ipv6_ra_mode      </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> name              </span>|<span class="string"> provider                             </span>|</span><br><span class="line">|<span class="string"> network_id        </span>|<span class="string"> a1f3ed6e-f6f3-4b7a-8df8-0be329a913c5 </span>|</span><br><span class="line">|<span class="string"> project_id        </span>|<span class="string"> 397ed95bb8d244fc924fb974235c6661     </span>|</span><br><span class="line">|<span class="string"> revision_number   </span>|<span class="string"> 0                                    </span>|</span><br><span class="line">|<span class="string"> segment_id        </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> service_types     </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> subnetpool_id     </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> tags              </span>|<span class="string">                                      </span>|</span><br><span class="line">|<span class="string"> updated_at        </span>|<span class="string"> 2018-07-18T09:18:21Z                 </span>|</span><br><span class="line">+-------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="创建flavor"><a href="#创建flavor" class="headerlink" title="创建flavor"></a>创建flavor</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano</span><br><span class="line"></span><br><span class="line">+----------------------------+---------+</span><br><span class="line">|<span class="string"> Field                      </span>|<span class="string"> Value   </span>|</span><br><span class="line">+----------------------------+---------+</span><br><span class="line">|<span class="string"> OS-FLV-DISABLED:disabled   </span>|<span class="string"> False   </span>|</span><br><span class="line">|<span class="string"> OS-FLV-EXT-DATA:ephemeral  </span>|<span class="string"> 0       </span>|</span><br><span class="line">|<span class="string"> disk                       </span>|<span class="string"> 1       </span>|</span><br><span class="line">|<span class="string"> id                         </span>|<span class="string"> 0       </span>|</span><br><span class="line">|<span class="string"> name                       </span>|<span class="string"> m1.nano </span>|</span><br><span class="line">|<span class="string"> os-flavor-access:is_public </span>|<span class="string"> True    </span>|</span><br><span class="line">|<span class="string"> properties                 </span>|<span class="string">         </span>|</span><br><span class="line">|<span class="string"> ram                        </span>|<span class="string"> 64      </span>|</span><br><span class="line">|<span class="string"> rxtx_factor                </span>|<span class="string"> 1.0     </span>|</span><br><span class="line">|<span class="string"> swap                       </span>|<span class="string">         </span>|</span><br><span class="line">|<span class="string"> vcpus                      </span>|<span class="string"> 1       </span>|</span><br><span class="line">+----------------------------+---------+</span><br></pre></td></tr></table></figure>
<h2 id="控制节点生成秘钥对-在启动实例之前，需要将公钥添加到Compute服务"><a href="#控制节点生成秘钥对-在启动实例之前，需要将公钥添加到Compute服务" class="headerlink" title="控制节点生成秘钥对,在启动实例之前，需要将公钥添加到Compute服务"></a>控制节点生成秘钥对,在启动实例之前，需要将公钥添加到Compute服务</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">. demo-openrc</span><br><span class="line">ssh-keygen -q -N <span class="string">""</span></span><br><span class="line"></span><br><span class="line">Enter <span class="built_in">file</span> <span class="keyword">in</span> which <span class="built_in">to</span> save <span class="keyword">the</span> key (/root/.ssh/id_rsa):</span><br></pre></td></tr></table></figure>
<p>在openstack上创建密钥对<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openstack keypair create --public-key ~/.ssh/id<span class="emphasis">_rsa.pub mykey</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">+-------------+-------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| Field       | Value                                           |</span></span><br><span class="line"><span class="emphasis">+-------------+-------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| fingerprint | 7a:ee:60:81:1a:62:0f:6a:df:a3:7e:f2:72:a3:7a:dd |</span></span><br><span class="line"><span class="emphasis">| name        | mykey                                           |</span></span><br><span class="line"><span class="emphasis">| user_</span>id     | fa5af0071d424540af93d9c919721dc3                |</span><br><span class="line"><span class="code">+-------------+</span>-------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<p>查看<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack keypair list</span><br><span class="line"></span><br><span class="line"><span class="code">+-------+</span>-------------------------------------------------+</span><br><span class="line">| Name  | Fingerprint                                     |</span><br><span class="line"><span class="code">+-------+</span>-------------------------------------------------+</span><br><span class="line">| mykey | 7a:ee:60:81:1a:62:0f:6a:df:a3:7e:f2:72:a3:7a:dd |</span><br><span class="line"><span class="code">+-------+</span>-------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h2 id="添加安全组"><a href="#添加安全组" class="headerlink" title="添加安全组"></a>添加安全组</h2><h3 id="允许ICMP（ping）"><a href="#允许ICMP（ping）" class="headerlink" title="允许ICMP（ping）"></a>允许ICMP（ping）</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack security<span class="built_in"> group </span>rule create --proto icmp default</span><br></pre></td></tr></table></figure>
<h3 id="允许SSH"><a href="#允许SSH" class="headerlink" title="允许SSH"></a>允许SSH</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack security<span class="built_in"> group </span>rule create --proto tcp --dst-port 22 default</span><br></pre></td></tr></table></figure>
<h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><h3 id="查看关联和子网"><a href="#查看关联和子网" class="headerlink" title="查看关联和子网"></a>查看关联和子网</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">neutron <span class="keyword">net</span>-<span class="keyword">list</span></span><br><span class="line">neutron subnet-<span class="keyword">list</span></span><br></pre></td></tr></table></figure>
<h3 id="查看flavor"><a href="#查看flavor" class="headerlink" title="查看flavor"></a>查看flavor</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack flavor list</span><br><span class="line"></span><br><span class="line">+----+-----------+-------+------+-----------+-------+-----------+</span><br><span class="line">|<span class="string"> ID </span>|<span class="string"> Name      </span>|<span class="string">   RAM </span>|<span class="string"> Disk </span>|<span class="string"> Ephemeral </span>|<span class="string"> VCPUs </span>|<span class="string"> Is Public </span>|</span><br><span class="line">+----+-----------+-------+------+-----------+-------+-----------+</span><br><span class="line">|<span class="string"> 0  </span>|<span class="string"> m1.nano   </span>|<span class="string">    64 </span>|<span class="string">    1 </span>|<span class="string">         0 </span>|<span class="string">     1 </span>|<span class="string"> True      </span>|</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> m1.tiny   </span>|<span class="string">   512 </span>|<span class="string">    1 </span>|<span class="string">         0 </span>|<span class="string">     1 </span>|<span class="string"> True      </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> m1.small  </span>|<span class="string">  2048 </span>|<span class="string">   20 </span>|<span class="string">         0 </span>|<span class="string">     1 </span>|<span class="string"> True      </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> m1.medium </span>|<span class="string">  4096 </span>|<span class="string">   40 </span>|<span class="string">         0 </span>|<span class="string">     2 </span>|<span class="string"> True      </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> m1.large  </span>|<span class="string">  8192 </span>|<span class="string">   80 </span>|<span class="string">         0 </span>|<span class="string">     4 </span>|<span class="string"> True      </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> m1.xlarge </span>|<span class="string"> 16384 </span>|<span class="string">  160 </span>|<span class="string">         0 </span>|<span class="string">     8 </span>|<span class="string"> True      </span>|</span><br><span class="line">+----+-----------+-------+------+-----------+-------+-----------+</span><br></pre></td></tr></table></figure>
<h3 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openstack image list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+-----------------+--------+</span><br><span class="line">|<span class="string"> ID                                   </span>|<span class="string"> Name            </span>|<span class="string"> Status </span>|</span><br><span class="line">+--------------------------------------+-----------------+--------+</span><br><span class="line">|<span class="string"> a824235a-7a9f-4a73-afe1-c5bd5b06898c </span>|<span class="string"> CentOS-7-x86_64 </span>|<span class="string"> active </span>|</span><br><span class="line">|<span class="string"> c1489536-e12d-4323-8fb5-14128f4d8d5e </span>|<span class="string"> cirros          </span>|<span class="string"> active </span>|</span><br><span class="line">+--------------------------------------+-----------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="查看网络"><a href="#查看网络" class="headerlink" title="查看网络"></a>查看网络</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack network list</span><br><span class="line"><span class="code">+--------------------------------------+</span>----------<span class="code">+--------------------------------------+</span></span><br><span class="line">| ID                                   | Name     | Subnets                              |</span><br><span class="line"><span class="code">+--------------------------------------+</span>----------<span class="code">+--------------------------------------+</span></span><br><span class="line">| a1f3ed6e-f6f3-4b7a-8df8-0be329a913c5 | provider | 8426cc1e-7682-4dfb-b509-4d8a6338cf4b |</span><br><span class="line"><span class="code">+--------------------------------------+</span>----------<span class="code">+--------------------------------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="查看安全组"><a href="#查看安全组" class="headerlink" title="查看安全组"></a>查看安全组</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> openstack security<span class="built_in"> group </span>list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+</span><br><span class="line">| ID                                   | Name    | Description            | Project                          |</span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+</span><br><span class="line">| f666c3dc-4183-4acc-a32b-ed49f82536b5 |<span class="built_in"> default </span>|<span class="built_in"> Default </span>security<span class="built_in"> group </span>| 397ed95bb8d244fc924fb974235c6661 |</span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">openstack server create --flavor m1.nano --image cirros \</span><br><span class="line">   --nic net-id=a1f3ed6e-f6f3-4b7a-8df8-0be329a913c5 --security-group default \</span><br><span class="line">   --key-name mykey provider-instance</span><br><span class="line"></span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br><span class="line">|<span class="string"> Field                               </span>|<span class="string"> Value                                         </span>|</span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br><span class="line">|<span class="string"> OS-DCF:diskConfig                   </span>|<span class="string"> MANUAL                                        </span>|</span><br><span class="line">|<span class="string"> OS-EXT-AZ:availability_zone         </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> OS-EXT-SRV-ATTR:host                </span>|<span class="string"> None                                          </span>|</span><br><span class="line">|<span class="string"> OS-EXT-SRV-ATTR:hypervisor_hostname </span>|<span class="string"> None                                          </span>|</span><br><span class="line">|<span class="string"> OS-EXT-SRV-ATTR:instance_name       </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> OS-EXT-STS:power_state              </span>|<span class="string"> NOSTATE                                       </span>|</span><br><span class="line">|<span class="string"> OS-EXT-STS:task_state               </span>|<span class="string"> scheduling                                    </span>|</span><br><span class="line">|<span class="string"> OS-EXT-STS:vm_state                 </span>|<span class="string"> building                                      </span>|</span><br><span class="line">|<span class="string"> OS-SRV-USG:launched_at              </span>|<span class="string"> None                                          </span>|</span><br><span class="line">|<span class="string"> OS-SRV-USG:terminated_at            </span>|<span class="string"> None                                          </span>|</span><br><span class="line">|<span class="string"> accessIPv4                          </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> accessIPv6                          </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> addresses                           </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> adminPass                           </span>|<span class="string"> cAWzm9n2qcxR                                  </span>|</span><br><span class="line">|<span class="string"> config_drive                        </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> created                             </span>|<span class="string"> 2018-07-18T09:55:51Z                          </span>|</span><br><span class="line">|<span class="string"> flavor                              </span>|<span class="string"> m1.nano (0)                                   </span>|</span><br><span class="line">|<span class="string"> hostId                              </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> id                                  </span>|<span class="string"> 49561d99-69a4-40ea-902a-f6bdd7cf1aae          </span>|</span><br><span class="line">|<span class="string"> image                               </span>|<span class="string"> cirros (c1489536-e12d-4323-8fb5-14128f4d8d5e) </span>|</span><br><span class="line">|<span class="string"> key_name                            </span>|<span class="string"> mykey                                         </span>|</span><br><span class="line">|<span class="string"> name                                </span>|<span class="string"> provider-instance                             </span>|</span><br><span class="line">|<span class="string"> progress                            </span>|<span class="string"> 0                                             </span>|</span><br><span class="line">|<span class="string"> project_id                          </span>|<span class="string"> 397ed95bb8d244fc924fb974235c6661              </span>|</span><br><span class="line">|<span class="string"> properties                          </span>|<span class="string">                                               </span>|</span><br><span class="line">|<span class="string"> security_groups                     </span>|<span class="string"> name='f666c3dc-4183-4acc-a32b-ed49f82536b5'   </span>|</span><br><span class="line">|<span class="string"> status                              </span>|<span class="string"> BUILD                                         </span>|</span><br><span class="line">|<span class="string"> updated                             </span>|<span class="string"> 2018-07-18T09:55:51Z                          </span>|</span><br><span class="line">|<span class="string"> user_id                             </span>|<span class="string"> fa5af0071d424540af93d9c919721dc3              </span>|</span><br><span class="line">|<span class="string"> volumes_attached                    </span>|<span class="string">                                               </span>|</span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="查看实例状态"><a href="#查看实例状态" class="headerlink" title="查看实例状态"></a>查看实例状态</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack server list</span><br><span class="line"></span><br><span class="line"><span class="code">+--------------------------------------+</span>-------------------<span class="code">+--------+</span>------------------------<span class="code">+--------+</span>---------+</span><br><span class="line">| ID                                   | Name              | Status | Networks               | Image  | Flavor  |</span><br><span class="line"><span class="code">+--------------------------------------+</span>-------------------<span class="code">+--------+</span>------------------------<span class="code">+--------+</span>---------+</span><br><span class="line">| 49561d99-69a4-40ea-902a-f6bdd7cf1aae | provider-instance | BUILD  | provider=192.168.7.33 | cirros | m1.nano |</span><br><span class="line"><span class="code">+--------------------------------------+</span>-------------------<span class="code">+--------+</span>------------------------<span class="code">+--------+</span>---------+</span><br></pre></td></tr></table></figure>
<h2 id="查看vnc"><a href="#查看vnc" class="headerlink" title="查看vnc"></a>查看vnc</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack<span class="built_in"> console </span>url show e49561d99-69a4-40ea-902a-f6bdd7cf1aae</span><br></pre></td></tr></table></figure>
<h1 id="Cinder-存储"><a href="#Cinder-存储" class="headerlink" title="Cinder 存储"></a>Cinder 存储</h1><p>在cinder执行<br><a href="https://docs.openstack.org/cinder/queens/install/index-rdo.html" target="_blank" rel="noopener">https://docs.openstack.org/cinder/queens/install/index-rdo.html</a> </p>
<h2 id="安装lvm"><a href="#安装lvm" class="headerlink" title="安装lvm"></a>安装lvm</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">yum</span> install lvm2 device-mapper-persistent-<span class="class"><span class="keyword">data</span> -y</span></span><br></pre></td></tr></table></figure>
<h3 id="启动lvm并开机启动"><a href="#启动lvm并开机启动" class="headerlink" title="启动lvm并开机启动"></a>启动lvm并开机启动</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">enable</span> <span class="selector-tag">lvm2-lvmetad</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">start</span> <span class="selector-tag">lvm2-lvmetad</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure>
<h3 id="创建lvm物理卷"><a href="#创建lvm物理卷" class="headerlink" title="创建lvm物理卷"></a>创建lvm物理卷</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/sdb</span><br><span class="line"></span><br><span class="line">Physical <span class="keyword">volume</span><span class="bash"> <span class="string">"/dev/sdb"</span> successfully created.</span></span><br></pre></td></tr></table></figure>
<h3 id="创建lvm卷组cinder-volumes"><a href="#创建lvm卷组cinder-volumes" class="headerlink" title="创建lvm卷组cinder-volumes"></a>创建lvm卷组cinder-volumes</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vgcreate cinder-volumes /dev/sdb</span><br><span class="line"></span><br><span class="line">Volume<span class="built_in"> group </span><span class="string">"cinder-volumes"</span> successfully created</span><br></pre></td></tr></table></figure>
<p>只有实例才能访问块存储卷。但是，底层操作系统管理与卷关联的设备。默认情况下，lvm卷扫描工具会在/ dev目录中扫描包含卷的块存储设备。如果项目在其卷上使用lvm，则扫描工具会检测这些卷并尝试对其进行缓存，这可能会导致底层操作系统和项目卷出现各种问题。您必须重新配置lvm以仅扫描包含cinder-volumes卷组的设备。编辑/etc/lvm/lvm.conf文件并完成以下操作 </p>
<p>在devices部分中，添加一个接受/ dev / sdb设备的过滤器并拒绝所有其他设备<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/lvm/lvm.conf </span><br><span class="line">devices &#123;</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">filter = [ <span class="string">"a/sdb/"</span>, <span class="string">"r/.*/"</span>]</span><br></pre></td></tr></table></figure></p>
<h2 id="安装cinder"><a href="#安装cinder" class="headerlink" title="安装cinder"></a>安装cinder</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openstack-cinder targetcli python-keystone -y</span><br></pre></td></tr></table></figure>
<h3 id="配置cinder-conf"><a href="#配置cinder-conf" class="headerlink" title="配置cinder.conf"></a>配置cinder.conf</h3><p>快速处理脚本<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set database connection  mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set DEFAULT transport_url  rabbit://openstack:RABBIT_PASS@controller </span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set DEFAULT auth_strategy  keystone</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set DEFAULT my_ip  192.168.7.13</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set DEFAULT enabled_backends  lvm</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set DEFAULT glance_api_servers  http://controller:9292</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken auth_uri  http://controller:5000</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken auth_url  http://controller:35357</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken memcached_servers  controller:11211</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken auth_type  password</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken project_domain_id  default</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken user_domain_id  default</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken project_name  service</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken username  cinder</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set keystone_authtoken password  CINDER_PASS</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set lvm volume_driver  cinder.volume.drivers.lvm.lvmVolumeDriver</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set lvm volume_group  cinder-volumes</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set lvm iscsi_protocol  iscsi</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set lvm iscsi_helper  lioadm</span></span><br><span class="line">openstack-<span class="built_in">config</span> <span class="comment">--set oslo_concurrency lock_path  /var/lib/cinder/tmp</span></span><br></pre></td></tr></table></figure></p>
<p>手动编辑<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/cinder/cinder.conf </span><br><span class="line"></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder</span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller </span><br><span class="line">auth_strategy = keystone</span><br><span class="line">my_ip = 192.168.7.13</span><br><span class="line">enabled_backends = lvm</span><br><span class="line">glance_api_servers = http://controller:9292</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:35357</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_id = default</span><br><span class="line">user_domain_id = default</span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = CINDER_PASS</span><br><span class="line"></span><br><span class="line">[lvm]</span><br><span class="line">volume_driver = cinder.volume.drivers.lvm.lvmVolumeDriver</span><br><span class="line">volume_group = cinder-volumes</span><br><span class="line">iscsi_protocol = iscsi</span><br><span class="line">iscsi_helper = lioadm</span><br><span class="line"></span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/cinder/tmp</span><br></pre></td></tr></table></figure></p>
<h3 id="启动cinder并开机启动"><a href="#启动cinder并开机启动" class="headerlink" title="启动cinder并开机启动"></a>启动cinder并开机启动</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable openstack-cinder-volume<span class="selector-class">.service</span> target.service</span><br><span class="line">systemctl start openstack-cinder-volume<span class="selector-class">.service</span> target.service</span><br></pre></td></tr></table></figure>
<h1 id="报错解决"><a href="#报错解决" class="headerlink" title="报错解决"></a>报错解决</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# su -s /bin/sh -c <span class="string">"keystone-manage db_sync"</span> keystone</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/bin/keystone-manage"</span>, line 6, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> keystone.cmd.manage import main</span><br><span class="line">    <span class="built_in">..</span>.</span><br><span class="line">    <span class="keyword">from</span> oslo_messaging import<span class="built_in"> server </span>as msg_server</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/site-packages/oslo_messaging/server.py"</span>, line 35, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> oslo_service import service</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/site-packages/oslo_service/__init__.py"</span>, line 15, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import eventlet.patcher</span><br><span class="line">ImportError: <span class="literal">No</span> module named eventlet.patcher</span><br><span class="line">ImportError: cannot import name DependencyWarning</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">pip uninstall eventlet</span><br><span class="line">pip install eventlet</span><br><span class="line">pip uninstall requests</span><br><span class="line">pip install requests</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">MessageDeliveryFailure</span>: Unable to connect to AMQP server on controller:5672 after None tries: Connection.open: (530) NOT_ALLOWED - access to vhost '/' refused for user 'openstack'</span><br><span class="line"></span><br><span class="line">2018-07-13 18:56:27.161 8998 ERROR oslo.messaging._drivers.impl_rabbit [req-2060b838-a821-449e-a0eb-9054317d61b0 - - - - -] Unable to connect to AMQP server on controller:5672 after None tries: (0, 0): (403) ACCESS_REFUSED - Login was refused using authentication mechanism AMQPLAIN. For details see the broker logfile.: AccessRefused: (0, 0): (403) ACCESS_REFUSED - Login was refused using authentication mechanism AMQPLAIN. For details see the broker logfile.</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">##yum remove rabbitmq-server</span><br><span class="line">##yum install rabbitmq-server</span><br><span class="line">rabbitmqctl add_user openstack RABBIT_PASS</span><br><span class="line">rabbitmqctl set_permissions openstack ".*" ".*" ".*"</span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart  openstack-nova-compute 无法启动（计算节点）</span><br><span class="line">2018-07-13 19:25:13.457 9924 <span class="builtin-name">WARNING</span> nova.conductor.api [req-e4842974-bdd9-482a-bc4d-945399ed2be4 - - - - -] Timed out waiting <span class="keyword">for</span> nova-conductor.  Is it running? <span class="keyword">Or</span> did this<span class="built_in"> service </span>start before nova-conductor?  Reattempting establishment of nova-conductor connection<span class="built_in">..</span>.: MessagingTimeout: Timed out waiting <span class="keyword">for</span> a rep</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">检查控制节点 nova配置文件 nove服务是否正常启动 查看nova所有日志</span><br><span class="line">systemctl status openstack-nova-api openstack-nova-consoleauth \</span><br><span class="line">openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack compute<span class="built_in"> service </span>list --service nova-compute</span><br><span class="line">The<span class="built_in"> server </span>is currently unavailable. Please try again at a later time.&lt;br /&gt;&lt;br /&gt;</span><br><span class="line"> (HTTP 503) (Request-ID: req-c8597707-5788-4e68-9fc0-f49764ada304)</span><br><span class="line"></span><br><span class="line"> 解决：</span><br><span class="line">检查配置文件中[keystone_authtoken]设置是否有误 尤其是密码</span><br><span class="line"></span><br><span class="line">cat /etc/nova/nova.conf</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">password = NOVA_PASS</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-nova-api.service   openstack-nova-consoleauth.service openstack-nova-scheduler.service   openstack-nova-conductor.service openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Error: Invalid<span class="built_in"> service </span>catalog: <span class="literal">true</span></span><br><span class="line">错误:无效的服务目录:image</span><br><span class="line"> </span><br><span class="line">解决：</span><br><span class="line">openstack catalog: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Multiple service matches found for ‘identity’, <span class="keyword">use</span> an <span class="keyword">ID</span> <span class="keyword">to</span> be more specific.</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">#openstack endpoint <span class="keyword">list</span> # 查看列表</span><br><span class="line">#openstack endpoint <span class="keyword">delete</span> <span class="string">'id'</span>  # 利用<span class="keyword">ID</span>删除API 端点</span><br><span class="line">openstack service <span class="keyword">list</span>  # 查看服务列表</span><br><span class="line">openstack <span class="keyword">server</span> <span class="keyword">delete</span> <span class="string">'id'</span> # 删除服务<span class="keyword">ID</span></span><br></pre></td></tr></table></figure>
<p><a href="https://www.redhat.com/zh/topics/openstack" target="_blank" rel="noopener">https://www.redhat.com/zh/topics/openstack</a><br><a href="https://wsgzao.github.io/post/openstack/" target="_blank" rel="noopener">https://wsgzao.github.io/post/openstack/</a><br><a href="https://www.jianshu.com/p/ba2127afc380" target="_blank" rel="noopener">https://www.jianshu.com/p/ba2127afc380</a><br><a href="https://www.abcdocker.com/abcdocker/1793" target="_blank" rel="noopener">https://www.abcdocker.com/abcdocker/1793</a><br><a href="https://github.com/meetbill/openstack_install/blob/master/scripts/compute/install_nova.sh" target="_blank" rel="noopener">https://github.com/meetbill/openstack_install/blob/master/scripts/compute/install_nova.sh</a><br><a href="http://blog.51cto.com/liuleis/2094190" target="_blank" rel="noopener">http://blog.51cto.com/liuleis/2094190</a><br><a href="https://docs.openstack.org/install-guide/openstack-services.html#minimal-deployment-for-queens" target="_blank" rel="noopener">https://docs.openstack.org/install-guide/openstack-services.html#minimal-deployment-for-queens</a><br><a href="https://www.imooc.com/article/28873" target="_blank" rel="noopener">https://www.imooc.com/article/28873</a></p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/linux-performance-test/" data-toggle="tooltip" data-placement="top" title="Linux 性能测试实践">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/tomcat-apr/" data-toggle="tooltip" data-placement="top" title="Tomcat 8.5 基于APR库性能优化">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                

            </div>
    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#openstack" title="openstack">openstack</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://jaminzhang.github.io" target="_blank">JAMIN ZHANG</a></li>
                    
                        <li><a href="http://huangxuan.me" target="_blank">Hux Blog</a></li>
                    
                        <li><a href="#" target="_blank">Foo</a></li>
                    
                        <li><a href="#" target="_blank">Bar</a></li>
                    
                        <li><a href="#" target="_blank">Example Friends</a></li>
                    
                        <li><a href="#" target="_blank">It helps SEO</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/sundayle">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Sunday 2018 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>
                    Ported by <a href="https://github.com/Kaijun/hexo-theme-huxblog">Kaijun</a>
            <!-- 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
            -->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'e5a8fe97a11d3eaa24842213e1d7d092';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
