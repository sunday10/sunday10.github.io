<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Linux运维笔记">
    <meta name="keyword"  content="sunday,sundayhk,sundayle,sunday博客,Linxu,运维">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Linux Bonding 多网卡汇聚 - Sunday博客 | Sunday Blog
        
    </title>

    <link rel="canonical" href="http://www.sundayle.com/linux-bonding/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Sunday</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://www.sundayle.com/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#bonding" title="bonding">bonding</a>
                        
                    </div>
                    <h1>Linux Bonding 多网卡汇聚</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Sunday on
                        2018-07-24
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="什么是Bonding"><a href="#什么是Bonding" class="headerlink" title="什么是Bonding"></a>什么是Bonding</h1><p>早期由于网卡的速度还不够快，那如果你的服务器需要比较大的频宽使用时，就得要购买更昂贵的万兆网卡才行。那为什么不能将几张网卡合并成为一张来扩大频宽呢？此外，对于重要的服务来说，网络是不能中断的！所以，能不能使用两条以上的线路连接到我的服务器呢？因此，<code>合并网卡的频宽</code>与<code>让网卡具有容错能力（容错）</code>就成了Linux bonding最主要的考量了！目前Linux bonding功能已经加入核心，所以你只要启动它即可！不需要额外安装其他软件呦！</p>
<h1 id="Bonding的模式与功能"><a href="#Bonding的模式与功能" class="headerlink" title="Bonding的模式与功能"></a>Bonding的模式与功能</h1><p>bonding根据当初设计理念的不同，有许多常用的模式可以参考：</p>
<ul>
<li><p><code>模式0，循环负载平衡合并频宽（Round-robin，balance-rr）：</code><br>Linux bonding会将发送的封包循序的从任何可用的网卡上面循环发送，因为是循环发送的，所以每张网卡就能够充分利用〜不过，就鸟哥的经验来看，这种模式的负载平衡方面似乎没有想像中的好！所以鸟哥不建议使用。</p>
</li>
<li><p><code>模式1，自动备援模式（Active-backup）：</code><br>假设有三个网卡做成这种bonding模式的话，那么永远都只有一个网卡会运作，我们称之为主要网卡（primary）！除非这个主要网卡连线失败了，另一张网卡（slave）才会扶正而成为下一个主要网卡，并持续提供服务。这种模式并不会合并频宽，只会用在连线的容错而已。</p>
</li>
<li><p><code>模式4，LACP链路聚合模式（IEEE 802.3ad Dynamic link aggregation）：</code><br>这种模式算是业界的标准支援吧！你的网卡启动在这种模式下，然后让串接到这些网卡的交换机端口设定好LACP群组，这样就能够达成与LACP相同的频宽倍增功能！这种模式得要有支持网管且提供LACP设定的交换机才行！这种模式可以同时提供合并频宽与网络容错！</p>
</li>
<li><p><code>模式5，自动调整传输负载平衡（Adaptive transmit load balancing，balance-tlb）：</code><br>在传送方面，这种模式会将封包分散在各个可用的bonding网卡上送出，因此传送才能够达到合并频宽。不过在接收封包时，由于考虑到交换机的MAC记忆能力，因此仅有一个网卡的MAC会被记录于交换机上头，简单的说，就是仅有一张网卡会用于接收！除非该接收网卡挂点，否则其他网卡不会被用于接收上。这种模式也算挺适合用在「主要在发送资料给用户端的服务器」上，如果服务器也要负责大量资料的接收，恐怕就不是这么适合了。</p>
</li>
<li><p><code>模式6，自动调整全负载平衡（Adaptive transmit load balancing，balance-alb）：</code><br>这个模式包括了模式5，除了传送可以合并频宽之外，连接收也可以合并频宽了。当服务器要传资料出去给用户端时，bonding模组会主动的拦截封包，并透过ARP协商机制（ARP就是透过IP去找出MAC的通讯协定），将不同的网卡要送出到同一个用户端的封包，都改写成单一一个固定的发送端MAC位址，如此一来，发送有合并频宽的功能了，但接收却还是只有一个MAC而已对吧？那怎么说接收有合并频宽的负载平衡机制呢？</p>
<p>  原因是这样的：当有资料封包要送出到多个不同的用户端时，此模式的bonding模组就会透过ARP协商机制，找出bonding管理的比较闲置的网卡MAC分配给下个用户端，如此一来，不同的用户端回传给服务器的资料，就可以透过不同的网卡来接收，就能达到接收也合并频宽的功能了。</p>
<p>  这个模式不需要特别的交换机支援，而且设定简单，可以在接收，传送都达成合并频宽的能力，且也具有基本的网路容错功能，是目前鸟哥最爱使用的绑定模式啦！</p>
</li>
</ul>
<h1 id="常用的三种Bonding模式"><a href="#常用的三种Bonding模式" class="headerlink" title="常用的三种Bonding模式"></a>常用的三种Bonding模式</h1><p>mode=0：平衡负载模式，有自动备援，但需要交换机支支援及设定。<br>mode=1：自动备援模式，其中一条线若断线，其他线路将会自动备援。<br>mode=6：平衡负载模式，有自动备援，不需要交换机支援及设定。</p>
<h1 id="Bond-应用场景"><a href="#Bond-应用场景" class="headerlink" title="Bond 应用场景"></a>Bond 应用场景</h1><p>你得要知道为什么要做bonding呢？可能的原因有两个：</p>
<ul>
<li>为了让网卡连线有备援，因此断了一条网线的时候，另一条网卡会主动接管</li>
<li>为了增加频宽</li>
</ul>
<p>如果是为了第一点，那使用bonding模式1（Active-backup）的功能最好！<br>如果是为了第二点，那你得要注意，就是你服务器提供的资料速度要比两张网卡更快，所以你的硬盘不能太慢（当然，如果传输的资料是在内存上，那就无关硬盘）<br>所以，如果是为了增加频宽，那你就应该要有这样的想法：</p>
<ul>
<li>你的服务器总体读/写速度要高于所有网卡的频宽总和才好</li>
<li>你的网卡所连接的交换机总背板频宽（bandwidth）要能够负荷邦定的最高流量</li>
<li>用户端的数量要比网卡数还要多才合理</li>
</ul>
<h1 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h1><p>模式：mode=6<br>eth0：私有地址<br>bond： eth1 eth2 双网卡绑定</p>
<p>一些设置<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>init.d/NetworkManager stop</span><br><span class="line">chkconfig NetworkManager off</span><br><span class="line"><span class="regexp">/etc/</span>init.d/network restart</span><br><span class="line"><span class="regexp">/etc/</span>init.d/iptables stop</span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/'</span> <span class="regexp">/etc/</span>selinux/config</span><br></pre></td></tr></table></figure></p>
<h1 id="Bond-配置"><a href="#Bond-配置" class="headerlink" title="Bond 配置"></a>Bond 配置</h1><h2 id="查看网卡状态"><a href="#查看网卡状态" class="headerlink" title="查看网卡状态"></a>查看网卡状态</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nmcli conn show</span><br><span class="line"></span><br><span class="line">NAME                UUID                                 <span class="built_in"> TYPE </span>     DEVICE </span><br><span class="line">Wired<span class="built_in"> connection </span>1  fe17083e-df87-3723-bdb9-010cf77fa1db <span class="built_in"> ethernet </span> eth1   </span><br><span class="line">Wired<span class="built_in"> connection </span>2  175c3f7f-ab9a-31d2-b86d-03e64c383830 <span class="built_in"> ethernet </span> eth2   </span><br><span class="line">eth0                5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03 <span class="built_in"> ethernet </span> eth0</span><br></pre></td></tr></table></figure>
<h2 id="建立bonding网卡"><a href="#建立bonding网卡" class="headerlink" title="建立bonding网卡"></a>建立bonding网卡</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span><span class="builtin-name">add</span> con-name bond0 ifname bond0<span class="built_in"> type </span>bond bond.options <span class="string">"miimon=100,mode=6"</span></span><br></pre></td></tr></table></figure>
<p>查看状态<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span>show </span><br><span class="line"></span><br><span class="line">NAME                UUID                                 <span class="built_in"> TYPE </span>     DEVICE </span><br><span class="line">Wired<span class="built_in"> connection </span>1  fe17083e-df87-3723-bdb9-010cf77fa1db <span class="built_in"> ethernet </span> eth1   </span><br><span class="line">Wired<span class="built_in"> connection </span>2  175c3f7f-ab9a-31d2-b86d-03e64c383830 <span class="built_in"> ethernet </span> eth2   </span><br><span class="line">bond0               8bda5484-3841-4318-8642-995d6a2faeaf  bond      bond0  </span><br><span class="line">eth0                5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03 <span class="built_in"> ethernet </span> eth0</span><br></pre></td></tr></table></figure></p>
<h2 id="将eth1和eth2-绑定到bond0"><a href="#将eth1和eth2-绑定到bond0" class="headerlink" title="将eth1和eth2 绑定到bond0"></a>将eth1和eth2 绑定到bond0</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span><span class="builtin-name">add</span> con-name eth1 ifname eth1<span class="built_in"> type </span>bond-slave master bond0</span><br><span class="line">nmcli<span class="built_in"> connection </span><span class="builtin-name">add</span> con-name eth2 ifname eth2<span class="built_in"> type </span>bond-slave master bond0</span><br></pre></td></tr></table></figure>
<p>查看状态<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span>show</span><br><span class="line"></span><br><span class="line">NAME                UUID                                 <span class="built_in"> TYPE </span>     DEVICE </span><br><span class="line">Wired<span class="built_in"> connection </span>1  fe17083e-df87-3723-bdb9-010cf77fa1db <span class="built_in"> ethernet </span> eth1   </span><br><span class="line">Wired<span class="built_in"> connection </span>2  175c3f7f-ab9a-31d2-b86d-03e64c383830 <span class="built_in"> ethernet </span> eth2   </span><br><span class="line">bond0               8bda5484-3841-4318-8642-995d6a2faeaf  bond      bond0  </span><br><span class="line">eth0                5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03 <span class="built_in"> ethernet </span> eth0   </span><br><span class="line">eth1                5f5c0a0e-a0e4-430a-95de-5178126c6932 <span class="built_in"> ethernet </span> --     </span><br><span class="line">eth2                b573daec-ab0b-4f86-839b-ca2536bcfc99 <span class="built_in"> ethernet </span> --</span><br></pre></td></tr></table></figure></p>
<h2 id="设置静态IP"><a href="#设置静态IP" class="headerlink" title="设置静态IP"></a>设置静态IP</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span>modify bond0 ipv4.method<span class="built_in"> manual </span>ipv4.addresses 192.168.8.10/24 ipv4.gateway 192.168.8.2</span><br><span class="line">nmcli<span class="built_in"> connection </span>modify bond0 ipv4.method manual</span><br></pre></td></tr></table></figure>
<h2 id="激活bond0-eth1-eth2"><a href="#激活bond0-eth1-eth2" class="headerlink" title="激活bond0 eth1 eth2"></a>激活bond0 eth1 eth2</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span>up bond0</span><br><span class="line">nmcli<span class="built_in"> connection </span>up eth1</span><br><span class="line">nmcli<span class="built_in"> connection </span>up eth2</span><br></pre></td></tr></table></figure>
<p>查看状态<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span>show</span><br><span class="line"></span><br><span class="line">NAME                UUID                                 <span class="built_in"> TYPE </span>     DEVICE </span><br><span class="line">bond0               8bda5484-3841-4318-8642-995d6a2faeaf  bond      bond0  </span><br><span class="line">eth0                5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03 <span class="built_in"> ethernet </span> eth0   </span><br><span class="line">eth1                5f5c0a0e-a0e4-430a-95de-5178126c6932 <span class="built_in"> ethernet </span> eth1   </span><br><span class="line">eth2                b573daec-ab0b-4f86-839b-ca2536bcfc99 <span class="built_in"> ethernet </span> eth2   </span><br><span class="line">Wired<span class="built_in"> connection </span>1  fe17083e-df87-3723-bdb9-010cf77fa1db <span class="built_in"> ethernet </span> --     </span><br><span class="line">Wired<span class="built_in"> connection </span>2  175c3f7f-ab9a-31d2-b86d-03e64c383830 <span class="built_in"> ethernet </span> --</span><br></pre></td></tr></table></figure></p>
<h2 id="查看bonding状态"><a href="#查看bonding状态" class="headerlink" title="查看bonding状态"></a>查看bonding状态</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat /<span class="keyword">proc</span>/net/bonding/bond0 </span><br><span class="line"></span><br><span class="line">Ethernet<span class="title"> Channel</span> Bonding<span class="title"> Driver:</span> v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding<span class="title"> Mode:</span> adaptive<span class="title"> load</span> balancing</span><br><span class="line">Primary<span class="title"> Slave:</span> None</span><br><span class="line">Currently<span class="title"> Active</span> Slave:<span class="title"> eth1</span></span><br><span class="line"><span class="title">MII</span> Status:<span class="title"> up</span></span><br><span class="line"><span class="title">MII</span> Polling<span class="title"> Interval</span> (ms): 100</span><br><span class="line">Up<span class="title"> Delay</span> (ms): 0</span><br><span class="line">Down<span class="title"> Delay</span> (ms): 0</span><br><span class="line"></span><br><span class="line">Slave<span class="title"> Interface:</span> eth1</span><br><span class="line">MII<span class="title"> Status:</span> up</span><br><span class="line">Speed: 1000<span class="title"> Mbps</span></span><br><span class="line"><span class="title">Duplex:</span> full</span><br><span class="line">Link<span class="title"> Failure</span> Count: 0</span><br><span class="line">Permanent<span class="title"> HW</span> addr: 00:0c:29:03:24:4a</span><br><span class="line">Slave<span class="title"> queue</span> ID: 0</span><br><span class="line"></span><br><span class="line">Slave<span class="title"> Interface:</span> eth2</span><br><span class="line">MII<span class="title"> Status:</span> up</span><br><span class="line">Speed: 1000<span class="title"> Mbps</span></span><br><span class="line"><span class="title">Duplex:</span> full</span><br><span class="line">Link<span class="title"> Failure</span> Count: 0</span><br><span class="line">Permanent<span class="title"> HW</span> addr: 00:0c:29:03:24:54</span><br><span class="line">Slave<span class="title"> queue</span> ID: 0</span><br></pre></td></tr></table></figure>
<h2 id="故障测试"><a href="#故障测试" class="headerlink" title="故障测试"></a>故障测试</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /<span class="keyword">proc</span>/net/bonding/bond0  |<span class="title"> grep</span> "Currently<span class="title"> Active</span> Slave"</span><br><span class="line">Currently<span class="title"> Active</span> Slave:<span class="title"> eth1</span></span><br></pre></td></tr></table></figure>
<p>ping bond0 ip,拔掉eth1网线，会自动切换到eth2,ping不中断<br>或命令<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="keyword">link</span> <span class="built_in">set</span> eth1 down</span><br><span class="line">#ip <span class="keyword">link</span> <span class="built_in">set</span> eth1 up</span><br></pre></td></tr></table></figure></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ping 192.168.8.10</span><br><span class="line"></span><br><span class="line">PING 192.168.8.10 (192.168.8.10) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.352 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.179 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.157 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.197 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=5 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.197 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=6 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.205 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=7 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.298 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=8 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.281 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.8.10: <span class="attribute">icmp_seq</span>=9 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.285 ms</span><br></pre></td></tr></table></figure>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat /<span class="keyword">proc</span>/net/bonding/bond0 </span><br><span class="line"></span><br><span class="line">Ethernet<span class="title"> Channel</span> Bonding<span class="title"> Driver:</span> v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding<span class="title"> Mode:</span> adaptive<span class="title"> load</span> balancing</span><br><span class="line">Primary<span class="title"> Slave:</span> None</span><br><span class="line">Currently<span class="title"> Active</span> Slave:<span class="title"> eth2</span></span><br><span class="line"><span class="title">MII</span> Status:<span class="title"> up</span></span><br><span class="line"><span class="title">MII</span> Polling<span class="title"> Interval</span> (ms): 100</span><br><span class="line">Up<span class="title"> Delay</span> (ms): 0</span><br><span class="line">Down<span class="title"> Delay</span> (ms): 0</span><br><span class="line"></span><br><span class="line">Slave<span class="title"> Interface:</span> eth1</span><br><span class="line">MII<span class="title"> Status:</span> down</span><br><span class="line">Speed:<span class="title"> Unknown</span></span><br><span class="line"><span class="title">Duplex:</span> Unknown</span><br><span class="line">Link<span class="title"> Failure</span> Count: 1</span><br><span class="line">Permanent<span class="title"> HW</span> addr: 00:0c:29:03:24:4a</span><br><span class="line">Slave<span class="title"> queue</span> ID: 0</span><br><span class="line"></span><br><span class="line">Slave<span class="title"> Interface:</span> eth2</span><br><span class="line">MII<span class="title"> Status:</span> up</span><br><span class="line">Speed: 1000<span class="title"> Mbps</span></span><br><span class="line"><span class="title">Duplex:</span> full</span><br><span class="line">Link<span class="title"> Failure</span> Count: 0</span><br><span class="line">Permanent<span class="title"> HW</span> addr: 00:0c:29:03:24:54</span><br><span class="line">Slave<span class="title"> queue</span> ID: 0</span><br></pre></td></tr></table></figure>
<h2 id="删除bonding"><a href="#删除bonding" class="headerlink" title="删除bonding"></a>删除bonding</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span>delete eth1</span><br><span class="line">nmcli<span class="built_in"> connection </span>delete eth2</span><br><span class="line">nmcli<span class="built_in"> connection </span>delete bond0</span><br></pre></td></tr></table></figure>
<h1 id="脚本1-NetworkManager命令"><a href="#脚本1-NetworkManager命令" class="headerlink" title="脚本1 NetworkManager命令"></a>脚本1 NetworkManager命令</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmcli<span class="built_in"> connection </span><span class="builtin-name">add</span> con-name bond0 ifname bond0<span class="built_in"> type </span>bond bond.options <span class="string">"miimon=100,mode=6"</span></span><br><span class="line">nmcli<span class="built_in"> connection </span><span class="builtin-name">add</span> con-name eth1 ifname eth1<span class="built_in"> type </span>bond-slave master bond0</span><br><span class="line">nmcli<span class="built_in"> connection </span><span class="builtin-name">add</span> con-name eth2 ifname eth2<span class="built_in"> type </span>bond-slave master bond0</span><br><span class="line">nmcli<span class="built_in"> connection </span>modify bond0 ipv4.method<span class="built_in"> manual </span>ipv4.addresses 192.168.8.10/24 ipv4.gateway 192.168.8.2</span><br><span class="line">nmcli conn modify bond0 ipv4.dns 192.168.8.2</span><br><span class="line">nmcli<span class="built_in"> connection </span>modify bond0 ipv4.method manual</span><br><span class="line">nmcli<span class="built_in"> connection </span>up bond0</span><br><span class="line">nmcli<span class="built_in"> connection </span>up eth1</span><br><span class="line">nmcli<span class="built_in"> connection </span>up eth2</span><br><span class="line">cat /proc/net/bonding/bond0</span><br></pre></td></tr></table></figure>
<h1 id="脚本2-Shell"><a href="#脚本2-Shell" class="headerlink" title="脚本2 Shell"></a>脚本2 Shell</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt;/etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line"><span class="attribute">BONDING_OPTS</span>=<span class="string">"miimon=100 mode=balance-alb"</span></span><br><span class="line"><span class="attribute">TYPE</span>=Bond</span><br><span class="line"><span class="attribute">BONDING_MASTER</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attribute">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">BOOTPROTO</span>=none</span><br><span class="line"><span class="attribute">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">NAME</span>=bond0</span><br><span class="line"><span class="attribute">DEVICE</span>=bond0</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPADDR</span>=192.168.8.10</span><br><span class="line"><span class="attribute">PREFIX</span>=24</span><br><span class="line"><span class="attribute">GATEWAY</span>=192.168.8.2</span><br><span class="line"><span class="attribute">DNS1</span>=192.168.8.2</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt;/etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line"><span class="attribute">TYPE</span>=Ethernet</span><br><span class="line"><span class="attribute">NAME</span>=eth1</span><br><span class="line"><span class="attribute">DEVICE</span>=eth1</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">MASTER</span>=bond0</span><br><span class="line"><span class="attribute">SLAVE</span>=<span class="literal">yes</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt;/etc/sysconfig/network-scripts/ifcfg-eth2</span><br><span class="line"><span class="attribute">TYPE</span>=Ethernet</span><br><span class="line"><span class="attribute">NAME</span>=eth2</span><br><span class="line"><span class="attribute">DEVICE</span>=eth2</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">MASTER</span>=bond0</span><br><span class="line"><span class="attribute">SLAVE</span>=<span class="literal">yes</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart<span class="built_in"> network </span></span><br><span class="line">cat /proc/net/bonding/bond0</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="http://dic.vbird.tw/linux_server/unit03.php" target="_blank" rel="noopener">http://dic.vbird.tw/linux_server/unit03.php</a></p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/jenkins-gitlab/" data-toggle="tooltip" data-placement="top" title="持续集成 Jenkins Gitlab">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/centos7-teaming-bridge/" data-toggle="tooltip" data-placement="top" title="CentOS 7 Teaming 和 Bridge">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                

            </div>
    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#bonding" title="bonding">bonding</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://jaminzhang.github.io" target="_blank">JAMIN ZHANG</a></li>
                    
                        <li><a href="#" target="_blank">It helps SEO</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/sundayle">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Sunday 2019 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>
                    Ported by <a href="https://github.com/Kaijun/hexo-theme-huxblog">Kaijun</a>
            <!-- 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
            -->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
     async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-70699634-1';
    var _gaDomain = 'auto';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
