<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Linux运维笔记">
    <meta name="keyword"  content="sunday,sundayhk,sundayle,sunday博客,Linxu,运维">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Nmap 渗透使用指南 - Sunday博客 | Sunday Blog
        
    </title>

    <link rel="canonical" href="http://www.sundayle.com/nmap-penetration/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Sunday</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://www.sundayle.com/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                    </div>
                    <h1>Nmap 渗透使用指南</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Sunday on
                        2018-08-21
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><strong>nmap是用来探测计算机网络上的主机和服务的一种安全扫描器。为了绘制网络拓扑图Nmap的发送特制的数据包到目标主机然后对返回数据包进行分析。Nmap是一款枚举和测试网络的强大工具。</strong></p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>主机探测</li>
<li>端口扫描</li>
<li>版本检测</li>
<li>支持探测脚本的编写</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>官网:<a href="http://nmap.org/" target="_blank" rel="noopener">http://nmap.org</a> 图形化:Zenmap</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="基本快速扫描"><a href="#基本快速扫描" class="headerlink" title="基本快速扫描"></a>基本快速扫描</h3><p>Nmap 默认发送一个arp的ping数据包来探测目标主机在1-10000范围内所开放的端口。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> 10<span class="selector-class">.130</span><span class="selector-class">.1</span><span class="selector-class">.43</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/7a99f26738aee77954749946ffde70702.png">
<h3 id="快速扫描多个目标"><a href="#快速扫描多个目标" class="headerlink" title="快速扫描多个目标"></a>快速扫描多个目标</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> &lt;<span class="selector-tag">target</span> <span class="selector-tag">ip1</span> <span class="selector-tag">address</span>&gt; &lt;<span class="selector-tag">target</span> <span class="selector-tag">ip2</span> <span class="selector-tag">address</span>&gt;</span><br><span class="line"><span class="selector-tag">nmap</span> 10<span class="selector-class">.130</span><span class="selector-class">.1</span><span class="selector-class">.28</span> 10<span class="selector-class">.130</span><span class="selector-class">.1</span><span class="selector-class">.43</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/84cf294c80a9769b62c65b2ffc89f8ca2.png">
<h3 id="详细描述输出扫描"><a href="#详细描述输出扫描" class="headerlink" title="详细描述输出扫描"></a>详细描述输出扫描</h3><p>简单扫描并对返回的结果详细描述输出,这个扫描是可以看到扫描的过程的,漫长的扫描的过程中可以看到百分比 就不会显得那么枯燥而且可以提升逼格。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-vv</span> 10<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.254</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/2d1cc547df2216922c1e63f628ba6c8c2.png">
<p>亲测,<code>-v</code>和<code>-vv</code>扫描几乎是一样都都是列出了详细的扫描过程。</p>
<h3 id="指定端口和范围扫描"><a href="#指定端口和范围扫描" class="headerlink" title="指定端口和范围扫描"></a>指定端口和范围扫描</h3><p>nmap 默认扫描目标1-10000范围内的端口号。我们则可以通过参数<code>-p</code> 来设置我们将要扫描的端口号</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -p(range) &lt;target IP&gt; </span><br><span class="line">namp -p3389,<span class="number">20</span><span class="number">-100</span> <span class="number">10.130</span><span class="number">.1</span><span class="number">.43</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/a7831003f408a738c79c936cae6323012.png">
<h3 id="扫描除过某一个ip外的所有子网主机"><a href="#扫描除过某一个ip外的所有子网主机" class="headerlink" title="扫描除过某一个ip外的所有子网主机"></a>扫描除过某一个ip外的所有子网主机</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="number">10.130</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span> -exclude <span class="number">10.130</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
<h3 id="扫描除过某一个文件中的ip外的子网主机"><a href="#扫描除过某一个文件中的ip外的子网主机" class="headerlink" title="扫描除过某一个文件中的ip外的子网主机"></a>扫描除过某一个文件中的ip外的子网主机</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="number">10.130</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span> -excludefile gov.txt</span><br></pre></td></tr></table></figure>
<h3 id="显示扫描的所有主机的列表"><a href="#显示扫描的所有主机的列表" class="headerlink" title="显示扫描的所有主机的列表"></a>显示扫描的所有主机的列表</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sL <span class="number">10.130</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>
<h3 id="sP-ping-扫描"><a href="#sP-ping-扫描" class="headerlink" title="sP ping 扫描"></a>sP ping 扫描</h3><p>nmap 可以利用类似window/linux 系统下的ping方式进行扫描</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">nmap</span> -<span class="built_in">sP</span> &lt;target <span class="built_in">ip</span>&gt;</span><br></pre></td></tr></table></figure>
<p>一般来说 我们会用这个命令去扫描内网的一个ip范围用来做内网的主机发现。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP <span class="number">10.130</span><span class="number">.1</span><span class="number">.1</span><span class="number">-255</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/be85970d09cd8416a30de562cb3cc9d22.png">
<p>PING扫描不同于其它的扫描方式因为它只用于找出主机是否是存在在网络中的.它不是用来发现是否开放端口的.PING扫描需要ROOT权限如果用户没有ROOT权限,PING扫描将会使用connect()调用.</p>
<h3 id="sS-SYN半开放扫描"><a href="#sS-SYN半开放扫描" class="headerlink" title="sS SYN半开放扫描"></a>sS SYN半开放扫描</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-sS</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.1</span></span><br></pre></td></tr></table></figure>
<p>Tcp SYN Scan (sS) 这是一个基本的扫描方式,它被称为半开放扫描因为这种技术使得Nmap不需要通过完整的握手就能获得远程主机的信息。Nmap发送SYN包到远程主机但是它不会产生任何会话.因此<code>不会在目标主机上产生任何日志记录</code>,因为没有形成会话。这个就是SYN扫描的优势.如果Nmap命令中没有指出扫描类型,默认的就是<code>Tcp SYN</code>.但是它需要<code>root/administrator</code>权限。</p>
<h3 id="sT-TCP扫描"><a href="#sT-TCP扫描" class="headerlink" title="sT TCP扫描"></a>sT TCP扫描</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-sT</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.1</span></span><br></pre></td></tr></table></figure>
<p>不同于Tcp SYN扫描,Tcp connect()扫描需要完成三次握手,并且要求调用系统的connect().Tcp connect()扫描技术只适用于找出TCP和UDP端口。</p>
<h3 id="sU-UDP扫描"><a href="#sU-UDP扫描" class="headerlink" title="sU UDP扫描"></a>sU UDP扫描</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-sU</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.1</span></span><br></pre></td></tr></table></figure>
<p>这种扫描技术用来寻找目标主机打开的UDP端口.它不需要发送任何的SYN包因为这种技术是针对UDP端口的。UDP扫描发送UDP数据包到目标主机并等待响应,如果返回ICMP不可达的错误消息说明端口是关闭的如果得到正确的适当的回应说明端口是开放的.</p>
<h3 id="sF-FIN标志的数据包扫描"><a href="#sF-FIN标志的数据包扫描" class="headerlink" title="sF FIN标志的数据包扫描"></a>sF FIN标志的数据包扫描</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-sF</span> 110<span class="selector-class">.130</span><span class="selector-class">.1</span><span class="selector-class">.43</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/69faf2da979ac568ed8da0a7e43bfbb52.png">
<p>可以看出这个扫描的话 会漏扫许多~FIN扫描也不会在目标主机上创建日志(FIN扫描的优势之一).个类型的扫描都是具有差异性的,FIN扫描发送的包只包含FIN标识,NULL扫描不发送数据包上的任何字节,XMAS扫描发送FIN、PSH和URG标识的数据包.</p>
<h3 id="sV-Version版本检测扫描"><a href="#sV-Version版本检测扫描" class="headerlink" title="sV Version版本检测扫描"></a>sV Version版本检测扫描</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-sV</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.135</span></span><br></pre></td></tr></table></figure>
<p>本检测是用来扫描目标主机和端口上<code>运行的软件的版本</code>.它不同于其它的扫描技术它不是用来扫描目标主机上开放的端口不过它需要从开放的端口获取信息来判断软件的版本.使用版本检测扫描之前需要先用TCPSYN扫描开放了哪些端口。</p>
<img src="http://himg.sundayle.com/static/images/16ea3189e276882654389187547f8d172.png">
<p>这个扫描的话速度会慢一些<code>67.86</code>秒扫一个IP。</p>
<h3 id="O-OS操作系统类型的探测"><a href="#O-OS操作系统类型的探测" class="headerlink" title="O OS操作系统类型的探测"></a>O OS操作系统类型的探测</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-O</span> 10<span class="selector-class">.130</span><span class="selector-class">.1</span><span class="selector-class">.43</span></span><br></pre></td></tr></table></figure>
<p>远程检测操作系统和软件Nmap的OS检测技术在渗透测试中用来了解远程主机的操作系统和软件是非常有用的通过获取的信息你可以知道已知的漏洞。Nmap有一个名为的nmap-OS-DB数据库该数据库包含超过2600操作系统的信息。Nmap把TCP和UDP数据包发送到目标机器上然后检查结果和数据库对照。</p>
<img src="http://himg.sundayle.com/static/images/876b72b265d05483defd3d7aefd8b69d2.png">
<h3 id="osscan-guess-猜测匹配操作系统"><a href="#osscan-guess-猜测匹配操作系统" class="headerlink" title="osscan-guess 猜测匹配操作系统"></a>osscan-guess 猜测匹配操作系统</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-O</span> <span class="selector-tag">--osscan-guess</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.134</span></span><br></pre></td></tr></table></figure>
<p>通过Nmap准确的检测到远程操作系统是比较困难的需要使用到Nmap的猜测功能选项,<code>–osscan-guess</code>猜测认为最接近目标的匹配操作系统类型。</p>
<img src="http://himg.sundayle.com/static/images/3164656366472cd41b7f37c56de77b932.png">
<h2 id="PN-No-ping扫描"><a href="#PN-No-ping扫描" class="headerlink" title="PN No ping扫描"></a>PN No ping扫描</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -O -PN <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>
<p>如果远程主机有防火墙IDS和IPS系统你可以使用-PN命令来确保不ping远程主机因为有时候防火墙会组织掉ping请求.-PN命令告诉Nmap不用ping远程主机。使用-PN参数可以绕过PING命令,但是不影响主机的系统的发现。</p>
<img src="http://himg.sundayle.com/static/images/a4c9bc8226dd10c95e2dd5dd2525310e2.png">
<p>这个扫描整个c段局域网的话还是比较耗时的但是信息收集很详细大概耗时<code>9</code>分钟。</p>
<h2 id="T-设置时间模板"><a href="#T-设置时间模板" class="headerlink" title="T 设置时间模板"></a>T 设置时间模板</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -T&lt;<span class="number">0</span><span class="number">-5</span>&gt; <span class="number">192.168</span><span class="number">.1</span><span class="number">.134</span></span><br></pre></td></tr></table></figure>
<p>优化时间控制选项的功能很强大也很有效但有些用户会被迷惑。此外 往往选择合适参数的时间超过了所需优化的扫描时间。因此Nmap提供了一些简单的 方法使用6个时间模板使用时采用-T选项及数字(0 – 5) 或名称。模板名称有<code>paranoid (0)、sneaky (1)、polite (2)、normal(3)、 aggressive (4)和insane (5)</code></p>
<ul>
<li>paranoid、sneaky模式用于IDS躲避</li>
<li>Polite模式降低了扫描 速度以使用更少的带宽和目标主机资源。</li>
<li>Normal为默认模式因此-T3 实际上是未做任何优化。</li>
<li>Aggressive模式假设用户具有合适及可靠的网络从而加速 扫描.</li>
<li>nsane模式假设用户具有特别快的网络或者愿意为获得速度而牺牲准确性。</li>
</ul>
<h3 id="网段扫描格式"><a href="#网段扫描格式" class="headerlink" title="网段扫描格式"></a>网段扫描格式</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">nmap</span> -<span class="built_in">sP</span> &lt;network <span class="keyword">address </span>&gt; &lt;/CIDR &gt;</span><br></pre></td></tr></table></figure>
<p>解释CIDR 为你设置的子网掩码<code>(/24 , /16 ,/8 等)</code></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span>  =  <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">-10.1</span><span class="number">.1</span><span class="number">.255</span>       #c段扫描</span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">16</span>  =  <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">-10.1</span><span class="number">.255</span><span class="number">.255</span>     #b段扫描</span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">8</span>   =  <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">-10.255</span><span class="number">.255</span><span class="number">.255</span>   #a段扫描</span><br></pre></td></tr></table></figure>
<h3 id="从文件中读取需要扫描的IP列表"><a href="#从文件中读取需要扫描的IP列表" class="headerlink" title="从文件中读取需要扫描的IP列表"></a>从文件中读取需要扫描的IP列表</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -iL ip-<span class="selector-tag">address</span>.txt</span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/cc6e92b7ccd9e08e6d1cc3ab449d4d792.png">
<h3 id="路由跟踪扫描"><a href="#路由跟踪扫描" class="headerlink" title="路由跟踪扫描"></a>路由跟踪扫描</h3><p>路由器追踪功能能够帮网络管理员了解网络通行情况同时也是网络管理人员很好的辅助工具通过路由器追踪可以轻松的查处从我们电脑所在地到目标地之间所经常的网络节点并可以看到通过各个节点所花费的时间</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -traceroute www<span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/f2a28889bb2e9cf9998df5be554618052.png">
<h3 id="A-OS识别-版本探测-脚本扫描和traceroute综合扫描"><a href="#A-OS识别-版本探测-脚本扫描和traceroute综合扫描" class="headerlink" title="A OS识别,版本探测,脚本扫描和traceroute综合扫描"></a>A OS识别,版本探测,脚本扫描和traceroute综合扫描</h3><p>此选项设置包含了1-10000的端口ping扫描操作系统扫描脚本扫描路由跟踪服务探测。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nmap</span> <span class="selector-tag">-A</span> 10<span class="selector-class">.130</span><span class="selector-class">.1</span><span class="selector-class">.43</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/4dab6997bdc8689a89aa90e792ac08a32.png">
<h3 id="命令混合式扫描"><a href="#命令混合式扫描" class="headerlink" title="命令混合式扫描"></a>命令混合式扫描</h3><p>命令混合扫描可以做到类似参数-A所完成的功能但又能细化到我们所需特殊要求。所以一般高手选择这个混合扫描</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -vv -p1<span class="number">-100</span>,<span class="number">3306</span>,<span class="number">3389</span> -O -traceroute <span class="number">10.130</span><span class="number">.1</span><span class="number">.43</span></span><br></pre></td></tr></table></figure>
<p>这些参数都是可以灵活调用的具体根据具体的扫描来使用各个参数。</p>
<img src="http://himg.sundayle.com/static/images/00cc7fccb3dc60ebdedbe4e5bb77a9072.png">
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p1<span class="number">-65535</span> -sV -sS -T4 <span class="number">10.130</span><span class="number">.1</span><span class="number">.134</span></span><br></pre></td></tr></table></figure>
<p>使<code>SYN</code>扫描并进行Version版本检测 使用T4(aggressive)的时间模板对目标ip的全端口进行扫描。</p>
<h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h3><p>扫描的结果输出到屏幕,同时会存储一份到grep-output.txt</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p <span class="number">139</span>,<span class="number">445</span> -oG grep-output.txt <span class="number">10.0</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>
<p>扫描结果输出为html</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -sV -T5 <span class="number">10.0</span><span class="number">.1</span><span class="number">.99</span> --webxml -oX - | xsltproc --output file.html</span><br></pre></td></tr></table></figure>
<h2 id="nmap高级用法之脚本使用"><a href="#nmap高级用法之脚本使用" class="headerlink" title="nmap高级用法之脚本使用"></a>nmap高级用法之脚本使用</h2><h3 id="按照脚本分类进行扫描"><a href="#按照脚本分类进行扫描" class="headerlink" title="按照脚本分类进行扫描"></a>按照脚本分类进行扫描</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="comment">--script 类别</span></span><br></pre></td></tr></table></figure>
<p>nmap官方脚本文档: <a href="https://nmap.org/nsedoc/" target="_blank" rel="noopener">https://nmap.org/nsedoc/</a></p>
<img src="http://himg.sundayle.com/static/images/7822ed61bd955f648b1fae0408c09fa02.png">
<p>左侧列出了脚本的分类点击分类 可以看到每一个分类下有很多具体的脚本供我们使用。<code>nmap --script=类别</code>这里的类别可以填写下面14大分类中的其中之一也可以填写分类里面的具体漏洞扫描脚本。nmap脚本分类:</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"> <span class="symbol">auth:</span> 负责处理鉴权证书绕开鉴权的脚本  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">broadcast:</span> 在局域网内探查更多服务开启状况如dhcp/dns/sqlserver等服务  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">brute:</span> 提供暴力破解方式针对常见的应用如http/snmp等  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">default:</span> 使用-sC或-A选项扫描时候默认的脚本提供基本脚本扫描能力  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">discovery:</span> 对网络进行更多的信息如SMB枚举、SNMP查询等  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">dos:</span> 用于进行拒绝服务攻击  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">exploit:</span> 利用已知的漏洞入侵系统  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">external:</span> 利用第三方的数据库或资源例如进行whois解析  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">fuzzer:</span> 模糊测试的脚本发送异常的包到目标机探测出潜在漏洞 </span></span><br><span class="line"><span class="ruby">- <span class="symbol">intrusive:</span> 入侵性的脚本此类脚本可能引发对方的IDS/IPS的记录或屏蔽</span></span><br><span class="line"><span class="ruby">- <span class="symbol">malware:</span> 探测目标机是否感染了病毒、开启了后门等信息  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">safe:</span> 此类与intrusive相反属于安全性脚本  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">version:</span> 负责增强服务与版本扫描Version Detection功能的脚本  </span></span><br><span class="line"><span class="ruby">- <span class="symbol">vuln:</span> 负责检查目标机是否有常见的漏洞Vulnerability如是否有MS08_067</span></span><br></pre></td></tr></table></figure>
<h3 id="使用具体脚本进行扫描"><a href="#使用具体脚本进行扫描" class="headerlink" title="使用具体脚本进行扫描"></a>使用具体脚本进行扫描</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script 具体的脚本 www<span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<h3 id="常用脚本使用案例"><a href="#常用脚本使用案例" class="headerlink" title="常用脚本使用案例"></a>常用脚本使用案例</h3><h4 id="扫描服务器的常见漏洞"><a href="#扫描服务器的常见漏洞" class="headerlink" title="扫描服务器的常见漏洞"></a>扫描服务器的常见漏洞</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">nmap</span> --script vuln <span class="symbol">&lt;target&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="检查FTP是否开启匿名登陆"><a href="#检查FTP是否开启匿名登陆" class="headerlink" title="检查FTP是否开启匿名登陆"></a>检查FTP是否开启匿名登陆</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nmap --script ftp-anon &lt;target&gt;</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">21/tcp open  ftp</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| -rw-r--r--   1 1170     924            31 Mar 28  2001 .banner</span><br><span class="line">| d--x--x--x   2 root     root         1024 Jan 14  2002 bin</span><br><span class="line">| d--x--x--x   2 root     root         1024 Aug 10  1999 etc</span><br><span class="line">| drwxr-srwt   2 1170     924          2048 Jul 19 18:48<span class="built_in"> incoming </span>[NSE: writeable]</span><br><span class="line">| d--x--x--x   2 root     root         1024 Jan 14  2002 lib</span><br><span class="line">| drwxr-sr-x   2 1170     924          1024 Aug  5  2004 pub</span><br><span class="line">|_Only 6 shown. Use --script-args ftp-anon.<span class="attribute">maxlist</span>=-1 <span class="keyword">to</span> see all.</span><br></pre></td></tr></table></figure>
<h4 id="对MySQL进行暴破解"><a href="#对MySQL进行暴破解" class="headerlink" title="对MySQL进行暴破解"></a>对MySQL进行暴破解</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nmap --script=mysql-brute <span class="variable">&lt;target&gt;</span></span><br><span class="line">3306/tcp open  mysql</span><br><span class="line">|<span class="string"> mysql-brute:</span></span><br><span class="line">|<span class="string">   Accounts</span></span><br><span class="line">|<span class="string">     root:root - Valid credentials</span></span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/5bb8e360090ff1da26b303ecf7d5e69e2.png">
<p>可以看出已经暴力成功破解了MySQL,在368秒内进行45061次猜测平均TPS为146.5。</p>
<h4 id="对MySQL进行暴破解-1"><a href="#对MySQL进行暴破解-1" class="headerlink" title="对MySQL进行暴破解"></a>对MySQL进行暴破解</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nmap -p <span class="number">1433</span> --script ms-sql-brute --script-args userdb=customuser.txt,passdb=custompass.txt &lt;host&gt;</span><br><span class="line">| <span class="type">ms</span>-sql-brute:</span><br><span class="line">|   <span class="type">[192</span><span class="number">.168</span><span class="number">.100</span><span class="number">.128</span>\TEST]</span><br><span class="line">|     <span class="type">No</span> credentials found</span><br><span class="line">|     <span class="type">Warnings</span>:</span><br><span class="line">|       <span class="type">sa</span>: AccountLockedOut</span><br><span class="line">|   <span class="type">[192</span><span class="number">.168</span><span class="number">.100</span><span class="number">.128</span>\PROD]</span><br><span class="line">|     <span class="type">Credentials</span> found:</span><br><span class="line">|       <span class="type">webshop_reader</span>:secret =&gt; Login Success</span><br><span class="line">|       <span class="type">testuser</span>:secret1234 =&gt; PasswordMustChange</span><br><span class="line">|<span class="type">_</span>      lordvader:secret1234 =&gt; Login Success</span><br></pre></td></tr></table></figure>
<h4 id="对Oracle数据库进行暴破解"><a href="#对Oracle数据库进行暴破解" class="headerlink" title="对Oracle数据库进行暴破解"></a>对Oracle数据库进行暴破解</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmap --script oracle-brute -p 1521 --script-args oracle-brute.<span class="attribute">sid</span>=ORCL &lt;host&gt;</span><br><span class="line">PORT     STATE <span class="built_in"> SERVICE </span>REASON</span><br><span class="line">1521/tcp open  oracle  syn-ack</span><br><span class="line">| oracle-brute:</span><br><span class="line">|   Accounts</span><br><span class="line">|     system:powell =&gt; Account locked</span><br><span class="line">|     haxxor:haxxor =&gt; Valid credentials</span><br><span class="line">|   Statistics</span><br><span class="line">|_    Perfomed 157 guesses <span class="keyword">in</span> 8 seconds, average tps: 19</span><br></pre></td></tr></table></figure>
<h4 id="对pgSQL的暴力破解"><a href="#对pgSQL的暴力破解" class="headerlink" title="对pgSQL的暴力破解"></a>对pgSQL的暴力破解</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">nmap</span> -<span class="keyword">p</span> <span class="number">5432</span> --script pgsql-brute <span class="symbol">&lt;host&gt;</span></span><br><span class="line"><span class="number">5432</span>/tcp <span class="keyword">open</span>  pgsql</span><br><span class="line">| pgsql-brute:</span><br><span class="line">|   roo<span class="variable">t:</span><span class="symbol">&lt;empty&gt;</span> =&gt; Valid credentials</span><br><span class="line">|_  tes<span class="variable">t:test</span> =&gt; Valid credentials</span><br></pre></td></tr></table></figure>
<h4 id="对SSH进行暴力破解"><a href="#对SSH进行暴力破解" class="headerlink" title="对SSH进行暴力破解"></a>对SSH进行暴力破解</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nmap -p <span class="number">22</span> --script ssh-brute --script-args userdb=users.lst,passdb=pass.lst --script-args ssh-brute.<span class="built_in">timeout</span>=<span class="number">4</span>s &lt;target&gt;</span><br><span class="line"><span class="number">22</span>/ssh open  ssh</span><br><span class="line">| <span class="type">ssh</span>-brute:</span><br><span class="line">|  <span class="type">Accounts</span></span><br><span class="line">|    <span class="type">username</span>:password</span><br><span class="line">|  <span class="type">Statistics</span></span><br><span class="line">|<span class="type">_</span>   Performed <span class="number">32</span> guesses <span class="built_in">in</span> <span class="number">25</span> seconds.</span><br></pre></td></tr></table></figure>
<h4 id="利用DNS进行子域名暴力破解"><a href="#利用DNS进行子域名暴力破解" class="headerlink" title="利用DNS进行子域名暴力破解"></a>利用DNS进行子域名暴力破解</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">nmap</span> --script dns-brute www.baidu.<span class="keyword">com</span></span><br><span class="line">λ <span class="keyword">nmap</span> --script dns-brute www.baidu.<span class="keyword">com</span>                      </span><br><span class="line"></span><br><span class="line">Starting Nmap <span class="number">7.50</span> ( http<span class="variable">s:</span>//<span class="keyword">nmap</span>.org ) at <span class="number">2017</span>-<span class="number">07</span>-<span class="number">25</span> <span class="number">13</span>:<span class="number">12</span> ?</span><br><span class="line">Nmap scan report <span class="keyword">for</span> www.baidu.<span class="keyword">com</span> (<span class="number">180.97</span>.<span class="number">33.108</span>)           </span><br><span class="line">Host <span class="keyword">is</span> <span class="keyword">up</span> (<span class="number">0.018</span>s latency).                                 </span><br><span class="line">Other addresses <span class="keyword">for</span> www.baidu.<span class="keyword">com</span> (not scanned): <span class="number">180.97</span>.<span class="number">33.10</span></span><br><span class="line">Not shown: <span class="number">998</span> filtered ports                                </span><br><span class="line">PORT    STATE SERVICE                                        </span><br><span class="line"><span class="number">80</span>/tcp  <span class="keyword">open</span>  http                                           </span><br><span class="line"><span class="number">443</span>/tcp <span class="keyword">open</span>  https                                          </span><br><span class="line"></span><br><span class="line">Host script result<span class="variable">s:</span>                                         </span><br><span class="line">| dns-brute:                                                 </span><br><span class="line">|   DNS Brute-force <span class="built_in">hostname</span><span class="variable">s:</span>                               </span><br><span class="line">|     admin.baidu.<span class="keyword">com</span> - <span class="number">10.26</span>.<span class="number">109.19</span>                         </span><br><span class="line">|     mx.baidu.<span class="keyword">com</span> - <span class="number">61.135</span>.<span class="number">163.61</span>                           </span><br><span class="line">|     svn.baidu.<span class="keyword">com</span> - <span class="number">10.65</span>.<span class="number">211.174</span>                          </span><br><span class="line">|     ads.baidu.<span class="keyword">com</span> - <span class="number">10.42</span>.<span class="number">4.225</span>                                                </span><br><span class="line"></span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">1</span> host <span class="keyword">up</span>) scanned in <span class="number">92.64</span> seconds</span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/45502ec7e0f8a0c49ca64b866248819c2.png">
<p>额(⊙⊙) 这个<code>admin.baidu.com</code>后面那个<code>10.26.109.19</code>难道真的是百度内网的管理平台地址</p>
<h4 id="检查VMWare-ESXESXi和服务器CVE-2009-3733中的路径遍历漏洞"><a href="#检查VMWare-ESXESXi和服务器CVE-2009-3733中的路径遍历漏洞" class="headerlink" title="检查VMWare ESXESXi和服务器CVE-2009-3733中的路径遍历漏洞"></a>检查VMWare ESXESXi和服务器CVE-2009-3733中的路径遍历漏洞</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmap --script http-vmware-path-vuln -p80,<span class="number">443</span>,<span class="number">8222</span>,<span class="number">8333</span> &lt;host&gt;</span><br><span class="line">| http-vmware-path-<span class="string">vuln:</span></span><br><span class="line">|   VMWare path traversal (CVE<span class="number">-2009</span><span class="number">-3733</span>): VULNERABLE</span><br><span class="line">|     <span class="regexp">/vmware/</span>Windows <span class="number">2003</span>/Windows <span class="number">2003.</span>vmx</span><br><span class="line">|     <span class="regexp">/vmware/</span>Pentest<span class="regexp">/Pentest - Linux/</span>Linux Pentest Bravo.vmx</span><br><span class="line">|     <span class="regexp">/vmware/</span>Pentest<span class="regexp">/Pentest - Windows/</span>Windows <span class="number">2003.</span>vmx</span><br><span class="line">|     <span class="regexp">/mnt/</span>vmware<span class="regexp">/vmware/</span>FreeBSD <span class="number">7.2</span>/FreeBSD <span class="number">7.2</span>.vmx</span><br><span class="line">|     <span class="regexp">/mnt/</span>vmware<span class="regexp">/vmware/</span>FreeBSD <span class="number">8.0</span>/FreeBSD <span class="number">8.0</span>.vmx</span><br><span class="line">|     <span class="regexp">/mnt/</span>vmware<span class="regexp">/vmware/</span>FreeBSD <span class="number">8.0</span> <span class="number">64</span>-bit/FreeBSD <span class="number">8.0</span> <span class="number">64</span>-bit.vmx</span><br><span class="line">|_    <span class="regexp">/mnt/</span>vmware<span class="regexp">/vmware/</span>Slackware <span class="number">13</span> <span class="number">32</span>-bit/Slackware <span class="number">13</span> <span class="number">32</span>-bit.vmx</span><br></pre></td></tr></table></figure>
<h4 id="查询VMware服务器vCenterESXESXiSOAP-API以提取版本信息。"><a href="#查询VMware服务器vCenterESXESXiSOAP-API以提取版本信息。" class="headerlink" title="查询VMware服务器vCenterESXESXiSOAP API以提取版本信息。"></a>查询VMware服务器vCenterESXESXiSOAP API以提取版本信息。</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">nmap --script vmware-version -p443 <span class="number">10.0</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line"></span><br><span class="line">Starting Nmap <span class="number">7.50</span> ( <span class="string">https:</span><span class="comment">//nmap.org ) at 2017-07-25 12:26 ?D1ú±ê×?ê±??</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">10.0</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">Host is up (<span class="number">0.0019</span>s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line"><span class="number">443</span>/tcp open  https</span><br><span class="line">| vmware-<span class="string">version:</span></span><br><span class="line">|   Server <span class="string">version:</span> VMware ESXi <span class="number">6.5</span><span class="number">.0</span></span><br><span class="line">|   <span class="string">Build:</span> <span class="number">4887370</span></span><br><span class="line">|   Locale <span class="string">version:</span> INTL <span class="number">000</span></span><br><span class="line">|   OS <span class="string">type:</span> vmnix-x86</span><br><span class="line">|_  Product Line <span class="string">ID:</span> embeddedEsx</span><br><span class="line">Service <span class="string">Info:</span> <span class="string">CPE:</span> <span class="string">cpe:</span>/<span class="string">o:</span><span class="string">vmware:</span><span class="string">ESXi:</span><span class="number">6.5</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">6.28</span> seconds</span><br></pre></td></tr></table></figure>
<img src="http://himg.sundayle.com/static/images/7ec5b1b3ec0ba3ee2d1587b17de0e8b92.png">
<h2 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h2><p>Nmap支持主机名,ip,网段的表示方式例如:<code>blah.highon.coffee, namp.org/24, 192.168.0.1;10.0.0-25.1-254</code></p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">iL filename                    从文件中读取待检测的目标,文件中的表示方法支持机名,ip,网段</span></span><br><span class="line"><span class="ruby">-iR hostnum                     随机选取,进行扫描.如果-iR指定为<span class="number">0</span>,则是无休止的扫描</span></span><br><span class="line"><span class="ruby">--exclude host1[, host2]        从扫描任务中需要排除的主机 </span></span><br><span class="line"><span class="ruby">--exculdefile exclude_file      排除文件中的IP,格式和-iL指定扫描文件的格式相同</span></span><br></pre></td></tr></table></figure>
<h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">sL                     仅仅是显示,扫描的IP数目,不会进行任何扫描</span></span><br><span class="line"><span class="ruby">-sn                     ping扫描,即主机发现</span></span><br><span class="line"><span class="ruby">-Pn                     不检测主机存活</span></span><br><span class="line"><span class="ruby">-PS/PA/PU/PY[portlist]  TCP SYN Ping/TCP ACK Ping/UDP Ping发现</span></span><br><span class="line"><span class="ruby">-PE/PP/PM               使用ICMP echo, timestamp <span class="keyword">and</span> netmask 请求包发现主机</span></span><br><span class="line"><span class="ruby">-PO[prococol list]      使用IP协议包探测对方主机是否开启 </span></span><br><span class="line"><span class="ruby">-n/-R                   不对IP进行域名反向解析/为所有的IP都进行域名的反响解析</span></span><br></pre></td></tr></table></figure>
<h3 id="扫描技巧"><a href="#扫描技巧" class="headerlink" title="扫描技巧"></a>扫描技巧</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">sS/sT/sA/sW/sM                 TCP SYN/TCP connect()/ACK/TCP窗口扫描/TCP Maimon扫描</span></span><br><span class="line"><span class="ruby">-sU                             UDP扫描</span></span><br><span class="line"><span class="ruby">-sN/sF/sX                       TCP NullFINand Xmas扫描</span></span><br><span class="line"><span class="ruby">--scanflags                     自定义TCP包中的flags</span></span><br><span class="line"><span class="ruby">-sI zombie host[<span class="symbol">:probeport</span>]     Idlescan</span></span><br><span class="line"><span class="ruby">-sY/sZ                          SCTP INIT/COOKIE-ECHO 扫描</span></span><br><span class="line"><span class="ruby">-sO                             使用IP protocol 扫描确定目标机支持的协议类型</span></span><br><span class="line"><span class="ruby">-b “FTP relay host”             使用FTP bounce scan</span></span><br></pre></td></tr></table></figure>
<h3 id="指定端口和扫描顺序"><a href="#指定端口和扫描顺序" class="headerlink" title="指定端口和扫描顺序"></a>指定端口和扫描顺序</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">p                      特定的端口 -p8<span class="number">0</span>,<span class="number">443</span> 或者 -p1-<span class="number">65535</span></span></span><br><span class="line"><span class="ruby">-p <span class="symbol">U:</span>PORT               扫描udp的某个端口, -p <span class="symbol">U:</span><span class="number">53</span></span></span><br><span class="line"><span class="ruby">-F                      快速扫描模式,比默认的扫描端口还少</span></span><br><span class="line"><span class="ruby">-r                      不随机扫描端口,默认是随机扫描的</span></span><br><span class="line"><span class="ruby">--top-ports <span class="string">"number"</span>    扫描开放概率最高的number个端口,出现的概率需要参考nmap-services文件,ubuntu中该文件位于/usr/share/nmap.nmap默认扫前<span class="number">1000</span>个</span></span><br><span class="line"><span class="ruby">--port-ratio <span class="string">"ratio"</span>    扫描指定频率以上的端口</span></span><br></pre></td></tr></table></figure>
<h3 id="服务版本识别"><a href="#服务版本识别" class="headerlink" title="服务版本识别"></a>服务版本识别</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">sV                             开放版本探测,可以直接使用-A同时打开操作系统探测和版本探测</span></span><br><span class="line"><span class="ruby">--version-intensity <span class="string">"level"</span>     设置版本扫描强度,强度水平说明了应该使用哪些探测报文。数值越高服务越有可能被正确识别。默认是<span class="number">7</span></span></span><br><span class="line"><span class="ruby">--version-light                 打开轻量级模式,为--version-intensity <span class="number">2</span>的别名</span></span><br><span class="line"><span class="ruby">--version-all                   尝试所有探测,为--version-intensity <span class="number">9</span>的别名</span></span><br><span class="line"><span class="ruby">--version-trace                 显示出详细的版本侦测过程信息</span></span><br></pre></td></tr></table></figure>
<h3 id="脚本扫描"><a href="#脚本扫描" class="headerlink" title="脚本扫描"></a>脚本扫描</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">sC                             根据端口识别的服务,调用默认脚本</span></span><br><span class="line"><span class="ruby">--script=”Lua scripts”          调用的脚本名</span></span><br><span class="line"><span class="ruby">--script-args=n1=v1,[n2=v2]     调用的脚本传递的参数</span></span><br><span class="line"><span class="ruby">--script-args-file=filename     使用文本传递参数</span></span><br><span class="line"><span class="ruby">--script-trace                  显示所有发送和接收到的数据</span></span><br><span class="line"><span class="ruby">--script-updatedb               更新脚本的数据库</span></span><br><span class="line"><span class="ruby">--script-help=”Lua script”      显示指定脚本的帮助</span></span><br></pre></td></tr></table></figure>
<h3 id="OS识别"><a href="#OS识别" class="headerlink" title="OS识别"></a>OS识别</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">O              启用操作系统检测,-A来同时启用操作系统检测和版本检测</span></span><br><span class="line"><span class="ruby">--osscan-limit  针对指定的目标进行操作系统检测(至少需确知该主机分别有一个open和closed的端口)</span></span><br><span class="line"><span class="ruby">--osscan-guess  推测操作系统检测结果,当Nmap无法确定所检测的操作系统时会尽可能地提供最相近的匹配Nmap默认进行这种匹配</span></span><br></pre></td></tr></table></figure>
<h4 id="防火墙-IDS躲避和哄骗"><a href="#防火墙-IDS躲避和哄骗" class="headerlink" title="防火墙/IDS躲避和哄骗"></a>防火墙/IDS躲避和哄骗</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">f; --mtu value                 指定使用分片、指定数据包的MTU.</span></span><br><span class="line"><span class="ruby">-D decoy1,decoy2,ME             使用诱饵隐蔽扫描</span></span><br><span class="line"><span class="ruby">-S IP-ADDRESS                   源地址欺骗</span></span><br><span class="line"><span class="ruby">-e interface                    使用指定的接口</span></span><br><span class="line"><span class="ruby">-g/ --source-port PROTNUM       使用指定源端口 </span></span><br><span class="line"><span class="ruby">--proxies url1,[url2],...       使用HTTP或者SOCKS4的代理 </span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">--data-length NUM               填充随机数据让数据包长度达到NUM</span></span><br><span class="line"><span class="ruby">--ip-options OPTIONS            使用指定的IP选项来发送数据包</span></span><br><span class="line"><span class="ruby">--ttl VALUE                     设置IP time-to-live域</span></span><br><span class="line"><span class="ruby">--spoof-mac ADDR/PREFIX/VEBDOR  MAC地址伪装</span></span><br><span class="line"><span class="ruby">--badsum                        使用错误的checksum来发送数据包</span></span><br></pre></td></tr></table></figure>
<h3 id="Nmap-输出"><a href="#Nmap-输出" class="headerlink" title="Nmap 输出"></a>Nmap 输出</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">oN                     将标准输出直接写入指定的文件</span></span><br><span class="line"><span class="ruby">-oX                     输出xml文件</span></span><br><span class="line"><span class="ruby">-oS                     将所有的输出都改为大写</span></span><br><span class="line"><span class="ruby">-oG                     输出便于通过bash或者perl处理的格式,非xml</span></span><br><span class="line"><span class="ruby">-oA BASENAME            可将扫描结果以标准格式、XML格式和Grep格式一次性输出</span></span><br><span class="line"><span class="ruby">-v                      提高输出信息的详细度</span></span><br><span class="line"><span class="ruby">-d level                设置debug级别,最高是<span class="number">9</span></span></span><br><span class="line"><span class="ruby">--reason                显示端口处于带确认状态的原因</span></span><br><span class="line"><span class="ruby">--open                  只输出端口状态为open的端口</span></span><br><span class="line"><span class="ruby">--packet-trace          显示所有发送或者接收到的数据包</span></span><br><span class="line"><span class="ruby">--iflist                显示路由信息和接口,便于调试</span></span><br><span class="line"><span class="ruby">--log-errors            把日志等级为errors/warings的日志输出</span></span><br><span class="line"><span class="ruby">--append-output         追加到指定的文件</span></span><br><span class="line"><span class="ruby">--resume FILENAME       恢复已停止的扫描</span></span><br><span class="line"><span class="ruby">--stylesheet PATH/URL   设置XSL样式表转换XML输出</span></span><br><span class="line"><span class="ruby">--webxml                从namp.org得到XML的样式</span></span><br><span class="line"><span class="ruby">--no-sytlesheet         忽略XML声明的XSL样式表</span></span><br></pre></td></tr></table></figure>
<h3 id="其他nmap选项"><a href="#其他nmap选项" class="headerlink" title="其他nmap选项"></a>其他nmap选项</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"><span class="number">6</span>                      开启IPv6</span></span><br><span class="line"><span class="ruby">-A                      OS识别,版本探测,脚本扫描和traceroute</span></span><br><span class="line"><span class="ruby">--datedir DIRNAME       说明用户Nmap数据文件位置</span></span><br><span class="line"><span class="ruby">--send-eth / --send-ip  使用原以太网帧发送/在原IP层发送</span></span><br><span class="line"><span class="ruby">--privileged            假定用户具有全部权限</span></span><br><span class="line"><span class="ruby">--unprovoleged          假定用户不具有全部权限,创建原始套接字需要root权限</span></span><br><span class="line"><span class="ruby">-V                      打印版本信息</span></span><br><span class="line"><span class="ruby">-h                      输出帮助</span></span><br></pre></td></tr></table></figure>
<p>转载自：<a href="http://www.freebuf.com/news/141607.html" target="_blank" rel="noopener">FreeBuf.COM 不老的神器：安全扫描器Nmap渗透使用指南</a><br><a href="https://nmap.org/man/zh/index.html" target="_blank" rel="noopener">Nmap官方中文文档</a></p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/python-encoding/" data-toggle="tooltip" data-placement="top" title="Python 编码">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/python-deep-copy-and-shallow-copy/" data-toggle="tooltip" data-placement="top" title="Python中的深拷贝和浅拷贝">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                

            </div>
    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://jaminzhang.github.io" target="_blank">JAMIN ZHANG</a></li>
                    
                        <li><a href="#" target="_blank">It helps SEO</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/sundayle">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Sunday 2019 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>
                    Ported by <a href="https://github.com/Kaijun/hexo-theme-huxblog">Kaijun</a>
            <!-- 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
            -->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
     async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-70699634-1';
    var _gaDomain = 'auto';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
